import os
import datetime
from xml.etree.ElementTree import Element, SubElement, ElementTree

SITE_URL = os.getenv("SITE_URL", "https://reverse-shion.github.io")
SITE_ROOT = os.getenv("SITE_ROOT", ".")

# å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
OUTPUT_PATH = os.path.join(SITE_ROOT, "sitemap.xml")

# ç¾åœ¨æ™‚åˆ»ã‚’ISO8601å½¢å¼ï¼ˆUTCï¼‰ã§å–å¾—
now = datetime.datetime.utcnow().replace(microsecond=0).isoformat() + "Z"

# XMLãƒ«ãƒ¼ãƒˆè¦ç´ 
urlset = Element("urlset", xmlns="http://www.sitemaps.org/schemas/sitemap/0.9")

# HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«æ¢ç´¢
for root, dirs, files in os.walk(SITE_ROOT):
    for file in files:
        if file.endswith(".html"):
            rel_path = os.path.relpath(os.path.join(root, file), SITE_ROOT)
            url = f"{SITE_URL}/{rel_path}".replace("index.html", "")
            node = SubElement(urlset, "url")
            SubElement(node, "loc").text = url
            # ğŸ”¥ ã“ã“ã§å¸¸ã«æœ€æ–°æ™‚åˆ»ã‚’è¨­å®šï¼ˆæ›´æ–°æ¤œçŸ¥ã«é ¼ã‚‰ãªã„ï¼‰
            SubElement(node, "lastmod").text = now

# XMLä¿å­˜
tree = ElementTree(urlset)
tree.write(OUTPUT_PATH, encoding="utf-8", xml_declaration=True)

print(f"âœ… sitemap.xml generated successfully at {now}")
