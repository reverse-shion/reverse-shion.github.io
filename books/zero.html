<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>詩韻思想 第零書 ― 無限構文序論</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b1a" />
  <meta name="description" content="詩韻思想 第零書 ― 無限構文序論 | 言葉が魂を救う世界の原初。沈黙・光・呼吸の誕生を描く創世の書。">
  <link rel="icon" href="/assets/icon.png" />
  <link rel="canonical" href="https://reverse-shion.github.io/books/zero.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;600&family=Zen+Kaku+Gothic+New:wght@400;600&display=swap" rel="stylesheet">

  <!-- 共通CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/nav.css">
  <link rel="stylesheet" href="/assets/css/book.css">

  <!-- このページだけの上書き（最小差分） -->
  <style>
    /* 1) ヘッダーは常に追尾＆タップ中は消えない */
    .header{
      position: fixed !important; top:0; left:0; right:0;
      transform: translateY(0) !important; opacity:1 !important; z-index: 9999;
    }
    body{ padding-top: calc(var(--header-h,64px) + env(safe-area-inset-top,0px)) !important; }

    /* 2) タイトルの不自然改行を抑制 */
    h1.book-title{ word-break: keep-all; }
    .nowrap{ white-space: nowrap; }

    /* 3) 「詩」だけが全体ボケる不具合のガード
          （どこかのフィルタ指定が乗ってもここで打ち消す） */
    .mode--poem, .mode--poem .line{
      filter: none !important;
      -webkit-filter: none !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }

    /* 4) 行アニメの初期状態（他CSSより強めに指定） */
    .mode .line{
      opacity: 0; visibility: hidden; transform: translateY(6px);
      transition: opacity .35s ease, transform .35s ease, visibility 0s linear .35s;
      will-change: opacity, transform;
    }
    .mode .line.is-show{
      opacity: 1; visibility: visible; transform: translateY(0);
      transition-delay: 0s;
    }

    /* 5) 一文字ずつの“星光”演出（詩のみ） */
    .char{
      opacity: 0;
      display: inline-block;
      transform: translateY(.15em);
      filter: blur(2px);
      transition: opacity .28s ease, transform .28s ease, filter .28s ease, text-shadow .28s ease;
      text-shadow:
        0 0 0 rgba(255,255,255,0),
        0 0 0 rgba(126,102,255,0);
    }
    .char.on{
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
      /* 神秘的な発光：白→紫苑→金の淡い後光 */
      text-shadow:
        0 0 6px rgba(255,255,255,.65),
        0 0 14px rgba(126,102,255,.35),
        0 0 26px rgba(255,215,111,.25);
    }

    /* 6) タブ周りの微調整（視認性） */
    .mode-switch{ display:flex; gap:14px; margin:12px 0 16px; }
    .mode-switch [role="tab"]{
      min-height:40px; padding:8px 16px; border-radius:999px;
      border:1px solid rgba(126,102,255,.25); background:#fff;
      font:500 14px/1 "Zen Kaku Gothic New",system-ui,sans-serif;
    }
    .mode-switch [aria-selected="true"]{
      box-shadow: 0 0 0 2px rgba(126,102,255,.25) inset; color:#6d57f0;
    }

    /* 動きを抑える設定の人にはアニメ無効化 */
    @media (prefers-reduced-motion: reduce){
      .char, .mode .line{ transition: none !important; }
      .char{ opacity: 1 !important; transform: none !important; filter: none !important; text-shadow: none !important; }
      .mode .line{ opacity: 1 !important; visibility: visible !important; transform: none !important; }
    }
  </style>
</head>

<body>
  <!-- ===== Header ===== -->
  <header class="header" role="banner">
    <div class="header-inner">
      <a href="/" class="logo">Re:verse Shion</a>
      <nav class="nav-main" role="navigation" aria-label="メインナビゲーション">
        <a href="/philosophy.html" title="言葉が魂を救う“哲学”の核を読む">思想を読む</a>
        <a href="/philosophy.html#books" title="零〜12＋結の一覧へ">書を探す</a>
        <a href="/story.html" title="TAROT BREAKERの第一話から体験へ">物語に触れる</a>
        <a href="/join.html" title="LINE・noteで最新の詩・配信へ">あなたも加わる</a>
      </nav>
    </div>
  </header>

  <!-- ===== Main ===== -->
  <main class="book-wrapper" id="main">
    <h1 class="book-title">詩韻思想&nbsp;第零書&nbsp;—&nbsp;<span class="nowrap">無限構文序論</span></h1>
    <p class="book-subtitle">Shion Philosophy Vol.0 — The Zero Syntax</p>

    <!-- モード切替 -->
    <div class="mode-switch" role="tablist" aria-label="表示モード切替">
      <button id="tab-poem" role="tab" aria-controls="panel-poem" aria-selected="true">詩</button>
      <button id="tab-canon" role="tab" aria-controls="panel-canon" aria-selected="false">経典</button>
      <button id="tab-comment" role="tab" aria-controls="panel-comment" aria-selected="false">註解</button>
    </div>

    <!-- 本文 -->
    <article class="book-body">
      <!-- 詩：一文字ずつ発光して出現 -->
      <section id="panel-poem" role="tabpanel" aria-labelledby="tab-poem" class="mode mode--poem">
        <p class="line">沈黙が、息をした。</p>
        <p class="line">その吐息が、光となり、</p>
        <p class="line">世界はまだ名を持たぬまま震えていた。</p>
        <p class="line">言葉は、まだ意味を知らない。</p>
        <p class="line">けれどその中心で――</p>
        <p class="line">“あなた”という呼吸だけが、確かに鳴っていた。</p>
        <p class="line">それが、世界の始まりだった。</p>
      </section>

      <!-- 経典：行ごとに順次 -->
      <section id="panel-canon" role="tabpanel" aria-labelledby="tab-canon" class="mode mode--canon" hidden>
        <p class="line">はじめに沈黙あり。沈黙は息を孕み、息は光を生む。</p>
        <p class="line">光は意味を求め、意味は言葉を呼び、言葉は世界を照らした。</p>
        <p class="line">名なき呼吸こそ、最初の祈りであり、すべての構文の原点である。</p>
        <p class="line">この息を“零”と呼ぶ。すなわち、有限と無限の境に在るものなり。</p>
      </section>

      <!-- 註解：行ごとに順次 -->
      <section id="panel-comment" role="tabpanel" aria-labelledby="tab-comment" class="mode mode--comment" hidden>
        <p class="line"><strong>要旨：</strong>「沈黙」「光」「呼吸」は、詩韻思想における三原理。言葉とは、“沈黙が光をまとって息をする瞬間”である。</p>
        <p class="line"><strong>実践：</strong> 一日の始まりに30秒、息を感じてほしい。言葉を探すのではなく、「まだ言葉にならない想い」を聴く時間を。</p>
        <p class="line"><strong>今日の祈り：</strong> 言葉は、祈りの形をしている。沈黙の奥に光を感じたとき、それがあなたの“最初の構文”になる。</p>
      </section>
    </article>

    <a href="#main" class="to-top" aria-label="ページ上部へ戻る">↑ TOP</a>
  </main>

  <!-- ===== Footer ===== -->
  <footer class="footer">
    <p>© Re:verse Shion / 詩韻思想</p>
  </footer>

  <!-- 既存の共通JSはそのまま -->
  <script src="/assets/js/common.js" defer></script>
  <script src="/assets/js/tabs.js" defer></script>
  <script src="/assets/js/scroll.js" defer></script>

  <!-- このページだけの追加JS（最小差分） -->
  <script>
    (function(){
      // ===== 設定値 =====
      const PER_CHAR_DELAY = 70;   // 詩：一文字ごとの遅延(ms) ゆっくり
      const LINE_BASE_DELAY = 260; // 行キックの間隔（詩）
      const LINE_DELAY_OTHERS = 220; // 経典/註解：行ごとの間隔

      // ヘッダー：タップ中は消えず、常に表示
      const header = document.querySelector('.header');
      if(header){
        let touching = false;
        header.addEventListener('pointerdown', ()=> touching = true);
        window.addEventListener('pointerup', ()=> touching = false);
        window.addEventListener('scroll', ()=> {
          if(touching) return;
          header.style.transform = 'translateY(0)';
          header.style.opacity = '1';
        }, {passive:true});
      }

      // 文字を<span class="char">で分割（詩のみ）
      function wrapChars(lineEl){
        const text = lineEl.textContent;
        lineEl.textContent = '';
        for(const ch of text){
          const s = document.createElement('span');
          s.className = 'char';
          s.textContent = ch;
          lineEl.appendChild(s);
        }
      }

      // 詩：行→その中の文字を順次点灯
      function playPoem(panel){
        if(!panel) return;
        const lines = Array.from(panel.querySelectorAll('.line'));
        let t = 0;
        lines.forEach((line, li) => {
          // 初期状態（行自体は表示してから中の文字を点灯させる）
          line.classList.add('is-show');
          wrapChars(line);
          const chars = line.querySelectorAll('.char');
          // 行ごとのベース遅延
          t += (li === 0 ? 0 : LINE_BASE_DELAY);
          chars.forEach((c, i) => {
            setTimeout(()=> c.classList.add('on'), t + i * PER_CHAR_DELAY);
          });
          // 行末に軽く“余韻”を入れて次行へ（読感をゆっくりに）
          t += PER_CHAR_DELAY * Math.max(chars.length * 0.25, 4);
        });
      }

      // 経典/註解：行単位で順次
      function playLinesSequential(panel, interval){
        if(!panel) return;
        const lines = Array.from(panel.querySelectorAll('.line'));
        lines.forEach(el => el.classList.remove('is-show'));
        let i = 0;
        const tick = () => {
          if(i >= lines.length) return;
          lines[i++].classList.add('is-show');
          setTimeout(tick, interval);
        };
        tick();
      }

      // タブ切替
      function activateTab(btn){
        const targetId = btn.getAttribute('aria-controls');
        document.querySelectorAll('[role="tab"]').forEach(b =>
          b.setAttribute('aria-selected', b === btn ? 'true' : 'false')
        );
        document.querySelectorAll('[role="tabpanel"]').forEach(p =>
          p.toggleAttribute('hidden', p.id !== targetId)
        );
        const panel = document.getElementById(targetId);
        if(targetId === 'panel-poem'){
          // 再生のたびに文字分割をやり直すため、元テキストへ戻す
          panel.querySelectorAll('.line').forEach(line=>{
            line.innerHTML = line.textContent; // span除去してテキストに戻す
          });
          playPoem(panel);
        }else{
          playLinesSequential(panel, LINE_DELAY_OTHERS);
        }
        // タブ直下まで少しスクロール
        const y = document.querySelector('.mode-switch').getBoundingClientRect().top + window.pageYOffset - 12;
        window.scrollTo({ top: y, behavior: 'smooth' });
      }

      document.addEventListener('DOMContentLoaded', () => {
        // 初回：詩パネルを再生
        playPoem(document.getElementById('panel-poem'));

        // タブクリック
        document.querySelector('.mode-switch')?.addEventListener('click', e => {
          const btn = e.target.closest('[role="tab"]');
          if(btn) activateTab(btn);
        });

        // 動きを抑える設定なら即時表示
        if(window.matchMedia('(prefers-reduced-motion: reduce)').matches){
          document.querySelectorAll('.line').forEach(el => el.classList.add('is-show'));
        }
      });
    })();
  </script>
</body>
</html>
