<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>詩韻 Shion — 言葉で魂を救う Code｜無料タロット（詩・韻・祈）</title>
  <meta name="description" content="無料タロットで“詩・韻・祈”。詩韻 Shion の思想（言葉で魂を救う Code）に基づくリーディング。恋愛・復縁・連絡・進路の悩みに。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="詩韻 Shion — 言葉で魂を救う Code｜無料タロット（詩・韻・祈）">
  <meta property="og:description" content="“詩・韻・祈”で読む、思想連動タロット。儀式（星詠リチュアル）→展開→濃密リーディング→次の一歩へ。">
  <meta property="og:image" content="assets/ogp.jpg">
  <meta property="og:url" content="./">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shion-tarot.css">

  <!-- ✅（任意）GA4：測定IDを差し替えて有効化
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>
  -->
</head>
<body>

  <!-- ===== 共通ヘッダー（神殿ナビ） ===== -->
  <header class="header" role="banner">
    <div class="header__inner">
      <a href="/" class="logo">Re:verse Shion</a>
      <nav class="nav" role="navigation" aria-label="メインナビゲーション">
        <a href="/shion.html">神殿へ</a>
        <a href="/philosophy.html">思想を読む</a>
        <a href="/about.html">詩韻とは</a>
      </nav>
    </div>
  </header>
  <div class="header-spacer" aria-hidden="true"></div>

  <!-- 背景の星砂 -->
  <div class="stardust" aria-hidden="true"></div>

  <!-- ===== ヒーロー ===== -->
  <section class="hero" id="hero">
    <div class="hero__bg" aria-hidden="true"></div>
    <div class="hero__veil" aria-hidden="true"></div>

    <div class="hero__inner">
      <h1 class="hero__title">言葉で魂を救う<span class="hero__code">Code</span></h1>
      <p class="hero__subtitle">占い × 思想 ―― 詩（Poem）・韻（Rhythm）・祈（Prayer）で、あなたの“今”を言葉で照らす。</p>
      <p class="hero__poem">恋も、仕事も、運命も。―― 大丈夫だよ。</p>

      <p class="hero__note" aria-label="無料体験の注記">無料で体験できます／所要1分</p>
      <button id="startRitualBtn" class="btn-primary" type="button" aria-label="星詠リチュアルを始める">
        はじめる（星詠リチュアル）
      </button>
      <p class="start-time" id="startTime" aria-live="polite"></p>
    </div>

    <!-- BGM（タップ時起動/iOS対応） -->
    <audio id="bgm" src="assets/sound/temple-ambient.mp3" preload="auto" loop playsinline></audio>
  </section>

  <!-- ===== 儀式 → 本編へ ===== -->
  <section id="ritual" class="ritual hidden" aria-live="polite" aria-atomic="true">
    <div class="ritual__glow" aria-hidden="true"></div>
    <p class="ritual__line">星の声が、あなたの言葉に触れる。</p>
    <p class="ritual__line">息を整えて――目を閉じ、一度だけ願いを呼ぶ。</p>
    <p class="ritual__line">いま、展く。詩・韻・祈。</p>
  </section>

  <!-- ===== タロット本編 ===== -->
  <main id="main" class="main hidden" aria-labelledby="readingTitle">
    <section class="spread" aria-label="タロット展開">
      <h2 id="readingTitle" class="sr-only">詩・韻・祈 の三枚展開</h2>

      <div class="spread__labels" aria-hidden="true">
        <div class="label">詩</div>
        <div class="label">韻</div>
        <div class="label">祈</div>
      </div>

      <div class="spread__cards">
        <div class="card" data-idx="0" aria-label="詩のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card0" role="img" aria-label="詩のカード 表面画像"></div>
          </div>
        </div>
        <div class="card" data-idx="1" aria-label="韻のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card1" role="img" aria-label="韻のカード 表面画像"></div>
          </div>
        </div>
        <div class="card" data-idx="2" aria-label="祈のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card2" role="img" aria-label="祈のカード 表面画像"></div>
          </div>
        </div>
      </div>

      <div class="tap-hint" id="tapHint"><div class="tap-hint__pill">カードを順にタップ</div></div>
      <div class="peel" id="peel" aria-hidden="true"></div>
    </section>

    <!-- 説明 -->
    <section class="about section">
      <h3 class="section__title">詩韻祈（しおんき）とは？</h3>
      <p class="about__text">
        あなたの魂がいま必要としている言葉を、<strong>三つの層</strong>（詩＝核／韻＝運び／祈＝帰路）で受け取る短詩リーディングです。<br>
        各カードは<strong>二行の詩</strong>として現れ、最後に<strong>九行の総合詩</strong>で「つまり、こういうこと」を示します。
      </p>
    </section>

    <!-- 2行×3枚 -->
    <section class="reading section" id="reading">
      <h3 class="section__title">詩・韻・祈 のリーディング</h3>
      <div class="reading__grid">
        <article class="reading__item">
          <div class="reading__head">詩（Poem）</div>
          <div class="reading__body" id="body0">カードを開くと、ここに“詩”が現れます。</div>
        </article>
        <article class="reading__item">
          <div class="reading__head">韻（Rhythm）</div>
          <div class="reading__body" id="body1">カードを開くと、ここに“韻”が現れます。</div>
        </article>
        <article class="reading__item">
          <div class="reading__head">祈（Prayer）</div>
          <div class="reading__body" id="body2">カードを開くと、ここに“祈”が現れます。</div>
        </article>
      </div>
    </section>

    <!-- 総合9行詩 -->
    <section class="summary section" id="summary">
      <h3 class="section__title">総合結果 ― つまり、こういうこと。</h3>
      <div class="summary__poem" id="summaryPoem">
        カードをすべて開くと、ここに九行のメッセージが現れます。
      </div>
      <p class="closing-line">大丈夫だよ。言葉は、あなたの光だから。</p>
    </section>

    <!-- ★ 次の一歩（占い完了後に出現） -->
    <section class="next-steps section hidden" id="nextSteps" aria-live="polite" aria-atomic="true">
      <h3 class="section__title">次の一歩 ― 扉は三つ。</h3>
      <p class="next-steps__lead">
        いま開いた言葉を、<strong>どう進めるか</strong>を選べます。<br>
        おすすめは <strong>「導きを直接受け取る（LINE）」</strong> です。
      </p>
      <ol class="next-steps__list">
        <li><strong>体験を続ける：</strong> 詩韻の神殿で世界観にもう一歩。</li>
        <li><strong>意味を深く知る：</strong> 詩韻思想で結果の真意を読む。</li>
        <li><strong>個別の導き：</strong> LINEであなただけの鑑定を受け取る。</li>
      </ol>

      <nav class="cta-grid">
        <a class="btn-ghost" href="#" id="retry" data-cta="retry">🌌 星の声をもう一度聞く</a>
        <a class="btn-dark cta-link" href="shion.html" data-cta="temple">🌕 詩韻の神殿へ進む</a>
        <a class="btn-light cta-link" href="philosophy.html" data-cta="philosophy">🌙 言葉の真意を受け取る</a>
        <a class="btn-line cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="line">
          💚 導きを直接受け取る（LINE鑑定）
          <span class="sub">※ 1対1で今の状況に合わせて言葉を届けます</span>
        </a>
      </nav>
    </section>
  </main>

  <!-- クリック演出オーバーレイ -->
  <div class="fade-overlay" id="fadeOverlay" aria-hidden="true"></div>

  <!-- 効果音 -->
  <audio id="flipSe" src="https://freesound.org/data/previews/351/351408_5665338-lq.mp3" preload="auto"></audio>

  <script>
  // ====== Audio Boot ======
  const bgm = document.getElementById('bgm');
  function kickBgm(){
    try { bgm.volume = 0.55; const p = bgm.play(); if (p && p.catch) p.catch(()=>{}); } catch(e){}
  }

  // ====== Tarot Data ======
  const deck = [
    { name:'The Fool', idx:0, two:['最初の一歩は、恐れよりも軽い風。','失敗は合図――世界は君に開く。'], kw:'始まり' },
    { name:'The Magician', idx:1, two:['意志は手を、言葉は現実を動かす。','足りないものは、すでに君の中にある。'], kw:'創造' },
    { name:'The High Priestess', idx:2, two:['沈黙が真実の輪郭を照らす。','内なる月に、耳を澄ませ。'], kw:'直観' },
    { name:'The Empress', idx:3, two:['優しさは力、受け取ることは創造。','育てたものが、君を育てる。'], kw:'豊穣' },
    { name:'The Emperor', idx:4, two:['迷いは構造で解ける。','境界線は、君を守る城。'], kw:'秩序' },
    { name:'The Hierophant', idx:5, two:['伝統は檻ではなく、梯子。','学びは自由の準備運動。'], kw:'教え' },
    { name:'The Lovers', idx:6, two:['選ぶことは、誰かを愛すること。','愛することは、選び続けること。'], kw:'選択' },
    { name:'The Chariot', idx:7, two:['向かう先が速さを決める。','手綱は心、進路は意志。'], kw:'前進' },
    { name:'Strength', idx:8, two:['優しい力は、世界を従わせない。','それでも、世界は従う。'], kw:'内なる力' },
    { name:'The Hermit', idx:9, two:['独りの灯りが、群衆より遠くを照らす。','探していたのは、探している自分だった。'], kw:'探求' },
    { name:'Wheel of Fortune', idx:10, two:['巡るのは運ではなく、選択。','タイミングは、準備を愛している。'], kw:'転機' },
    { name:'Justice', idx:11, two:['やさしさにも刃がある。','公平さは君と相手を同時に救う。'], kw:'均衡' },
    { name:'The Hanged Man', idx:12, two:['世界を逆さにして、はじめて見える。','止まることが、進むことになる日もある。'], kw:'視点転換' },
    { name:'Death', idx:13, two:['終わりは、名前の違う始まり。','脱皮の痛みは、生きている証。'], kw:'変容' },
    { name:'Temperance', idx:14, two:['混ぜる、待つ、整える。','その中間に、答えは棲む。'], kw:'調和' },
    { name:'The Devil', idx:15, two:['鎖は心の内側に結ばれている。','鍵もまた、内側にある。'], kw:'解放' },
    { name:'The Tower', idx:16, two:['壊れるのは、壊すべきもの。','空いた隙間が、光の通り道。'], kw:'覚醒' },
    { name:'The Star', idx:17, two:['願いは夜の水面で強くなる。','希望は、手を洗うみたいに簡単。'], kw:'希望' },
    { name:'The Moon', idx:18, two:['不安は、想像力の副作用。','曙は、必ず来る。'], kw:'曙光' },
    { name:'The Sun', idx:19, two:['喜びは戦略になる。','笑顔は、未来の先行投資。'], kw:'成功' },
    { name:'Judgement', idx:20, two:['赦すのではない、呼び戻すのだ。','いまの君で、やり直せ。'], kw:'再生' },
    { name:'The World', idx:21, two:['輪は閉じて、道は開く。','完成形は、次のスタートライン。'], kw:'成就' }
  ];

  // ====== Elements ======
  const startBtn  = document.getElementById('startRitualBtn');
  const startTimeEl = document.getElementById('startTime');
  const ritualSec = document.getElementById('ritual');
  const mainSec   = document.getElementById('main');
  const peel      = document.getElementById('peel');
  const tapHint   = document.getElementById('tapHint');
  const readingEl = document.getElementById('reading');
  const summaryPoem = document.getElementById('summaryPoem');
  const retryBtn  = document.getElementById('retry');
  const flipSe    = document.getElementById('flipSe');
  const cardEls   = document.querySelectorAll('.card');
  const fronts    = [document.getElementById('card0'), document.getElementById('card1'), document.getElementById('card2')];
  const bodies    = [document.getElementById('body0'), document.getElementById('body1'), document.getElementById('body2')];
  const nextSteps = document.getElementById('nextSteps');
  const overlay   = document.getElementById('fadeOverlay');

  // ====== State ======
  let selected = [];
  let opened = 0;

  function drawThree(){
    const pool = [...deck];
    const picks = [];
    for(let i=0;i<3;i++){
      const r = crypto.getRandomValues(new Uint32Array(1))[0] % pool.length;
      picks.push(pool.splice(r,1)[0]);
    }
    return picks;
  }

  function resetView(){
    opened = 0;
    bodies[0].textContent = 'カードを開くと、ここに“詩”が現れます。';
    bodies[1].textContent = 'カードを開くと、ここに“韻”が現れます。';
    bodies[2].textContent = 'カードを開くと、ここに“祈”が現れます。';
    readingEl.classList.remove('is-active');
    summaryPoem.textContent = 'カードをすべて開くと、ここに九行のメッセージが現れます。';
    tapHint.style.opacity = 1;
    nextSteps.classList.add('hidden');
    nextSteps.classList.remove('is-on');
    cardEls.forEach((el,i)=>{
      el.classList.remove('is-flipped');
      el.style.pointerEvents = 'auto';
      fronts[i].style.backgroundImage = 'var(--front' + i + ')';
    });
  }

  function beginReading(){
    selected = drawThree();
    resetView();
  }

  function beginRitual(){
    kickBgm();
    const now = new Date();
    const jst = new Intl.DateTimeFormat('ja-JP', { timeZone:'Asia/Tokyo', hour:'2-digit', minute:'2-digit', year:'numeric', month:'2-digit', day:'2-digit' }).format(now);
    startTimeEl.textContent = `星が動き出した時間：${jst}`;
    startTimeEl.classList.add('is-on');

    ritualSec.classList.remove('hidden');
    setTimeout(()=>{
      ritualSec.classList.add('hidden');
      mainSec.classList.remove('hidden');
      peel.classList.add('is-run');
      peel.addEventListener('animationend', ()=> peel.classList.remove('is-run'), {once:true});
      beginReading();
      mainSec.scrollIntoView({behavior:'smooth', block:'start'});
    }, 1200);
  }

  function twoLineText(card){
    return `<span class="line">${card.two[0]}</span><br><span class="line">${card.two[1]}</span>`;
  }

  function buildSummaryPoem(sel){
    const keys = sel.map(c => c.kw);
    const names = sel.map(c => c.name.replace('The ',''));
    const lines = [
      `きみが扉を叩いた瞬間、時間は「味方」に変わった。`,
      `三つの言葉が、同じ方向を指している。`,
      `「${names[0]}」は告げる――${keys[0]}は、心の中心に種を置くこと。`,
      `「${names[1]}」は進めという――${keys[1]}は、迷いを動詞に変えること。`,
      `「${names[2]}」は還れという――${keys[2]}は、光へ戻る手順のこと。`,
      `だから焦らなくていい。速さより、整いを選べばいい。`,
      `君の手の温度が、現実の速度を決めていく。`,
      `結論はやさしい――いまの君で、はじめればいい。`,
      `大丈夫だよ。言葉は、必ず君を連れていく。`
    ];
    return lines.map(l => `<p>${l}</p>`).join('');
  }

  function onFlip(idx){
    const cardEl = cardEls[idx];
    if(cardEl.classList.contains('is-flipped') || opened>=3) return;

    try { flipSe.currentTime = 0; flipSe.play(); } catch(e){}

    const data = selected[idx];
    cardEl.classList.add('is-flipped');
    opened++;

    const label = ['【詩】','【韻】','【祈】'][idx];
    bodies[idx].innerHTML = `<strong>${label}</strong> 《${data.name}》<br>${twoLineText(data)}`;

    if(opened===3){
      tapHint.style.opacity = 0;
      cardEls.forEach(c=> c.style.pointerEvents='none');
      readingEl.classList.add('is-active');
      summaryPoem.innerHTML = buildSummaryPoem(selected);
      document.getElementById('summary').scrollIntoView({behavior:'smooth', block:'start'});

      // ★「次の一歩」を出現
      nextSteps.classList.remove('hidden');
      requestAnimationFrame(()=> nextSteps.classList.add('is-on'));
    }
  }

  function onRetry(e){
    e.preventDefault();
    startTimeEl.textContent = '';
    startTimeEl.classList.remove('is-on');
    document.getElementById('hero').scrollIntoView({behavior:'smooth'});
    setTimeout(()=>{ beginReading(); }, 600);
  }

  // ====== CTA：光フェード＆計測 ======
  function trackCTA(label){
    // GA4（gtag）呼び出し
    if(typeof gtag !== 'undefined'){
      gtag('event', 'click', {event_category:'CTA', event_label:label, value:1});
    }
    // GTM等に渡すカスタムイベント
    window.dispatchEvent(new CustomEvent('cta_click', { detail:{ label } }));
  }

  function glowAndGo(e){
    const el = e.currentTarget;
    const label = el.getAttribute('data-cta') || 'unknown';
    overlay.classList.add('active');
    trackCTA(label);
    setTimeout(()=> overlay.classList.remove('active'), 800);
    // 通常遷移はそのまま（a要素）。_blankでもOK
  }

  // ====== Bindings ======
  window.addEventListener('load', ()=>{
    cardEls.forEach((el)=> el.addEventListener('click', ()=> onFlip(Number(el.dataset.idx)), {passive:true}));
    startBtn.addEventListener('click', beginRitual, {passive:true});
    document.getElementById('retry').addEventListener('click', onRetry, false);
    setTimeout(()=>{ document.querySelector('.hero__veil').classList.add('is-on'); }, 350);

    // CTA演出＆計測
    document.querySelectorAll('.cta-link').forEach(btn=>{
      btn.addEventListener('click', glowAndGo, false);
    });
  });

  // iOS保険（初回タップでBGM起動）
  window.addEventListener('touchstart', function once(){
    kickBgm();
    window.removeEventListener('touchstart', once, {passive:true});
  }, {passive:true, once:true});
  </script>
</body>
</html>
