<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>詩韻 Shion — 言葉で魂を救う Code｜無料タロット（詩・韻・祈）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b1a" />
  <meta name="description" content="無料タロットで“詩・韻・祈”。詩韻 Shion の思想（言葉で魂を救う Code）に基づくリーディング。恋愛・復縁・連絡・進路の悩みに。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="詩韻 Shion — 言葉で魂を救う Code｜無料タロット（詩・韻・祈）">
  <meta property="og:description" content="“詩・韻・祈”で読む、思想連動タロット。儀式（星詠リチュアル）→三枚の詩→九行の総合詩。">
  <meta property="og:image" content="assets/ogp.jpg">
  <meta property="og:url" content="./">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Cormorant+Garamond:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shion-tarot.css">
  <link rel="icon" href="assets/favicon.png" type="image/png" sizes="32x32">
</head>
<body>
  <!-- ========== Header ========== -->
  <header class="hdr" role="banner">
    <div class="hdr__in">
      <a href="/" class="logo" aria-label="Re:verse Shion トップへ">Re:verse Shion</a>
      <nav class="nav" role="navigation" aria-label="メインナビゲーション">
        <a href="/philosophy.html" title="言葉が魂を救う“哲学”の核を読む">思想を読む</a>
        <a href="/shion.html" title="詩韻の神殿（演出）へ">神殿へ</a>
        <a href="/about.html" title="詩韻とは">詩韻とは</a>
      </nav>
      <a class="mini-cta cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="header-line" aria-label="LINEで個人鑑定">
        鑑定
      </a>
    </div>
  </header>
  <div class="hdr-spacer" aria-hidden="true"></div>

  <!-- ========== Background (Temple) ========== -->
  <div class="bg" aria-hidden="true">
    <div class="bg__orb"></div>
    <div class="bg__grid"></div>
    <div class="bg__dust"></div>
  </div>

  <!-- ========== Hero ========== -->
  <section class="hero" id="hero">
    <div class="hero__in">
      <h1 class="hero__ttl">言葉で魂を救う <span class="hero__code">Code</span></h1>
      <p class="hero__sub">占い × 思想。詩（Poem）・韻（Rhythm）・祈（Prayer）で、あなたの“今”を言葉で照らす。</p>
      <p class="hero__poem">恋も、仕事も、運命も。―― 大丈夫だよ。</p>

      <div class="hero-ctas">
        <a class="btn-hero-primary cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="hero-line">
          💫 個人鑑定を申し込む
          <small>初回4,000円｜24h以内に一次返信・匿名OK</small>
        </a>
        <button class="btn-hero-ghost" id="startRitualInline" type="button" aria-label="無料体験をはじめる">
          無料で体験してみる（1分）
        </button>
      </div>

      <ul class="trust-badges" aria-label="安心ポイント">
        <li>初回4,000円</li><li>24時間以内に一次返信</li><li>匿名OK</li>
      </ul>
    </div>

    <!-- BGM（ユーザー操作で開始） -->
    <audio id="bgm" src="assets/sound/temple-ambient.mp3" preload="auto" loop playsinline></audio>
  </section>

  <!-- ========== Social Proof ========== -->
  <section class="proof-band" aria-label="実績">
    <div class="proof-band__in">
      <span class="stars" aria-hidden="true">★★★★★</span>
      <span>満足度 <strong>4.9</strong>／レビュー<strong>128件</strong>／リピーター多数</span>
    </div>
  </section>

  <!-- ========== Ritual ========== -->
  <section id="ritual" class="ritual hidden" aria-live="polite" aria-atomic="true">
    <div class="ritual__glow" aria-hidden="true"></div>
    <p class="ritual__line">星の声が、あなたの言葉に触れる。</p>
    <p class="ritual__line">息を整えて――目を閉じ、一度だけ願いを呼ぶ。</p>
    <p class="ritual__line">いま、展く。詩・韻・祈。</p>
  </section>

  <!-- ========== Main (Tarot) ========== -->
  <main id="main" class="main hidden" aria-labelledby="readingTitle">
    <section class="spread" aria-label="タロット展開">
      <h2 id="readingTitle" class="section__title">詩・韻・祈 の三枚展開</h2>
      <div class="spread__labels" aria-hidden="true">
        <div class="label">詩</div><div class="label">韻</div><div class="label">祈</div>
      </div>

      <div class="spread__cards">
        <div class="card" data-idx="0" aria-label="詩のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card0" role="img" aria-label="詩のカード 表面"></div>
          </div>
        </div>
        <div class="card" data-idx="1" aria-label="韻のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card1" role="img" aria-label="韻のカード 表面"></div>
          </div>
        </div>
        <div class="card" data-idx="2" aria-label="祈のカード">
          <div class="card__inner">
            <div class="card__face card__back"></div>
            <div class="card__face card__front" id="card2" role="img" aria-label="祈のカード 表面"></div>
          </div>
        </div>
      </div>

      <div class="tap-hint" id="tapHint"><div class="tap-hint__pill">カードを順にタップ</div></div>
      <div class="peel" id="peel" aria-hidden="true"></div>
    </section>

    <!-- About -->
    <section class="about section">
      <h3 class="section__title">詩韻祈（しおんき）とは？</h3>
      <p class="about__text">
        あなたの魂がいま必要としている言葉を、<strong>三つの層</strong>で受け取る短詩リーディングです。<br>
        <strong>詩＝核</strong>／<strong>韻＝運び</strong>／<strong>祈＝帰路</strong>。各カードは<strong>二行の詩</strong>として現れ、のちに<strong>九行の総合詩</strong>へと結ばれます。
      </p>
    </section>

    <!-- Reading (2行×3枚) -->
    <section class="reading section" id="reading">
      <h3 class="section__title">詩・韻・祈 のリーディング</h3>
      <div class="reading__grid">
        <article class="reading__item">
          <div class="reading__head">詩（Poem）</div>
          <div class="reading__body" id="body0">カードを開くと、ここに“詩”が現れます。</div>
        </article>
        <article class="reading__item">
          <div class="reading__head">韻（Rhythm）</div>
          <div class="reading__body" id="body1">カードを開くと、ここに“韻”が現れます。</div>
        </article>
        <article class="reading__item">
          <div class="reading__head">祈（Prayer）</div>
          <div class="reading__body" id="body2">カードを開くと、ここに“祈”が現れます。</div>
        </article>
      </div>
      <div id="toSummaryWrap" class="to-summary hidden" aria-hidden="true">
        <button id="toSummaryBtn" class="btn-next" type="button" aria-label="総合詩へ進む">総合詩へ進む（九行）</button>
      </div>
    </section>

    <!-- Summary (九行) -->
    <section class="summary section" id="summary">
      <h3 class="section__title">総合結果 ― つまり、こういうこと。</h3>
      <div class="summary__poem" id="summaryPoem">
        カードをすべて開いて「総合詩へ進む」を押すと、ここに九行のメッセージが現れます。
      </div>
      <p class="closing-line">大丈夫だよ。言葉は、あなたの光だから。</p>
    </section>

    <!-- Next Steps (CTA Tabs) -->
    <section class="next-steps section" id="nextSteps" aria-live="polite" aria-atomic="true">
      <h3 class="section__title">次の一歩 ― 扉は三つ。</h3>
      <p class="next-steps__lead">
        いま開いた言葉を、<strong>どう進めるか</strong>を選べます。おすすめは <strong>「導きを直接受け取る（LINE）」</strong> です。
      </p>
      <nav class="cta-tabs" aria-label="次の一歩">
        <a class="cta-primary cta-link"
           href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener"
           data-cta="line-primary" aria-label="個人鑑定を申し込む（初回4000円）">
          <span class="cta-primary__title">💫 個人鑑定を申し込む</span>
          <span class="cta-primary__sub">初回4,000円｜1対1で今の状況に合わせてお届け</span>
        </a>
        <div class="cta-list">
          <a class="cta-card cta-link" href="#" id="retry" data-cta="retry" aria-label="もう一度占う">
            <span class="cta-card__title">🌌 もう一度占う</span>
            <span class="cta-card__sub">シャッフルからやり直す</span>
          </a>
          <a class="cta-card cta-link" href="shion.html" data-cta="temple" aria-label="詩韻の神殿へ進む">
            <span class="cta-card__title">🌕 神殿へ進む</span>
            <span class="cta-card__sub">世界観と演出を体験</span>
          </a>
          <a class="cta-card cta-link" href="philosophy.html" data-cta="philosophy" aria-label="結果の真意を読む">
            <span class="cta-card__title">🌙 思想を読む</span>
            <span class="cta-card__sub">結果の“意味”を深く知る</span>
          </a>
          <a class="cta-card cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="line-sub" aria-label="LINEで相談する">
            <span class="cta-card__title">💚 LINEで相談</span>
            <span class="cta-card__sub">無料で質問→個別フォロー</span>
          </a>
        </div>
      </nav>
    </section>
  </main>

  <!-- CVモーダル（総合詩の直後に表示） -->
  <div class="cv-pop" id="cvPop" aria-hidden="true" role="dialog" aria-label="個人鑑定のご案内">
    <div class="cv-pop__card">
      <button class="cv-pop__close" aria-label="閉じる">×</button>
      <h3>この言葉を、あなたの現実に。</h3>
      <p>初回<span class="em">4,000円</span>／24h以内に一次返信。匿名OK。</p>
      <a class="btn-hero-primary cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="modal-line">
        💫 個人鑑定を申し込む
        <small>いまの状況に合わせて具体的に導きます</small>
      </a>
    </div>
  </div>

  <!-- Shiopon Dock + Modal -->
  <button id="shiopon-dock" class="shiopon-dock" aria-haspopup="dialog" aria-controls="shiopon-modal">
    <span class="shiopon-dock__face" aria-hidden="true">🦊</span>
    <span class="shiopon-dock__label">しおぽん</span>
  </button>

  <dialog id="shiopon-modal" class="shiopon" aria-labelledby="shiopon-title">
    <form method="dialog" class="shiopon__sheet" role="document">
      <button class="shiopon__close" aria-label="閉じる">×</button>
      <h3 id="shiopon-title" class="shiopon__title">しおぽん相談室</h3>
      <p class="shiopon__lead">「迷ったら、ボクに聞いてほしいの！キラキラ〜☆」</p>
      <a class="shiopon__cta cta-link" href="https://lin.ee/9RBqOl4" target="_blank" rel="noopener" data-cta="shiopon-line">
        💚 LINE登録はこちら
        <small>初回4,000円／24h以内に一次返信・匿名OK</small>
      </a>
      <section class="shiopon__faq" aria-label="Q and A">
        <details class="qa" open>
          <summary>何ができるの？</summary>
          <div>三枚の言葉（詩・韻・祈）を“行動”に変えるサポート。今の状況に合わせて具体化します。</div>
        </details>
        <details class="qa">
          <summary>流れは？匿名OK？</summary>
          <div>LINE登録 → 相談入力 → 日程調整 → 鑑定 → 24hフォロー。匿名OKです。</div>
        </details>
        <details class="qa">
          <summary>料金は？</summary>
          <div>初回4,000円（テキスト中心）。以降は内容に応じてご提案。</div>
        </details>
      </section>
    </form>
  </dialog>

  <!-- オーバーレイ（CTAクリック演出） -->
  <div class="fade-overlay" id="fadeOverlay" aria-hidden="true"></div>

  <!-- 効果音（カード反転） -->
  <audio id="flipSe" src="https://freesound.org/data/previews/351/351408_5665338-lq.mp3" preload="auto"></audio>

  <!-- ========== Scripts ========== -->
  <script>
  // ====== Audio Boot ======
  const bgm = document.getElementById('bgm');
  function kickBgm(){
    try { bgm.volume = 0.55; const p = bgm.play(); if (p && p.catch) p.catch(()=>{}); } catch(e){}
  }

  // ====== Tarot Data ======
  const deck = [
    { name:'The Fool', idx:0, two:['最初の一歩は、恐れよりも軽い風。','失敗は合図――世界は君に開く。'], kw:'始まり' },
    { name:'The Magician', idx:1, two:['意志は手を、言葉は現実を動かす。','足りないものは、すでに君の中にある。'], kw:'創造' },
    { name:'The High Priestess', idx:2, two:['沈黙が真実の輪郭を照らす。','内なる月に、耳を澄ませ。'], kw:'直観' },
    { name:'The Empress', idx:3, two:['優しさは力、受け取ることは創造。','育てたものが、君を育てる。'], kw:'豊穣' },
    { name:'The Emperor', idx:4, two:['迷いは構造で解ける。','境界線は、君を守る城。'], kw:'秩序' },
    { name:'The Hierophant', idx:5, two:['伝統は檻ではなく、梯子。','学びは自由の準備運動。'], kw:'教え' },
    { name:'The Lovers', idx:6, two:['選ぶことは、誰かを愛すること。','愛することは、選び続けること。'], kw:'選択' },
    { name:'The Chariot', idx:7, two:['向かう先が速さを決める。','手綱は心、進路は意志。'], kw:'前進' },
    { name:'Strength', idx:8, two:['優しい力は、世界を従わせない。','それでも、世界は従う。'], kw:'内なる力' },
    { name:'The Hermit', idx:9, two:['独りの灯りが、群衆より遠くを照らす。','探していたのは、探している自分だった。'], kw:'探求' },
    { name:'Wheel of Fortune', idx:10, two:['巡るのは運ではなく、選択。','タイミングは、準備を愛している。'], kw:'転機' },
    { name:'Justice', idx:11, two:['やさしさにも刃がある。','公平さは君と相手を同時に救う。'], kw:'均衡' },
    { name:'The Hanged Man', idx:12, two:['世界を逆さにして、はじめて見える。','止まることが、進むことになる日もある。'], kw:'視点転換' },
    { name:'Death', idx:13, two:['終わりは、名前の違う始まり。','脱皮の痛みは、生きている証。'], kw:'変容' },
    { name:'Temperance', idx:14, two:['混ぜる、待つ、整える。','その中間に、答えは棲む。'], kw:'調和' },
    { name:'The Devil', idx:15, two:['鎖は心の内側に結ばれている。','鍵もまた、内側にある。'], kw:'解放' },
    { name:'The Tower', idx:16, two:['壊れるのは、壊すべきもの。','空いた隙間が、光の通り道。'], kw:'覚醒' },
    { name:'The Star', idx:17, two:['願いは夜の水面で強くなる。','希望は、手を洗うみたいに簡単。'], kw:'希望' },
    { name:'The Moon', idx:18, two:['不安は、想像力の副作用。','曙は、必ず来る。'], kw:'曙光' },
    { name:'The Sun', idx:19, two:['喜びは戦略になる。','笑顔は、未来の先行投資。'], kw:'成功' },
    { name:'Judgement', idx:20, two:['赦すのではない、呼び戻すのだ。','いまの君で、やり直せ。'], kw:'再生' },
    { name:'The World', idx:21, two:['輪は閉じて、道は開く。','完成形は、次のスタートライン。'], kw:'成就' }
  ];

  // ====== Elements ======
  const startBtn   = document.getElementById('startRitualInline');
  const ritualSec  = document.getElementById('ritual');
  const mainSec    = document.getElementById('main');
  const peel       = document.getElementById('peel');
  const tapHint    = document.getElementById('tapHint');
  const readingEl  = document.getElementById('reading');
  const toSummaryWrap = document.getElementById('toSummaryWrap');
  const toSummaryBtn  = document.getElementById('toSummaryBtn');
  const summaryPoem   = document.getElementById('summaryPoem');
  const retryBtn   = document.getElementById('retry');
  const flipSe     = document.getElementById('flipSe');
  const cardEls    = document.querySelectorAll('.card');
  const fronts     = [document.getElementById('card0'), document.getElementById('card1'), document.getElementById('card2')];
  const bodies     = [document.getElementById('body0'), document.getElementById('body1'), document.getElementById('body2')];
  const nextSteps  = document.getElementById('nextSteps');
  const overlay    = document.getElementById('fadeOverlay');

  // ====== State ======
  let selected = [];
  let opened = 0;

  // ====== Helpers ======
  function drawThree(){
    const pool = [...deck];
    const picks = [];
    for(let i=0;i<3;i++){
      const r = crypto.getRandomValues(new Uint32Array(1))[0] % pool.length;
      picks.push(pool.splice(r,1)[0]);
    }
    return picks;
  }

  function resetView(){
    opened = 0;
    bodies[0].textContent = 'カードを開くと、ここに“詩”が現れます。';
    bodies[1].textContent = 'カードを開くと、ここに“韻”が現れます。';
    bodies[2].textContent = 'カードを開くと、ここに“祈”が現れます。';
    readingEl.classList.remove('is-active');
    summaryPoem.textContent = 'カードをすべて開いて「総合詩へ進む」を押すと、ここに九行のメッセージが現れます。';
    tapHint.style.opacity = 1;
    nextSteps.classList.remove('is-on');
    toSummaryWrap.classList.add('hidden');
    cardEls.forEach((el,i)=>{
      el.classList.remove('is-flipped');
      el.style.pointerEvents = 'auto';
      fronts[i].style.backgroundImage = 'var(--front' + i + ')';
    });
  }

  function beginReading(){
    selected = drawThree();
    resetView();
  }

  function beginRitual(){
    kickBgm();
    ritualSec.classList.remove('hidden');
    setTimeout(()=>{
      ritualSec.classList.add('hidden');
      mainSec.classList.remove('hidden');
      peel.classList.add('is-run');
      peel.addEventListener('animationend', ()=> peel.classList.remove('is-run'), {once:true});
      beginReading();
      document.querySelector('.spread').scrollIntoView({behavior:'smooth', block:'start'});
    }, 1100);
  }

  function twoLineText(card){
    return `<span class="line">${card.two[0]}</span><br><span class="line">${card.two[1]}</span>`;
  }

  function buildSummaryPoem(sel){
    const keys = sel.map(c => c.kw);
    const names = sel.map(c => c.name.replace('The ',''));
    const lines = [
      `きみが扉を叩いた瞬間、時間は「味方」に変わった。`,
      `三つの言葉が、同じ方向を指している。`,
      `「${names[0]}」は告げる――${keys[0]}は、心の中心に種を置くこと。`,
      `「${names[1]}」は進めという――${keys[1]}は、迷いを動詞に変えること。`,
      `「${names[2]}」は還れという――${keys[2]}は、光へ戻る手順のこと。`,
      `だから焦らなくていい。速さより、整いを選べばいい。`,
      `君の手の温度が、現実の速度を決めていく。`,
      `結論はやさしい――いまの君で、はじめればいい。`,
      `大丈夫だよ。言葉は、必ず君を連れていく。`
    ];
    return lines.map(l => `<p>${l}</p>`).join('');
  }

  function onFlip(idx){
    const cardEl = cardEls[idx];
    if(cardEl.classList.contains('is-flipped') || opened>=3) return;

    try { flipSe.currentTime = 0; flipSe.play(); } catch(e){}

    const data = selected[idx];
    cardEl.classList.add('is-flipped');
    opened++;

    const label = ['【詩】','【韻】','【祈】'][idx];
    bodies[idx].innerHTML = `<strong>${label}</strong> 《${data.name}》<br>${twoLineText(data)}`;

    if(opened===3){
      tapHint.style.opacity = 0;
      cardEls.forEach(c=> c.style.pointerEvents='none');
      readingEl.classList.add('is-active');
      toSummaryWrap.classList.remove('hidden');
      toSummaryWrap.setAttribute('aria-hidden','false');
    }
  }

  function onToSummary(){
    summaryPoem.innerHTML = buildSummaryPoem(selected);
    document.getElementById('summary').scrollIntoView({behavior:'smooth', block:'start'});
    requestAnimationFrame(()=>{
      nextSteps.classList.add('is-on');
    });
    // 総合詩の直後にCVモーダル
    const pop = document.getElementById('cvPop');
    pop?.setAttribute('aria-hidden','false');
    pop?.querySelector('.cv-pop__close')?.focus();
  }

  function onRetry(e){
    e.preventDefault();
    document.getElementById('hero').scrollIntoView({behavior:'smooth'});
    setTimeout(()=>{ beginReading(); }, 400);
  }

  // CTAクリック演出＋計測
  function trackCTA(label){
    if(typeof gtag !== 'undefined'){
      gtag('event', 'click', {event_category:'CTA', event_label:label, value:1});
    }
    window.dispatchEvent(new CustomEvent('cta_click', { detail:{ label } }));
  }
  function glowAndGo(e){
    const el = e.currentTarget;
    const label = el.getAttribute('data-cta') || 'unknown';
    document.getElementById('fadeOverlay').classList.add('active');
    trackCTA(label);
    setTimeout(()=> document.getElementById('fadeOverlay').classList.remove('active'), 800);
  }

  // ====== Shiopon Modal ======
  (function(){
    const dlg = document.getElementById('shiopon-modal');
    const openBtn = document.getElementById('shiopon-dock');
    const closeBtn = dlg?.querySelector('.shiopon__close');
    if (!dlg || !openBtn || !closeBtn) return;

    let lastActive = null;
    let scrollY = 0;
    const FOCUSABLE = 'a[href], button:not([disabled]), textarea, input, select, summary, [tabindex]:not([tabindex="-1"])';

    function lockScroll(){
      scrollY = window.scrollY || document.documentElement.scrollTop;
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.left = '0';
      document.body.style.right = '0';
      document.body.style.width = '100%';
    }
    function unlockScroll(){
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.left = '';
      document.body.style.right = '';
      document.body.style.width = '';
      window.scrollTo(0, scrollY);
    }

    function open(){
      lastActive = document.activeElement;
      if (typeof dlg.showModal === 'function') dlg.showModal();
      else dlg.setAttribute('open','');
      lockScroll();
      const first = dlg.querySelector(FOCUSABLE);
      first?.focus();
    }
    function close(){
      if (typeof dlg.close === 'function') dlg.close();
      else dlg.removeAttribute('open');
      unlockScroll();
      lastActive?.focus();
    }
    function trapFocus(e){
      if (!dlg.open && !dlg.hasAttribute('open')) return;
      if (e.key !== 'Tab') return;
      const nodes = [...dlg.querySelectorAll(FOCUSABLE)].filter(el => el.offsetParent !== null || el === document.activeElement);
      if (nodes.length === 0) return;
      const first = nodes[0], last = nodes[nodes.length - 1];
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }
    function onBackdropClick(e){
      const rect = dlg.querySelector('.shiopon__sheet')?.getBoundingClientRect();
      if (!rect) return;
      const inPanel = e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom;
      if (!inPanel) close();
    }
    function onEsc(e){ if (e.key === 'Escape') close(); }

    openBtn.addEventListener('click', open);
    closeBtn.addEventListener('click', close);
    dlg.addEventListener('click', onBackdropClick);
    document.addEventListener('keydown', onEsc);
    document.addEventListener('keydown', trapFocus);
    dlg.addEventListener('cancel', (e)=>{ e.preventDefault(); close(); });

    // モーダル内CTA計測
    dlg.querySelectorAll('.cta-link').forEach(a=>{
      a.addEventListener('click', ()=> {
        const label = a.getAttribute('data-cta') || 'unknown';
        if(typeof gtag !== 'undefined'){ gtag('event','click',{event_category:'CTA',event_label:label,value:1}); }
      });
    });
  })();

  // ====== Bindings ======
  window.addEventListener('load', ()=>{
    cardEls.forEach((el)=> el.addEventListener('click', ()=> onFlip(Number(el.dataset.idx)), {passive:true}));
    startBtn.addEventListener('click', beginRitual, {passive:true});
    toSummaryBtn.addEventListener('click', onToSummary, false);
    retryBtn.addEventListener('click', onRetry, false);
    document.querySelectorAll('.cta-link, .mini-cta').forEach(btn=>{
      btn.addEventListener('click', glowAndGo, false);
    });
  });

  // iOS保険（初回タップでBGM起動）
  window.addEventListener('touchstart', function once(){
    kickBgm();
    window.removeEventListener('touchstart', once, {passive:true});
  }, {passive:true, once:true});

  // Heroのサブ“無料体験”からも開始
  document.getElementById('startRitualInline')?.addEventListener('click', beginRitual, {passive:true});

  // CVモーダル 閉じる
  (function(){
    const pop = document.getElementById('cvPop');
    const close = pop?.querySelector('.cv-pop__close');
    close?.addEventListener('click', ()=> pop?.setAttribute('aria-hidden','true'));
    pop?.addEventListener('click', (e)=>{
      const card = pop.querySelector('.cv-pop__card');
      const inPanel = card && e.composedPath().includes(card);
      if(!inPanel) pop.setAttribute('aria-hidden','true');
    });
  })();
  </script>
</body>
</html>
