<!doctype html><html lang="ja"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>コード雨ミニテスト</title>
<style>
  :root{ --sidew: clamp(82px,16vw,180px) }
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{height:100%} body{background:#0b0b1a;color:#eef1ff;font:16px/1.6 system-ui}
  .center{position:relative;z-index:2;display:grid;place-items:center;min-height:100vh;text-align:center}
  .h{font-size:clamp(22px,4vw,32px)}
  /* 左右のコード雨 */
  .codeRain{
    position:fixed;top:0;height:100svh;width:var(--sidew);
    z-index:1;pointer-events:none;opacity:.3;mix-blend-mode:screen;
    -webkit-mask-image:linear-gradient(to right,#000 0%,#000 68%,transparent 98%);
            mask-image:linear-gradient(to right,#000 0%,#000 68%,transparent 98%);
  }
  #codeRainR{
    right:0;left:auto;
    -webkit-mask-image:linear-gradient(to left,#000 0%,#000 68%,transparent 98%);
            mask-image:linear-gradient(to left,#000 0%,#000 68%,transparent 98%);
  }
  @media (max-width:980px){ .codeRain{display:none} }
</style>
</head><body>
<canvas id="codeRainL" class="codeRain"></canvas>
<canvas id="codeRainR" class="codeRain"></canvas>

<div class="center"><div>
  <div class="h">左右に「コード雨」が見えますか？</div>
  <p>見えなければ、配信設定/キャッシュ/パスの問題です。</p>
</div></div>

<script>
(function(){ // 左右コード雨（最小）
  const CHARS='01AI∞詩韻祈魂∴∵◇◆＊＋≡☆★◯●∑ΣΛΩΞΨϕπ≒→←↑↓';
  function run(canvas,side){
    if(!canvas) return;
    const ctx=canvas.getContext('2d'); let W=0,H=0,fs=16,cols=0,drops=[],raf=0;
    function resize(){
      const dpr=Math.min(2,window.devicePixelRatio||1);
      // CSSが効かずclientWidth=0になる環境対策：直指定
      if(!canvas.style.width) canvas.style.width=getComputedStyle(canvas).width||'160px';
      const rect=canvas.getBoundingClientRect();
      const cw=Math.max(80,rect.width|0), ch=Math.max(200,innerHeight|0);
      canvas.width=cw*dpr; canvas.height=ch*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);
      W=cw; H=ch; fs=Math.max(12,Math.min(18,Math.floor(W/14)));
      cols=Math.max(6,Math.floor(W/fs)); drops=new Array(cols).fill((Math.random()*H/fs)|0);
      ctx.clearRect(0,0,W,H);
    }
    function draw(){
      ctx.fillStyle='rgba(0,0,0,.10)'; ctx.fillRect(0,0,W,H);
      ctx.font=`${fs}px ui-monospace,Menlo,Consolas,monospace`;
      for(let i=0;i<cols;i++){
        const edge=i/cols, dist=(side==='L')?edge:(1-edge), alpha=0.55*Math.min(1,Math.max(0,dist));
        ctx.fillStyle=`rgba(127,208,255,${alpha.toFixed(3)})`;
        const ch=CHARS[(Math.random()*CHARS.length)|0];
        const x=i*fs + (Math.random()<.03?1:0), y=drops[i]*fs*0.9;
        ctx.fillText(ch,x,y); if(y>H&&Math.random()>.978) drops[i]=0; drops[i]++;
      }
      raf=requestAnimationFrame(draw);
    }
    addEventListener('resize',resize,{passive:true}); resize(); draw();
  }
  run(document.getElementById('codeRainL'),'L');
  run(document.getElementById('codeRainR'),'R');
})();
</script>
</body></html>
