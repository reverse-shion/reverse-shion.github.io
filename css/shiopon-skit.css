/* =========================
   Shionverse Talk Button (Image Square)
   - Align with #shiopon-toggle (right:22px / bottom:45px)
   - Move with scroll (fixed + scrollY tracking)
   ========================= */

:root{
  /* トグルと同じ座標に合わせる */
  --sv-talk-right: 22px;
  --sv-talk-bottom: 45px;

  /* ★スクロール量（JSが更新する） */
  --sv-scroll-y: 0px;

  /* 正方形サイズ */
  --sv-btn-size: clamp(62px, 9vh, 84px);

  --sv-border: rgba(246, 243, 255, 0.42);
  --sv-glow: rgba(196, 170, 255, 0.34);
  --sv-glow-2: rgba(255, 236, 190, 0.22);

  /* 角丸 */
  --sv-radius: 16px;

  /* 入場アニメ分（readyで0に） */
  --sv-mount-y: 6px;
}

/* =========================
   Mount（位置と追従はここだけ）
   - 「左上固定」対策として top/left を明示的に無効化
   - 「ページと一緒に流れる」= scrollYを打ち消す（*-1）
   ========================= */
.sv-talk-mount{
  position: fixed;
  right: var(--sv-talk-right);
  bottom: var(--sv-talk-bottom);

  /* ★左上に吸われる事故を確実に潰す */
  left: auto !important;
  top: auto !important;

  z-index: 9999;

  opacity: 0;
  pointer-events: none;

  /* ★スクロールで一緒に流れる（fixed + 打ち消し）＋入場分 */
  transform: translate3d(0, calc(var(--sv-scroll-y) * -1 + var(--sv-mount-y)), 0);

  transition: opacity 240ms ease, transform 240ms ease;

  -webkit-transform: translateZ(0);
  will-change: opacity, transform;
}

.sv-talk-mount--ready{
  opacity: 1;
  pointer-events: auto;
  --sv-mount-y: 0px;
}

/* iOS safe-area 対応（右下基準） */
@supports (padding: max(0px)){
  .sv-talk-mount{
    right: calc(var(--sv-talk-right) + env(safe-area-inset-right));
    bottom: calc(var(--sv-talk-bottom) + env(safe-area-inset-bottom));
  }
}

/* =========================
   wrapper
   ========================= */
.sv-talk{
  position: relative;
  display: inline-block;
}

/* =========================
   ボタン本体（画像だけ）
   ========================= */
.sv-talk__btn{
  position: relative;
  display: grid;
  place-items: center;

  width: var(--sv-btn-size);
  height: var(--sv-btn-size);
  aspect-ratio: 1 / 1;

  padding: 0;
  border-radius: var(--sv-radius);
  border: 1px solid var(--sv-border);
  background: rgba(10, 12, 28, 0.55);

  box-shadow:
    0 12px 26px rgba(0,0,0,0.25),
    0 0 0 1px rgba(255,255,255,0.06) inset,
    0 0 18px var(--sv-glow);

  overflow: hidden;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;

  transform-origin: 50% 70%;
  animation: svBreath 3.8s ease-in-out infinite;
}

/* ボタン内の画像 */
.sv-talk__img{
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;

  /* Safari保険 */
  border-radius: var(--sv-radius);
  transform: translateZ(0);
}

/* hover（PC） */
@media (hover:hover){
  .sv-talk__btn:hover{
    border-color: rgba(255, 248, 230, 0.52);
    box-shadow:
      0 14px 30px rgba(0,0,0,0.28),
      0 0 0 1px rgba(255,255,255,0.08) inset,
      0 0 22px var(--sv-glow),
      0 0 18px var(--sv-glow-2);
  }
}

/* Tap / Active */
.sv-talk__btn:active{
  transform: translateY(1px) scale(0.985);
}

/* しずかな“光の波紋” */
.sv-talk__btn::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: var(--sv-radius);
  background: radial-gradient(160px 100px at 35% 50%, rgba(255,255,255,0.18), transparent 72%);
  opacity: 0;
  transform: translateX(-18px);
  transition: opacity 200ms ease, transform 420ms ease;
  pointer-events:none;
}
.sv-talk__btn:active::after{
  opacity: 0.45;
  transform: translateX(18px);
}

/* キーボード操作の可視化 */
.sv-talk__btn:focus-visible{
  outline: 2px solid rgba(255,255,255,0.35);
  outline-offset: 3px;
}

@keyframes svBreath{
  0%, 100%{ transform: translateZ(0) scale(1); }
  50%{ transform: translateZ(0) scale(1.02); }
}

/* =========================
   保険：#svTalkBtn が直置きのページがある場合
   （mountに入ってない構造用）
   ※ mount運用が正なら効かなくてOK
   ========================= */
#svTalkBtn{
  left: auto !important;
  top: auto !important;
}
/* =========================
   iOS Safari “青枠”を消す（タッチ環境のみ）
   ========================= */
@media (hover: none) and (pointer: coarse){
  #sv-skit .sv-overlay-panel:focus,
  #sv-skit .sv-overlay-panel:focus-visible{
    outline: none !important;
    box-shadow: none; /* フォーカスで増える枠も潰す */
  }
}

/* =========================
   Safari特有ゾーン：白チラ / ブラーずれ / タップ
   ========================= */

/* 白チラ：オーバーレイに“最初から”背景色を与える */
#sv-skit .sv-overlay{
  background: rgba(6, 7, 18, 0.30); /* 透明でも“白にならない”土台 */
  -webkit-transform: translateZ(0);
  will-change: opacity, transform;
}

/* ブラーの瞬間ズレ：backdrop-filterの対象を安定させる */
#sv-skit .sv-overlay-backdrop{
  background: rgba(6, 7, 18, 0.36);
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  transform: translateZ(0);
  will-change: backdrop-filter;
}

/* iOSだけタップが“遅く感じる”対策 */
#sv-skit button,
#sv-skit .sv-talk__btn{
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* =========================
   Mobile tuning
   ========================= */
@media (max-width: 420px){
  :root{
    --sv-talk-left: 14px;
    --sv-talk-bottom: 18px;
    --sv-btn-minw: 154px;
    --sv-lumiere-opacity: 0.30;
  }
  .sv-talk__lumiere{
    left: -10px;
  }
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  .sv-talk__btn{ animation: none; }
  .sv-talk__btn::after{ transition: none; }
  .sv-talk-mount{ transition: none; }
}


/* =========================
   Shionverse Stay Button
   「一緒にいる」
   ========================= */

.sv-next-btn{
  position: relative;
  margin: 14px auto 6px;
  padding: 12px 26px;

  font-size: 14px;
  font-weight: 600;
  letter-spacing: .12em;

  color: rgba(255,255,255,.92);
  background:
    radial-gradient(
      120% 140% at 50% 0%,
      rgba(180,200,255,.18),
      rgba(40,50,90,.25) 45%,
      rgba(10,12,28,.55) 100%
    );

  border: 1px solid rgba(200,220,255,.28);
  border-radius: 999px;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  box-shadow:
    0 0 0 rgba(160,180,255,0),
    0 8px 28px rgba(0,0,0,.35);

  cursor: pointer;
  user-select: none;

  transition:
    box-shadow .6s ease,
    border-color .6s ease,
    background .6s ease,
    transform .25s ease;

  animation: sv-stay-breathe 5.5s ease-in-out infinite;
}


/* =========================
   星の光輪
   ========================= */
.sv-next-btn::before{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:999px;

  background:
    radial-gradient(
      circle at 50% 50%,
      rgba(200,220,255,.35),
      rgba(120,140,255,.18) 35%,
      rgba(80,100,200,.08) 55%,
      transparent 70%
    );

  opacity:.55;
  filter: blur(10px);
  pointer-events:none;

  animation: sv-halo-pulse 4.8s ease-in-out infinite;
}


/* =========================
   星粒（きらきら）
   ========================= */
.sv-next-btn::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:999px;

  background-image:
    radial-gradient(1px 1px at 18% 30%, rgba(255,255,255,.7), transparent),
    radial-gradient(1px 1px at 42% 68%, rgba(200,220,255,.8), transparent),
    radial-gradient(1px 1px at 65% 22%, rgba(220,200,255,.6), transparent),
    radial-gradient(1px 1px at 78% 55%, rgba(180,200,255,.7), transparent),
    radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.5), transparent);

  opacity:.65;
  pointer-events:none;

  animation: sv-star-twinkle 6.5s linear infinite;
}


/* =========================
   Hover / Active
   ========================= */
.sv-next-btn:hover{
  border-color: rgba(220,235,255,.55);
  box-shadow:
    0 0 18px rgba(180,200,255,.35),
    0 10px 32px rgba(0,0,0,.4);
}

.sv-next-btn:active{
  transform: translateY(1px);
}


/* =========================
   Focus（優しく）
   ========================= */
.sv-next-btn:focus-visible{
  outline:none;
  box-shadow:
    0 0 0 2px rgba(200,220,255,.55),
    0 0 22px rgba(160,180,255,.45);
}


/* =========================
   Animations
   ========================= */
@keyframes sv-stay-breathe{
  0%,100%{
    box-shadow:
      0 0 0 rgba(160,180,255,0),
      0 8px 28px rgba(0,0,0,.35);
  }
  50%{
    box-shadow:
      0 0 22px rgba(160,180,255,.35),
      0 12px 34px rgba(0,0,0,.45);
  }
}

@keyframes sv-halo-pulse{
  0%,100%{ opacity:.45; }
  50%{ opacity:.75; }
}

@keyframes sv-star-twinkle{
  0%{ opacity:.35; }
  50%{ opacity:.8; }
  100%{ opacity:.35; }
}

