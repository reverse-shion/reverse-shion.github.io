/* =========================
   Shionverse Talk Button (Image Square)
   - Align with #shiopon-toggle (right:22px / bottom:45px)
   - Move with scroll (fixed + scrollY tracking)
   ========================= */

:root{
  /* トグルと同じ座標に合わせる */
  --sv-talk-right: 22px;
  --sv-talk-bottom: 45px;

  /* ★スクロール量（JSが更新する） */
  --sv-scroll-y: 0px;

  /* 正方形サイズ */
  --sv-btn-size: clamp(62px, 9vh, 84px);

  --sv-border: rgba(246, 243, 255, 0.42);
  --sv-glow: rgba(196, 170, 255, 0.34);
  --sv-glow-2: rgba(255, 236, 190, 0.22);

  /* 角丸 */
  --sv-radius: 16px;

  /* 入場アニメ分（readyで0に） */
  --sv-mount-y: 6px;
}

/* =========================
   Mount（位置と追従はここだけ）
   - 「左上固定」対策として top/left を明示的に無効化
   - 「ページと一緒に流れる」= scrollYを打ち消す（*-1）
   ========================= */
.sv-talk-mount{
  position: fixed;
  right: var(--sv-talk-right);
  bottom: var(--sv-talk-bottom);

  /* ★左上に吸われる事故を確実に潰す */
  left: auto !important;
  top: auto !important;

  z-index: 9999;

  opacity: 0;
  pointer-events: none;

  /* ★スクロールで一緒に流れる（fixed + 打ち消し）＋入場分 */
  transform: translate3d(0, calc(var(--sv-scroll-y) * -1 + var(--sv-mount-y)), 0);

  transition: opacity 240ms ease, transform 240ms ease;

  -webkit-transform: translateZ(0);
  will-change: opacity, transform;
}

.sv-talk-mount--ready{
  opacity: 1;
  pointer-events: auto;
  --sv-mount-y: 0px;
}

/* iOS safe-area 対応（右下基準） */
@supports (padding: max(0px)){
  .sv-talk-mount{
    right: calc(var(--sv-talk-right) + env(safe-area-inset-right));
    bottom: calc(var(--sv-talk-bottom) + env(safe-area-inset-bottom));
  }
}

/* =========================
   wrapper
   ========================= */
.sv-talk{
  position: relative;
  display: inline-block;
}

/* =========================
   ボタン本体（画像だけ）
   ========================= */
.sv-talk__btn{
  position: relative;
  display: grid;
  place-items: center;

  width: var(--sv-btn-size);
  height: var(--sv-btn-size);
  aspect-ratio: 1 / 1;

  padding: 0;
  border-radius: var(--sv-radius);
  border: 1px solid var(--sv-border);
  background: rgba(10, 12, 28, 0.55);

  box-shadow:
    0 12px 26px rgba(0,0,0,0.25),
    0 0 0 1px rgba(255,255,255,0.06) inset,
    0 0 18px var(--sv-glow);

  overflow: hidden;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;

  transform-origin: 50% 70%;
  animation: svBreath 3.8s ease-in-out infinite;
}

/* ボタン内の画像 */
.sv-talk__img{
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;

  /* Safari保険 */
  border-radius: var(--sv-radius);
  transform: translateZ(0);
}

/* hover（PC） */
@media (hover:hover){
  .sv-talk__btn:hover{
    border-color: rgba(255, 248, 230, 0.52);
    box-shadow:
      0 14px 30px rgba(0,0,0,0.28),
      0 0 0 1px rgba(255,255,255,0.08) inset,
      0 0 22px var(--sv-glow),
      0 0 18px var(--sv-glow-2);
  }
}

/* Tap / Active */
.sv-talk__btn:active{
  transform: translateY(1px) scale(0.985);
}

/* しずかな“光の波紋” */
.sv-talk__btn::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: var(--sv-radius);
  background: radial-gradient(160px 100px at 35% 50%, rgba(255,255,255,0.18), transparent 72%);
  opacity: 0;
  transform: translateX(-18px);
  transition: opacity 200ms ease, transform 420ms ease;
  pointer-events:none;
}
.sv-talk__btn:active::after{
  opacity: 0.45;
  transform: translateX(18px);
}

/* キーボード操作の可視化 */
.sv-talk__btn:focus-visible{
  outline: 2px solid rgba(255,255,255,0.35);
  outline-offset: 3px;
}

@keyframes svBreath{
  0%, 100%{ transform: translateZ(0) scale(1); }
  50%{ transform: translateZ(0) scale(1.02); }
}

/* =========================
   保険：#svTalkBtn が直置きのページがある場合
   （mountに入ってない構造用）
   ※ mount運用が正なら効かなくてOK
   ========================= */
#svTalkBtn{
  left: auto !important;
  top: auto !important;
}
