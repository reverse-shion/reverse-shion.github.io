<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>詩韻 Shion | あなたの運命の詩</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overscroll-behavior:none}
body{font-family:'Noto Serif JP',serif;background:#000;color:#eaf0ff}

/* ===== 1画面：タイトル＋カード ===== */
.hero{
  position:relative;width:100%;height:100svh;overflow:hidden;
  display:grid;grid-template-rows: 1fr auto 1fr;justify-items:center;align-items:center;
}
.bg{
  position:absolute;inset:0;z-index:0;
  background:url('temple-door.jpg') center/cover no-repeat;opacity:.65;transform:scale(1.06)
}
.bg::after{
  content:"";position:absolute;inset:0;mix-blend-mode:screen;pointer-events:none;
  /* 1. 光の輪がゆっくり広がるように調整 */
  background:radial-gradient(40% 40% at 50% 50%,
    rgba(255,230,160,.60) 0%,
    rgba(174,138,255,.40) 20%,
    rgba(0,0,0,0) 45%);
  animation:glow 10s ease-in-out infinite alternate
}
@keyframes glow{
  0%{opacity:.8;transform:scale(1.0);background-size:100% 100%}
  100%{opacity:.6;transform:scale(1.2);background-size:150% 150%}
}

.title-wrap{z-index:2;display:flex;flex-direction:column;align-items:center;gap:8px;opacity:0}
.title{
  font-size:clamp(28px,7vw,56px);letter-spacing:.12em;
  background:linear-gradient(92deg,#FFE7A6 0%,#FFD76F 35%,#EEC35A 55%,#FFF5CF 75%,#FFD76F 100%);
  -webkit-background-clip:text;background-clip:text;color:transparent;
  text-shadow:0 0 18px rgba(255,215,111,.55),0 0 36px rgba(174,138,255,.35)
}
.subtitle{font-size:clamp(14px,3.5vw,18px);color:#d9e6ff;opacity:.9;text-shadow:0 0 10px rgba(255,255,255,.35)}
@keyframes fadeIn{to{opacity:1;transform:none}}

.spread{
  z-index:2;display:flex;gap:clamp(12px,3vw,22px);justify-content:center;align-items:center;
  width:min(92vw,900px);padding:clamp(6px,2vw,10px);opacity:0;transform:translateY(10px)
}
@keyframes fadeUp{to{opacity:1;transform:none}}
.card{
  width:clamp(100px,22vw,150px);aspect-ratio:62/110;perspective:1100px;position:relative;cursor:pointer;flex:0 0 auto
}
.card__inner{
  width:100%;height:100%;position:relative;border-radius:12px;overflow:hidden;
  transition:transform .68s cubic-bezier(.2,.7,.2,1);transform-style:preserve-3d;
  box-shadow:0 10px 30px rgba(0,0,0,.45),0 0 20px rgba(255,215,111,.18)
}
.card__face{position:absolute;inset:0;backface-visibility:hidden;border-radius:12px;background-position:center;background-size:cover}
.card__back{background-image:var(--card-back, url('back.png'));background-color:#0b0f18}
.card__front{transform:rotateY(180deg);background-color:#0f1426}
.card.is-flipped .card__inner{transform:rotateY(180deg)}

.labels{z-index:2;display:flex;gap:clamp(16px,6vw,40px);opacity:0;transform:translateY(8px)}
.label{width:clamp(100px,22vw,150px);text-align:center;color:#cfe2ff;font-size:clamp(12px,3vw,14px);letter-spacing:.12em;text-shadow:0 0 10px rgba(174,138,255,.45)}

/* ヒント */
.tap-hint{
  position:absolute;left:0;right:0;bottom:14px;z-index:3;display:flex;justify-content:center;opacity:0
}
.tap-hint__pill{
  font-size:14px;padding:10px 16px;border-radius:999px;border:1px solid rgba(255,215,111,.6);
  background:rgba(0,0,0,.35);color:#ffe7a6;letter-spacing:.08em;
  box-shadow:0 0 16px rgba(255,215,111,.28), inset 0 0 12px rgba(255,215,111,.12);
  backdrop-filter: blur(6px);animation:blink 1.6s ease-in-out infinite
}
@keyframes blink{50%{opacity:.55}}

/* ===== 捲れ演出（カードめくり） ===== */
.peel{position:absolute;inset:0;z-index:4;pointer-events:none;opacity:0}
.peel.is-run{
  background:
    radial-gradient(120% 120% at 0% 0%, #fff 0%, #f7e9c4 35%, #e8d08a 55%, rgba(255,255,255,0) 56%) no-repeat,
    linear-gradient(#111,#000);
  background-size:0% 0%,100% 100%;
  mix-blend-mode:screen;
  animation:peelOpen 950ms ease forwards
}
@keyframes peelOpen{
  0%{opacity:0;background-size:0% 0%,100% 100%}
  10%{opacity:1}
  60%{background-size:180% 180%,100% 100%}
  100%{opacity:0;background-size:180% 180%,100% 100%}
}

/* ===== 下段：リーディング＋タブ ===== */
.section{
  padding:48px 18px;max-width:980px;margin:0 auto;background:
    linear-gradient(180deg, rgba(8,10,18,1) 0%, rgba(10,12,20,.9) 100%);
  border-top:1px solid rgba(255,255,255,.06);
  visibility:hidden; /* 初期状態では非表示 */
  opacity:0;
  transition:opacity 1s ease-out;
}
.section.is-active{
  visibility:visible; /* アクティブになったら表示 */
  opacity:1;
}

.section h2{font-weight:700;font-size:22px;letter-spacing:.08em;color:#ffd76f;margin-bottom:14px}
.reading-grid{display:grid;gap:14px}
.reading{
  background:rgba(127,208,255,.08);border:1px solid rgba(127,208,255,.25);
  border-radius:12px;padding:14px;min-height:82px;
}
.reading .head{color:#cfe2ff;font-size:13px;letter-spacing:.18em;margin-bottom:6px}
.reading .body{line-height:1.75}

.tabs{
  margin-top:22px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px
}
.tab{
  display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:12px;
  border:1px solid rgba(255,215,111,.5);color:#ffe7a6;text-decoration:none;
  background:rgba(0,0,0,.35);box-shadow:0 0 16px rgba(255,215,111,.15), inset 0 0 12px rgba(255,215,111,.08);
  transition:transform .15s, box-shadow .2s
}
.tab:active{transform:translateY(1px)}
@media (min-width:680px){.tabs{grid-template-columns:repeat(4,1fr)}}
</style>
</head>
<body>

<section class="hero" id="hero">
  <div class="bg" aria-hidden="true"></div>

  <div class="title-wrap" id="titleWrap">
    <h1 class="title">タロット展開</h1>
    <p class="subtitle">あなたの運命の詩</p>
  </div>

  <div class="spread" id="spread" aria-hidden="true">
    <div class="card" data-idx="0" aria-label="詩">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card0"></div>
      </div>
    </div>
    <div class="card" data-idx="1" aria-label="韻">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card1"></div>
      </div>
    </div>
    <div class="card" data-idx="2" aria-label="祈">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card2"></div>
      </div>
    </div>
  </div>

  <div class="labels" id="labels" aria-hidden="true" style="opacity:0;transform:translateY(8px)">
    <div class="label">詩</div>
    <div class="label">韻</div>
    <div class="label">祈</div>
  </div>

  <div class="tap-hint" id="tapHint"><div class="tap-hint__pill">画面をタップして開く</div></div>

  <div class="peel" id="peel" aria-hidden="true"></div>
</section>

<section class="section" id="reading">
  <h2>詩・韻・祈 のリーディング</h2>
  <div class="reading-grid">
    <div class="reading" id="read0">
      <div class="head">詩</div>
      <div class="body" id="body0">カードを開くと、ここに“詩”が現れます。</div>
    </div>
    <div class="reading" id="read1">
      <div class="head">韻</div>
      <div class="body" id="body1">カードを開くと、ここに“韻”が現れます。</div>
    </div>
    <div class="reading" id="read2">
      <div class="head">祈</div>
      <div class="body" id="body2">カードを開くと、ここに“祈”が現れます。</div>
    </div>
  </div>

  <nav class="tabs" aria-label="次のアクション">
    <a class="tab" href="#" id="retry">もう一度占う</a>
    <a class="tab" href="https://line.me/" target="_blank" rel="noopener">個人鑑定</a>
    <a class="tab" href="https://example.com/shiin-shisou" target="_blank" rel="noopener">詩韻思想</a>
    <a class="tab" href="https://example.com/shion" target="_blank" rel="noopener">Shion</a>
  </nav>
</section>

<script>
/* ===== データ ===== */
const cardFrontImages = [
  'card-front-0.jpg','card-front-1.jpg','card-front-2.jpg','card-front-3.jpg',
  'card-front-4.jpg','card-front-5.jpg','card-front-6.jpg','card-front-7.jpg',
  'card-front-8.jpg','card-front-9.jpg','card-front-10.jpg','card-front-11.jpg',
  'card-front-12.jpg','card-front-13.jpg','card-front-14.jpg','card-front-15.jpg',
  'card-front-16.jpg','card-front-17.jpg','card-front-18.jpg','card-front-19.jpg',
  'card-front-20.jpg','card-front-21.jpg'
];

// ===== Major Arcana (Re:Verse Shion | Upright only, Philosophy-integrated) =====
const majorArcana = [
  {
    name:'The Fool',
    tagline:'はじまりの息を吸う',
    compass:'未知へ踏み出す勇気',
    trigger:'「まず一歩」を決める',
    route:'軽やかに試す→観察→調整',
    step:'今日、5分だけ新しい行動を試す',
    verse:'私は好奇心で道をつくる',
    shion:{poem:'無垢は形', rhyme:'息は響き', prayer:'選ぶたび還る'},
    imageIndex:0
  },
  {
    name:'The Magician',
    tagline:'意志を現実に結線する',
    compass:'資質と道具を束ねる',
    trigger:'目的を一文に定義',
    route:'意図→可視化→小実験',
    step:'目的を「一行宣言」で書く',
    verse:'私の言は世界を結ぶ',
    shion:{poem:'意志は型', rhyme:'集中は響', prayer:'成果は祈り'},
    imageIndex:1
  },
  {
    name:'The High Priestess',
    tagline:'静かな確信を聴く',
    compass:'直感と沈黙のバランス',
    trigger:'ノイズを3つ減らす',
    route:'内観→兆し→待つ勇気',
    step:'5分黙想して心のメモを1行',
    verse:'沈黙が答えを浮かべる',
    shion:{poem:'月は形', rhyme:'気配は響', prayer:'受容は祈り'},
    imageIndex:2
  },
  {
    name:'The Empress',
    tagline:'育てる歓びが富を呼ぶ',
    compass:'豊かさ＝関係の循環',
    trigger:'整える・温める・与える',
    route:'土台づくり→小収穫',
    step:'自分と誰かへ1つ手厚く',
    verse:'私は育て、育てられる',
    shion:{poem:'実りは形', rhyme:'ぬくもりは響', prayer:'感謝は祈り'},
    imageIndex:3
  },
  {
    name:'The Emperor',
    tagline:'枠を決めると自由が増える',
    compass:'秩序＝優しさの器',
    trigger:'ルールを3つだけ作る',
    route:'方針→優先→実行',
    step:'明日のToDoを3点に削る',
    verse:'境界は守り、道を拓く',
    shion:{poem:'器は形', rhyme:'規律は響', prayer:'責任は祈り'},
    imageIndex:4
  },
  {
    name:'The Hierophant',
    tagline:'伝統の梯子で次の段へ',
    compass:'学ぶ→伝えるの循環',
    trigger:'師と書を一つ選ぶ',
    route:'模倣→理解→自分語',
    step:'1つ教わり1つ誰かに渡す',
    verse:'知は手渡すほど澄む',
    shion:{poem:'教えは形', rhyme:'継承は響', prayer:'祈念は祈り'},
    imageIndex:5
  },
  {
    name:'The Lovers',
    tagline:'選ぶとは、結ぶこと',
    compass:'価値観の合意と誠実',
    trigger:'「何を大切にするか」を言語化',
    route:'対話→合意→共創',
    step:'大切にする3語を相手と共有',
    verse:'私は選び、選ばれて進む',
    shion:{poem:'誓いは形', rhyme:'共鳴は響', prayer:'愛は祈り'},
    imageIndex:6
  },
  {
    name:'The Chariot',
    tagline:'意志の手綱を握る',
    compass:'集中と牽引',
    trigger:'障害を1つだけ突破',
    route:'一点突破→前進の維持',
    step:'今日の最難関を最初に片づける',
    verse:'私の進路は私が決める',
    shion:{poem:'推進は形', rhyme:'速度は響', prayer:'勝利は祈り'},
    imageIndex:7
  },
  {
    name:'Strength',
    tagline:'優しさは最強の力',
    compass:'受容＋境界＝芯',
    trigger:'自分を労わるルーチン',
    route:'自己対話→小さな勇気',
    step:'否定語を一つ言い換える',
    verse:'柔らかさで獅子を撫でる',
    shion:{poem:'慈愛は形', rhyme:'息の整いは響', prayer:'勇気は祈り'},
    imageIndex:8
  },
  {
    name:'The Hermit',
    tagline:'ひとりの灯で群れを照らす',
    compass:'内省→洞察→指標',
    trigger:'静かな時間を確保',
    route:'問いを磨く→核心を拾う',
    step:'今日の学びを一言記録',
    verse:'孤独は知を熟す窯',
    shion:{poem:'灯は形', rhyme:'省察は響', prayer:'導きは祈り'},
    imageIndex:9
  },
  {
    name:'Wheel of Fortune',
    tagline:'巡りは味方にもなる',
    compass:'波に乗る準備',
    trigger:'流れのサインを3つ観測',
    route:'来た球を打つ→微修正',
    step:'偶然の誘いに一度乗ってみる',
    verse:'変化の輪に呼吸を合わせる',
    shion:{poem:'巡りは形', rhyme:'タイミングは響', prayer:'受容は祈り'},
    imageIndex:10
  },
  {
    name:'Justice',
    tagline:'整えるほど軽くなる',
    compass:'公平・整頓・明瞭',
    trigger:'事実と解釈を分ける',
    route:'基準→判断→調整',
    step:'机or心の「一箇所」だけ整える',
    verse:'真実は静かな音で鳴る',
    shion:{poem:'秤は形', rhyme:'均衡は響', prayer:'是正は祈り'},
    imageIndex:11
  },
  {
    name:'The Hanged Man',
    tagline:'視点が変わると救いが来る',
    compass:'保留の中の洞察',
    trigger:'あえて立ち止まる',
    route:'逆視点→気づき→解放',
    step:'困りごとを相手視点で一行化',
    verse:'止まる勇気が運命を動かす',
    shion:{poem:'静止は形', rhyme:'反転は響', prayer:'赦しは祈り'},
    imageIndex:12
  },
  {
    name:'Death',
    tagline:'終わりは始まりの条件',
    compass:'手放し→余白→再誕',
    trigger:'古い習慣を一つ卒業',
    route:'完了宣言→リスタート',
    step:'不要ファイル/感情を1つ捨てる',
    verse:'私は終わらせ、始めなおす',
    shion:{poem:'変容は形', rhyme:'別れは響', prayer:'再生は祈り'},
    imageIndex:13
  },
  {
    name:'Temperance',
    tagline:'混ぜ合わせて美を作る',
    compass:'バランス運用',
    trigger:'足し引きの最適化',
    route:'配合→検証→微調整',
    step:'作業25分/休憩5分を2セット',
    verse:'調和は流れる技術',
    shion:{poem:'配合は形', rhyme:'中庸は響', prayer:'整いは祈り'},
    imageIndex:14
  },
  {
    name:'The Devil',
    tagline:'魅了の鎖を見抜く',
    compass:'欲と恐れの正体',
    trigger:'依存を言語化して距離を置く',
    route:'気づき→置換→自由',
    step:'誘惑トリガーを1つ環境から外す',
    verse:'欲は光にも闇にもなる',
    shion:{poem:'鎖は形', rhyme:'執着は響', prayer:'自制は祈り'},
    imageIndex:15
  },
  {
    name:'The Tower',
    tagline:'崩れて見えた本当の基礎',
    compass:'偽りの前提の刷新',
    trigger:'「当たり前」を疑う',
    route:'破断→再設計→耐震化',
    step:'今の前提を一つ検証し直す',
    verse:'壊れた壁の向こうが空',
    shion:{poem:'落雷は形', rhyme:'真相は響', prayer:'再建は祈り'},
    imageIndex:16
  },
  {
    name:'The Star',
    tagline:'静かな希望が体力を戻す',
    compass:'回復・補水・夢の再接続',
    trigger:'小さな願いの再起動',
    route:'癒し→微光→継続',
    step:'就寝前に「今日の良かった」を2つ',
    verse:'希望は喉を潤す水',
    shion:{poem:'星は形', rhyme:'憧れは響', prayer:'祈望は祈り'},
    imageIndex:17
  },
  {
    name:'The Moon',
    tagline:'曖昧さと賢く付き合う',
    compass:'不安＝情報不足',
    trigger:'検証と保留の区別',
    route:'仮説→小実験→確度UP',
    step:'気がかりを3つ言語化し検証案を書く',
    verse:'影もまた道を示す',
    shion:{poem:'霧は形', rhyme:'勘は響', prayer:'安堵は祈り'},
    imageIndex:18
  },
  {
    name:'The Sun',
    tagline:'祝福の力で前へ',
    compass:'可視化・共有・祝う',
    trigger:'成果を皆で見える化',
    route:'発表→称賛→次の挑戦',
    step:'今日の進捗を写真or一文で共有',
    verse:'喜びは推進力だ',
    shion:{poem:'陽は形', rhyme:'明朗は響', prayer:'感謝は祈り'},
    imageIndex:19
  },
  {
    name:'Judgement',
    tagline:'呼び名に応える',
    compass:'過去の意味づけを更新',
    trigger:'古い自責を解く',
    route:'再評価→赦し→使命',
    step:'「もう要らない後悔」を紙に書いて破る',
    verse:'私は呼ばれ、いま立つ',
    shion:{poem:'喇叭は形', rhyme:'再起は響', prayer:'赦しは祈り'},
    imageIndex:20
  },
  {
    name:'The World',
    tagline:'一周まわって自由になる',
    compass:'統合と完成',
    trigger:'循環を祝って次の章へ',
    route:'成果の束ね→次の地図',
    step:'終えたことを3つ列挙し自分を讃える',
    verse:'輪は扉、終わりは門出',
    shion:{poem:'円環は形', rhyme:'調和は響', prayer:'祝福は祈り'},
    imageIndex:21
  }
];
/* ===== 要素群 ===== */
const titleWrap = document.getElementById('titleWrap');
const peel      = document.getElementById('peel');
const spread    = document.getElementById('spread');
const labels    = document.getElementById('labels');
const tapHint   = document.getElementById('tapHint');
const readingEl = document.getElementById('reading');
const cardElements = document.querySelectorAll('.card');
const cardFronts = document.querySelectorAll('.card__front');
const cardInners = document.querySelectorAll('.card__inner');
const bodies = [document.getElementById('body0'), document.getElementById('body1'), document.getElementById('body2')];
const defaultBodies = ['カードを開くと、ここに“詩”が現れます。', 'カードを開くと、ここに“韻”が現れます。', 'カードを開くと、ここに“祈”が現れます。'];


/* ===== 状態管理と初期化 ===== */
let selectedCards = []; // 抽選結果
let revealedCount = 0; // めくられたカードの数

function initialize(){
  // 抽選
  selectedCards = [];
  const majorArcanaCopy = [...majorArcana];
  while(selectedCards.length<3){
    const randIndex = Math.floor(Math.random()*majorArcanaCopy.length);
    selectedCards.push(majorArcanaCopy.splice(randIndex, 1)[0]);
  }
  revealedCount = 0;
  
  // 状態のリセット
  readingEl.classList.remove('is-active');
  tapHint.style.opacity = 1;
  
  cardElements.forEach((card, i) => {
    card.classList.remove('is-flipped');
    card.style.pointerEvents = 'auto'; // タップを有効化
    cardFronts[i].style.backgroundImage = 'none'; // 表面画像を削除
    bodies[i].innerHTML = defaultBodies[i]; // リーディング結果をリセット
  });
  
  // 初回ロード時のみ実行
  if(initialize.isFirstRun){
    window.addEventListener('load', runInitialSequence);
    document.getElementById('retry').addEventListener('click', retry, { passive: false });
    cardElements.forEach(c=>{
      c.addEventListener('click', () => flipCard(Number(c.dataset.idx)), { passive:true });
    });
    initialize.isFirstRun = false;
  }
}
initialize.isFirstRun = true;

/* ===== 初回出現シーケンス ===== */
function runInitialSequence(){
  // 1) タイトル表示
  titleWrap.style.animation = 'fadeIn .9s ease .4s forwards';
  // 2) 1.5秒後：捲れ演出→カード自動出現（光とともに）
  setTimeout(() => {
    peel.classList.add('is-run');
    peel.addEventListener('animationend', () => {
      peel.classList.remove('is-run');
      spread.style.animation = 'fadeUp .6s ease forwards';
      labels.style.animation = 'fadeUp .6s ease .06s forwards';
      spread.removeAttribute('aria-hidden'); labels.removeAttribute('aria-hidden');
      tapHint.style.opacity = 1; // ヒント表示
    }, { once:true });
  }, 1500);
}

/* ===== カードめくり（要件2） ===== */
function flipCard(idx){
  const card = cardElements[idx];
  if(card.classList.contains('is-flipped') || revealedCount >= 3) return;

  const data = selectedCards[idx];
  const reversed = Math.random() < 0.5;
  const labelMap = ['詩','韻','祈'];

  // 表面画像セット
  cardFronts[idx].style.backgroundImage = `url('${cardFrontImages[data.imageIndex]}')`;
  
  // めくりアニメーション開始
  card.classList.add('is-flipped');
  revealedCount++;
  
  // 完了後の処理
  const handleFlipEnd = () => {
    // リーディング結果の反映
    bodies[idx].innerHTML = `**【${labelMap[idx]}】**<br>《${data.name}》${reversed?'（逆位置）':'（正位置）'}<br>${reversed?data.reversed:data.upright}`;

    if(revealedCount === 3){
      // 3枚全てめくられた
      tapHint.style.opacity = 0; // ヒントを消す
      cardElements.forEach(c => c.style.pointerEvents = 'none'); // カードをタップ不可に
      
      // リーディング結果を表示してスクロール
      readingEl.classList.add('is-active');
      readingEl.scrollIntoView({ behavior:'smooth', block:'start' });
    }
    cardInners[idx].removeEventListener('transitionend', handleFlipEnd);
  };
  
  // トランジション（めくりアニメーション）終了を待つ
  cardInners[idx].addEventListener('transitionend', handleFlipEnd, { once: true });
}

/* ===== もう一度占う（要件3） ===== */
function retry(e){
  e.preventDefault();
  
  // ヒーローセクションまでスクロール
  hero.scrollIntoView({ behavior:'smooth', block:'start' });
  
  // スクロール完了を待ってリセット
  // (スクロール時間を見込んで固定時間待つか、IntersectionObserverを使う方法があるが、ここでは簡略化のため固定時間で待つ)
  setTimeout(() => {
    initialize();
  }, 700); 
}

// 初回実行
initialize();
</script>
</body>
</html>
