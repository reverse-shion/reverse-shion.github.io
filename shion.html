<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>詩韻 Shion | あなたの運命の詩</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overscroll-behavior:none}
body{font-family:'Noto Serif JP',serif;background:#000;color:#eaf0ff}

/* ===== 1画面：タイトル＋カード ===== */
.hero{
  position:relative;width:100%;height:100svh;overflow:hidden;
  display:grid;grid-template-rows: 1fr auto 1fr;justify-items:center;align-items:center;
}
.bg{
  position:absolute;inset:0;z-index:0;
  background:url('temple-door.jpg') center/cover no-repeat;opacity:.65;transform:scale(1.06)
}
.bg::after{
  content:"";position:absolute;inset:0;mix-blend-mode:screen;pointer-events:none;
  /* 1. 光の輪がゆっくり広がるように調整 */
  background:radial-gradient(40% 40% at 50% 50%,
    rgba(255,230,160,.60) 0%,
    rgba(174,138,255,.40) 20%,
    rgba(0,0,0,0) 45%);
  animation:glow 10s ease-in-out infinite alternate
}
@keyframes glow{
  0%{opacity:.8;transform:scale(1.0);background-size:100% 100%}
  100%{opacity:.6;transform:scale(1.2);background-size:150% 150%}
}

.title-wrap{z-index:2;display:flex;flex-direction:column;align-items:center;gap:8px;opacity:0}
.title{
  font-size:clamp(28px,7vw,56px);letter-spacing:.12em;
  background:linear-gradient(92deg,#FFE7A6 0%,#FFD76F 35%,#EEC35A 55%,#FFF5CF 75%,#FFD76F 100%);
  -webkit-background-clip:text;background-clip:text;color:transparent;
  text-shadow:0 0 18px rgba(255,215,111,.55),0 0 36px rgba(174,138,255,.35)
}
.subtitle{font-size:clamp(14px,3.5vw,18px);color:#d9e6ff;opacity:.9;text-shadow:0 0 10px rgba(255,255,255,.35)}
@keyframes fadeIn{to{opacity:1;transform:none}}

.spread{
  z-index:2;display:flex;gap:clamp(12px,3vw,22px);justify-content:center;align-items:center;
  width:min(92vw,900px);padding:clamp(6px,2vw,10px);opacity:0;transform:translateY(10px)
}
@keyframes fadeUp{to{opacity:1;transform:none}}
.card{
  width:clamp(100px,22vw,150px);aspect-ratio:62/110;perspective:1100px;position:relative;cursor:pointer;flex:0 0 auto
}
.card__inner{
  width:100%;height:100%;position:relative;border-radius:12px;overflow:hidden;
  transition:transform .68s cubic-bezier(.2,.7,.2,1);transform-style:preserve-3d;
  box-shadow:0 10px 30px rgba(0,0,0,.45),0 0 20px rgba(255,215,111,.18)
}
.card__face{position:absolute;inset:0;backface-visibility:hidden;border-radius:12px;background-position:center;background-size:cover}
.card__back{background-image:var(--card-back, url('back.png'));background-color:#0b0f18}
.card__front{transform:rotateY(180deg);background-color:#0f1426}
.card.is-flipped .card__inner{transform:rotateY(180deg)}

.labels{z-index:2;display:flex;gap:clamp(16px,6vw,40px);opacity:0;transform:translateY(8px)}
.label{width:clamp(100px,22vw,150px);text-align:center;color:#cfe2ff;font-size:clamp(12px,3vw,14px);letter-spacing:.12em;text-shadow:0 0 10px rgba(174,138,255,.45)}

/* ヒント */
.tap-hint{
  position:absolute;left:0;right:0;bottom:14px;z-index:3;display:flex;justify-content:center;opacity:0
}
.tap-hint__pill{
  font-size:14px;padding:10px 16px;border-radius:999px;border:1px solid rgba(255,215,111,.6);
  background:rgba(0,0,0,.35);color:#ffe7a6;letter-spacing:.08em;
  box-shadow:0 0 16px rgba(255,215,111,.28), inset 0 0 12px rgba(255,215,111,.12);
  backdrop-filter: blur(6px);animation:blink 1.6s ease-in-out infinite
}
@keyframes blink{50%{opacity:.55}}

/* ===== 捲れ演出（カードめくり） ===== */
.peel{position:absolute;inset:0;z-index:4;pointer-events:none;opacity:0}
.peel.is-run{
  background:
    radial-gradient(120% 120% at 0% 0%, #fff 0%, #f7e9c4 35%, #e8d08a 55%, rgba(255,255,255,0) 56%) no-repeat,
    linear-gradient(#111,#000);
  background-size:0% 0%,100% 100%;
  mix-blend-mode:screen;
  animation:peelOpen 950ms ease forwards
}
@keyframes peelOpen{
  0%{opacity:0;background-size:0% 0%,100% 100%}
  10%{opacity:1}
  60%{background-size:180% 180%,100% 100%}
  100%{opacity:0;background-size:180% 180%,100% 100%}
}

/* ===== 下段：リーディング＋タブ ===== */
.section{
  padding:48px 18px;max-width:980px;margin:0 auto;background:
    linear-gradient(180deg, rgba(8,10,18,1) 0%, rgba(10,12,20,.9) 100%);
  border-top:1px solid rgba(255,255,255,.06);
  visibility:hidden; /* 初期状態では非表示 */
  opacity:0;
  transition:opacity 1s ease-out;
}
.section.is-active{
  visibility:visible; /* アクティブになったら表示 */
  opacity:1;
}

.section h2{font-weight:700;font-size:22px;letter-spacing:.08em;color:#ffd76f;margin-bottom:14px}
.reading-grid{display:grid;gap:14px}
.reading{
  background:rgba(127,208,255,.08);border:1px solid rgba(127,208,255,.25);
  border-radius:12px;padding:14px;min-height:82px;
}
.reading .head{color:#cfe2ff;font-size:13px;letter-spacing:.18em;margin-bottom:6px}
.reading .body{line-height:1.75}

.tabs{
  margin-top:22px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px
}
.tab{
  display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:12px;
  border:1px solid rgba(255,215,111,.5);color:#ffe7a6;text-decoration:none;
  background:rgba(0,0,0,.35);box-shadow:0 0 16px rgba(255,215,111,.15), inset 0 0 12px rgba(255,215,111,.08);
  transition:transform .15s, box-shadow .2s
}
.tab:active{transform:translateY(1px)}
@media (min-width:680px){.tabs{grid-template-columns:repeat(4,1fr)}}
</style>
</head>
<body>

<section class="hero" id="hero">
  <div class="bg" aria-hidden="true"></div>

  <div class="title-wrap" id="titleWrap">
    <h1 class="title">タロット展開</h1>
    <p class="subtitle">あなたの運命の詩</p>
  </div>

  <div class="spread" id="spread" aria-hidden="true">
    <div class="card" data-idx="0" aria-label="詩">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card0"></div>
      </div>
    </div>
    <div class="card" data-idx="1" aria-label="韻">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card1"></div>
      </div>
    </div>
    <div class="card" data-idx="2" aria-label="祈">
      <div class="card__inner">
        <div class="card__face card__back"></div>
        <div class="card__face card__front" id="card2"></div>
      </div>
    </div>
  </div>

  <div class="labels" id="labels" aria-hidden="true" style="opacity:0;transform:translateY(8px)">
    <div class="label">詩</div>
    <div class="label">韻</div>
    <div class="label">祈</div>
  </div>

  <div class="tap-hint" id="tapHint"><div class="tap-hint__pill">画面をタップして開く</div></div>

  <div class="peel" id="peel" aria-hidden="true"></div>
</section>

<section class="section" id="reading">
  <h2>詩・韻・祈 のリーディング</h2>
  <div class="reading-grid">
    <div class="reading" id="read0">
      <div class="head">詩</div>
      <div class="body" id="body0">カードを開くと、ここに“詩”が現れます。</div>
    </div>
    <div class="reading" id="read1">
      <div class="head">韻</div>
      <div class="body" id="body1">カードを開くと、ここに“韻”が現れます。</div>
    </div>
    <div class="reading" id="read2">
      <div class="head">祈</div>
      <div class="body" id="body2">カードを開くと、ここに“祈”が現れます。</div>
    </div>
  </div>

  <nav class="tabs" aria-label="次のアクション">
    <a class="tab" href="#" id="retry">もう一度占う</a>
    <a class="tab" href="https://line.me/" target="_blank" rel="noopener">個人鑑定</a>
    <a class="tab" href="https://example.com/shiin-shisou" target="_blank" rel="noopener">詩韻思想</a>
    <a class="tab" href="https://example.com/shion" target="_blank" rel="noopener">Shion</a>
  </nav>
</section>

<script>
/* ===== データ ===== */
const cardFrontImages = [
  'card-front-0.jpg','card-front-1.jpg','card-front-2.jpg','card-front-3.jpg',
  'card-front-4.jpg','card-front-5.jpg','card-front-6.jpg','card-front-7.jpg',
  'card-front-8.jpg','card-front-9.jpg','card-front-10.jpg','card-front-11.jpg',
  'card-front-12.jpg','card-front-13.jpg','card-front-14.jpg','card-front-15.jpg',
  'card-front-16.jpg','card-front-17.jpg','card-front-18.jpg','card-front-19.jpg',
  'card-front-20.jpg','card-front-21.jpg'
];

const majorArcana = [
  { name:'The Fool',        upright:'純粋な始まりの風、冒険の翼を広げて',  reversed:'無謀な跳躍、影に潜む落とし穴', imageIndex:0 },
  { name:'The Magician',    upright:'意志の炎が現実を紡ぎ、創造の河を流す',  reversed:'幻の鏡、欺瞞の霧に包まれて',    imageIndex:1 },
  { name:'The High Priestess', upright:'内なる声のささやき、月の光が導く道', reversed:'失われた均衡、抑圧された魂の叫び', imageIndex:2 },
  { name:'The Empress',     upright:'豊穣の大地、母なる愛の抱擁',            reversed:'枯れた花、創造の停滞',          imageIndex:3 },
  { name:'The Emperor',     upright:'秩序の玉座、力強い統治の剣',              reversed:'暴君の影、支配の崩壊',          imageIndex:4 },
  { name:'The Hierophant',  upright:'伝統の灯、教えの道標',                    reversed:'硬直した信仰、自由の抑圧',      imageIndex:5 },
  { name:'The Lovers',      upright:'運命の交差、心の選択',                    reversed:'迷いの分岐、愛の試練',          imageIndex:6 },
  { name:'The Chariot',     upright:'勝利の戦車、意志の疾走',                  reversed:'方向を見失う馬車',              imageIndex:7 },
  { name:'Strength',        upright:'内なる獅子、優しさの力',                  reversed:'弱さの咆哮、自己不信',          imageIndex:8 },
  { name:'The Hermit',      upright:'孤独の灯台、魂の探求',                    reversed:'孤立の闇、導きを拒む',          imageIndex:9 },
  { name:'Wheel of Fortune',upright:'運命の輪、巡る星の流れ',                  reversed:'停滞の歯車、予期せぬ転落',      imageIndex:10 },
  { name:'Justice',         upright:'天秤の裁き、真実の剣',                    reversed:'不正の影、偏った判断',          imageIndex:11 },
  { name:'The Hanged Man',  upright:'逆さの悟り、犠牲の光',                    reversed:'停滞の苦しみ、視野の狭さ',      imageIndex:12 },
  { name:'Death',           upright:'終わりと始まり、変容の蝶',                reversed:'変化への恐怖、過去の亡霊',      imageIndex:13 },
  { name:'Temperance',      upright:'調和の天使、バランスの流れ',              reversed:'極端な揺らぎ、衝突の炎',        imageIndex:14 },
  { name:'The Devil',       upright:'鎖の誘惑、欲望の檻',                      reversed:'解放の鍵、束縛からの脱出',      imageIndex:15 },
  { name:'The Tower',       upright:'崩壊の雷、覚醒の衝撃',                    reversed:'破壊の予兆、避けられない危機',  imageIndex:16 },
  { name:'The Star',        upright:'希望の星、癒しの水',                      reversed:'失われた光、絶望の夜',          imageIndex:17 },
  { name:'The Moon',        upright:'幻想の月、潜在意識の海',                  reversed:'真実の光、欺瞞の霧',            imageIndex:18 },
  { name:'The Sun',         upright:'輝く太陽、生命の喜び',                    reversed:'曇った陽光、一時的な幸福',      imageIndex:19 },
  { name:'Judgement',       upright:'覚醒の喇叭、再生の炎',                    reversed:'自己否定、過去の重荷',          imageIndex:20 },
  { name:'The World',       upright:'調和の円舞、成就の星',                    reversed:'未完の旅、閉ざされた門',        imageIndex:21 }
];

/* ===== 要素群 ===== */
const titleWrap = document.getElementById('titleWrap');
const peel      = document.getElementById('peel');
const spread    = document.getElementById('spread');
const labels    = document.getElementById('labels');
const tapHint   = document.getElementById('tapHint');
const readingEl = document.getElementById('reading');
const cardElements = document.querySelectorAll('.card');
const cardFronts = document.querySelectorAll('.card__front');
const cardInners = document.querySelectorAll('.card__inner');
const bodies = [document.getElementById('body0'), document.getElementById('body1'), document.getElementById('body2')];
const defaultBodies = ['カードを開くと、ここに“詩”が現れます。', 'カードを開くと、ここに“韻”が現れます。', 'カードを開くと、ここに“祈”が現れます。'];


/* ===== 状態管理と初期化 ===== */
let selectedCards = []; // 抽選結果
let revealedCount = 0; // めくられたカードの数

function initialize(){
  // 抽選
  selectedCards = [];
  const majorArcanaCopy = [...majorArcana];
  while(selectedCards.length<3){
    const randIndex = Math.floor(Math.random()*majorArcanaCopy.length);
    selectedCards.push(majorArcanaCopy.splice(randIndex, 1)[0]);
  }
  revealedCount = 0;
  
  // 状態のリセット
  readingEl.classList.remove('is-active');
  tapHint.style.opacity = 1;
  
  cardElements.forEach((card, i) => {
    card.classList.remove('is-flipped');
    card.style.pointerEvents = 'auto'; // タップを有効化
    cardFronts[i].style.backgroundImage = 'none'; // 表面画像を削除
    bodies[i].innerHTML = defaultBodies[i]; // リーディング結果をリセット
  });
  
  // 初回ロード時のみ実行
  if(initialize.isFirstRun){
    window.addEventListener('load', runInitialSequence);
    document.getElementById('retry').addEventListener('click', retry, { passive: false });
    cardElements.forEach(c=>{
      c.addEventListener('click', () => flipCard(Number(c.dataset.idx)), { passive:true });
    });
    initialize.isFirstRun = false;
  }
}
initialize.isFirstRun = true;

/* ===== 初回出現シーケンス ===== */
function runInitialSequence(){
  // 1) タイトル表示
  titleWrap.style.animation = 'fadeIn .9s ease .4s forwards';
  // 2) 1.5秒後：捲れ演出→カード自動出現（光とともに）
  setTimeout(() => {
    peel.classList.add('is-run');
    peel.addEventListener('animationend', () => {
      peel.classList.remove('is-run');
      spread.style.animation = 'fadeUp .6s ease forwards';
      labels.style.animation = 'fadeUp .6s ease .06s forwards';
      spread.removeAttribute('aria-hidden'); labels.removeAttribute('aria-hidden');
      tapHint.style.opacity = 1; // ヒント表示
    }, { once:true });
  }, 1500);
}

/* ===== カードめくり（要件2） ===== */
function flipCard(idx){
  const card = cardElements[idx];
  if(card.classList.contains('is-flipped') || revealedCount >= 3) return;

  const data = selectedCards[idx];
  const reversed = Math.random() < 0.5;
  const labelMap = ['詩','韻','祈'];

  // 表面画像セット
  cardFronts[idx].style.backgroundImage = `url('${cardFrontImages[data.imageIndex]}')`;
  
  // めくりアニメーション開始
  card.classList.add('is-flipped');
  revealedCount++;
  
  // 完了後の処理
  const handleFlipEnd = () => {
    // リーディング結果の反映
    bodies[idx].innerHTML = `**【${labelMap[idx]}】**<br>《${data.name}》${reversed?'（逆位置）':'（正位置）'}<br>${reversed?data.reversed:data.upright}`;

    if(revealedCount === 3){
      // 3枚全てめくられた
      tapHint.style.opacity = 0; // ヒントを消す
      cardElements.forEach(c => c.style.pointerEvents = 'none'); // カードをタップ不可に
      
      // リーディング結果を表示してスクロール
      readingEl.classList.add('is-active');
      readingEl.scrollIntoView({ behavior:'smooth', block:'start' });
    }
    cardInners[idx].removeEventListener('transitionend', handleFlipEnd);
  };
  
  // トランジション（めくりアニメーション）終了を待つ
  cardInners[idx].addEventListener('transitionend', handleFlipEnd, { once: true });
}

/* ===== もう一度占う（要件3） ===== */
function retry(e){
  e.preventDefault();
  
  // ヒーローセクションまでスクロール
  hero.scrollIntoView({ behavior:'smooth', block:'start' });
  
  // スクロール完了を待ってリセット
  // (スクロール時間を見込んで固定時間待つか、IntersectionObserverを使う方法があるが、ここでは簡略化のため固定時間で待つ)
  setTimeout(() => {
    initialize();
  }, 700); 
}

// 初回実行
initialize();
</script>
</body>
</html>
