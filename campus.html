<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TAROT BREAKER｜現実界 CAMPUS</title>

  <style>
    :root{
      --maxw: 980px;
      --r: 18px;

      --text: rgba(18, 22, 30, 0.92);
      --muted: rgba(18, 22, 30, 0.58);

      --ink: rgba(18, 22, 30, 0.16);
      --ink2: rgba(18, 22, 30, 0.10);

      --ai: rgba(120, 170, 235, 0.78);
      --ai2: rgba(120, 170, 235, 0.26);

      --gold: rgba(183, 157, 109, 0.62);
      --gold2: rgba(183, 157, 109, 0.28);

      --glass: rgba(255,255,255,0.78);
      --glass2: rgba(255,255,255,0.60);

      --shadow: 0 22px 55px rgba(10, 16, 25, 0.16);
      --shadow2: 0 14px 34px rgba(10, 16, 25, 0.12);

      --bg-image: url("images/campus.png");
    }

    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color: var(--text);
      background: var(--bg-image) center / cover no-repeat fixed;
      overflow-x:hidden;
    }

    /* 背景視認性：薄すぎない、でも潰さない */
    body::before{
      content:"";
      position: fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      background:
        radial-gradient(circle at 20% 18%, rgba(255,255,255,0.22), transparent 58%),
        radial-gradient(circle at 78% 72%, rgba(255,255,255,0.16), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.10));
    }
    body::after{
      /* 高級感ノイズ */
      content:"";
      position: fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      background-image:
        linear-gradient(0deg, rgba(0,0,0,0.035), rgba(0,0,0,0.035));
      opacity:0.22;
      mix-blend-mode: soft-light;
    }

    header{
      position: sticky;
      top:0;
      z-index: 30;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(255,255,255,0.78), rgba(255,255,255,0.58));
      border-bottom: 1px solid var(--ink2);
    }
    .topbar{
      width:min(var(--maxw), 100%);
      margin:0 auto;
      padding: 0.95rem 1.2rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    .crumb{
      display:flex;
      align-items:baseline;
      gap:.6rem;
      letter-spacing:.10em;
      font-size:.92rem;
      color: rgba(18,22,30,0.60);
      user-select:none;
      white-space:nowrap;
    }
    .crumb strong{
      color: rgba(18,22,30,0.92);
      font-weight: 950;
      letter-spacing:.14em;
    }
    .return-anchor{
      color: rgba(18,22,30,0.78);
      text-decoration:none;
      padding:.35rem .55rem;
      border-radius: 10px;
      border: 1px solid rgba(18,22,30,0.14);
      background: rgba(255,255,255,0.40);
      backdrop-filter: blur(10px);
      transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;
      white-space:nowrap;
    }
    .return-anchor:hover,
    .return-anchor:focus-visible{
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(10,16,25,0.12);
      outline:none;
    }

    main{
      width:min(var(--maxw), 100%);
      margin:0 auto;
      padding: 1.6rem 1.2rem 3.0rem;
      position: relative;
      z-index: 5;
      display:grid;
      gap: 1.1rem;
    }

    /* タイトルプレート（最小） */
    .campus-plate{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding: .85rem 1rem;
      border-radius: calc(var(--r) + 10px);
      border: 1px solid rgba(18,22,30,0.14);
      background: linear-gradient(180deg, rgba(255,255,255,0.74), rgba(255,255,255,0.56));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
    }
    .campus-plate .left{
      display:flex;
      align-items:baseline;
      gap:.8rem;
      letter-spacing:.14em;
    }
    .campus-plate .left .ttl{
      font-weight: 980;
      font-size: 1.06rem;
    }
    .campus-plate .left .sub{
      color: rgba(18,22,30,0.56);
      font-size: .88rem;
      letter-spacing:.18em;
    }
    .campus-plate .sigil{
      width: 38px;
      height: 38px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,0.42);
      border: 1px solid rgba(18,22,30,0.12);
      box-shadow: 0 10px 22px rgba(10,16,25,0.08);
      backdrop-filter: blur(12px);
      color: rgba(18,22,30,0.58);
      user-select:none;
    }

    /* ===========================================
       完全タロット風 “顔アイコンカード” UI
       =========================================== */
    .grid{
      display:grid;
      gap: 0.95rem;
    }

    .card{
      position: relative;
      overflow:hidden;
      isolation: isolate;
      border-radius: calc(var(--r) + 12px);
      border: 1px solid rgba(18,22,30,0.16);
      background: linear-gradient(180deg, rgba(255,255,255,0.74), rgba(255,255,255,0.60));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
      padding: 1.05rem 1.05rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 1rem;
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      text-decoration:none;
      color: inherit;
    }

    /* タロット額縁 */
    .card::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: calc(var(--r) + 2px);
      border: 1px solid rgba(18,22,30,0.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.36);
      pointer-events:none;
      z-index:1;
    }

    /* 角の薄金点＋薄い横帯（現代×タロット） */
    .card::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
      background:
        radial-gradient(circle at 18px 18px, rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 18px) 18px, rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at 18px calc(100% - 18px), rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 18px) calc(100% - 18px), rgba(183,157,109,0.34) 0 2px, transparent 3px),
        linear-gradient(90deg, rgba(183,157,109,0.0), rgba(183,157,109,0.16), rgba(183,157,109,0.0));
      opacity: 0.52;
      mix-blend-mode: multiply;
    }

    .card:hover,
    .card:focus-visible{
      transform: translateY(-2px);
      border-color: rgba(120,170,235,0.55);
      box-shadow: var(--shadow);
      outline:none;
    }

    /* 左：顔アイコン */
    .face{
      position: relative;
      z-index: 3;
      display:flex;
      align-items:center;
      gap: .9rem;
      min-width: 0;
    }
    .avatar{
      width: 54px;
      height: 54px;
      border-radius: 16px;
      border: 1px solid rgba(18,22,30,0.14);
      background: rgba(255,255,255,0.45);
      box-shadow: 0 10px 22px rgba(10,16,25,0.10);
      overflow:hidden;
      flex: 0 0 auto;
      position: relative;
    }
    .avatar img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
      transform: translateZ(0);
    }

    /* キャラ色：外枠だけ色で匂わせ（やりすぎない） */
    .avatar::after{
      content:"";
      position:absolute;
      inset: -1px;
      border-radius: 16px;
      border: 2px solid var(--c, rgba(255,255,255,0.0));
      opacity: .55;
      pointer-events:none;
    }

    /* 右：小グリフだけ */
    .mini-glyph{
      position: relative;
      z-index: 3;
      width: 42px;
      height: 42px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,0.42);
      border: 1px solid rgba(18,22,30,0.12);
      box-shadow: 0 10px 22px rgba(10,16,25,0.08);
      backdrop-filter: blur(12px);
      color: rgba(18,22,30,0.58);
      user-select:none;
      flex: 0 0 auto;
      font-weight: 800;
    }

    /* タップ時の縦スリット（常時うっすら） */
    .slit{
      position:absolute;
      top: 12%;
      bottom: 12%;
      left: 16px;
      width: 3px;
      border-radius: 999px;
      background: linear-gradient(180deg,
        rgba(120,170,235,0.00),
        rgba(120,170,235,0.60),
        rgba(120,170,235,0.00)
      );
      opacity: 0.34;
      pointer-events:none;
      z-index:2;
    }

    /* 床反射のシーン */
    .sheen{
      position:absolute;
      inset: -35% -35%;
      background: linear-gradient(115deg,
        rgba(255,255,255,0.00) 0%,
        rgba(255,255,255,0.28) 46%,
        rgba(255,255,255,0.00) 70%
      );
      transform: translateX(-22%);
      opacity: 0.26;
      pointer-events:none;
      z-index:2;
    }

    /* 縦光スイープ（確実に見える太さ） */
    .gate-sweep{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 4;
      opacity: 0;
      transform: translateX(-130%);
      background: linear-gradient(90deg,
        rgba(255,255,255,0.00) 0%,
        rgba(255,255,255,0.00) 40%,
        rgba(255,255,255,0.76) 50%,
        rgba(255,255,255,0.00) 60%,
        rgba(255,255,255,0.00) 100%
      );
      filter: blur(0.2px);
    }

    .card.gate-on .gate-sweep{
      opacity: 1;
      animation: gateSweep 380ms ease-out forwards;
    }
    @keyframes gateSweep{
      0%   { transform: translateX(-130%); opacity: 0; }
      10%  { opacity: 1; }
      100% { transform: translateX(130%); opacity: 0; }
    }

    .card.gate-armed{
      border-color: rgba(120,170,235,0.66);
      box-shadow: var(--shadow);
    }

    /* Arete Dot（右上） */
    .pulse-dot{
      position: fixed;
      top: 14px;
      right: 14px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(183,157,109,0.34);
      border: 1px solid rgba(183,157,109,0.50);
      box-shadow: 0 0 0 0 rgba(183,157,109,0.22);
      cursor: pointer;
      z-index: 60;
    }
    .pulse-dot:hover{
      background: rgba(183,157,109,0.44);
      border-color: rgba(183,157,109,0.66);
    }

    /* 吹き出し（喋る） */
    .speech{
      position: fixed;
      left: 50%;
      top: 86px;
      transform: translateX(-50%) translateY(-8px);
      width: min(680px, calc(100% - 28px));
      padding: .75rem .95rem;
      border-radius: 16px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(18,22,30,0.14);
      box-shadow: 0 18px 42px rgba(10,16,25,0.14);
      backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 70;
      letter-spacing: .02em;
      color: rgba(18,22,30,0.86);
      text-align: center;
      line-height: 1.7;
      font-weight: 650;
    }
    .speech.show{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* 同期オーバーレイ（最後に出す） */
    .sync-overlay{
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(10, 12, 16, 0.90);
      color: rgba(245,245,245,0.92);
      letter-spacing: 0.12em;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.40s ease;
      z-index: 90;
      pointer-events: none;
    }
    .sync-overlay.active{
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
    .sync-box{
      text-align: center;
      padding: 1.1rem 1.2rem;
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
    }
    .sync-box p{ margin: .25rem 0; font-size: clamp(.95rem, 2vw, 1.08rem); }
    .sync-sub{ font-size: .86rem !important; letter-spacing: .18em; color: rgba(220,220,220,0.78) !important; }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; }
    }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="crumb" aria-label="現在地">
        <strong>現実界</strong> / CAMPUS
      </div>
      <a class="return-anchor" href="star-memory.html">星の記憶へ戻る</a>
    </div>
  </header>

  <button class="pulse-dot" id="pulseDot" aria-label="右目の微熱（Areteの気配）"></button>
  <div class="speech" id="speech" role="status" aria-live="polite"></div>

  <main>
    <div class="campus-plate" aria-label="CAMPUS">
      <div class="left">
        <div class="ttl">CAMPUS</div>
        <div class="sub">corridor access</div>
      </div>
      <div class="sigil">◇</div>
    </div>

    <section class="grid" aria-label="回廊の接続先">
      <!--
        ▼ 画像ファイルを用意してね：
        images/icons/amato.png
        images/icons/ouin.png
        images/icons/ecru.png
        images/icons/dico.png
        images/icons/shion.png
      -->

      <a class="card" href="amato.html" data-destination="amato.html"
         data-id="amato" data-line="似合うかどうかより、選ぶかどうか。"
         style="--c: rgba(215, 164, 164, 0.78);">
        <span class="slit" aria-hidden="true"></span>
        <span class="sheen" aria-hidden="true"></span>
        <span class="gate-sweep" aria-hidden="true"></span>

        <div class="face">
          <div class="avatar" aria-hidden="true">
            <img src="images/icons/amato.png" alt="">
          </div>
          <div class="label" aria-hidden="true" style="color:rgba(18,22,30,0.72); font-weight:850; letter-spacing:.12em;">
            アマト
          </div>
        </div>

        <div class="mini-glyph">◇</div>
      </a>

      <a class="card" href="ouin-shoot.html" data-destination="ouin-shoot.html"
         data-id="ouin" data-line="形は、後からついてくるわ。"
         style="--c: rgba(120, 170, 235, 0.72);">
        <span class="slit" aria-hidden="true"></span>
        <span class="sheen" aria-hidden="true"></span>
        <span class="gate-sweep" aria-hidden="true"></span>

        <div class="face">
          <div class="avatar" aria-hidden="true">
            <img src="images/icons/ouin.png" alt="">
          </div>
          <div class="label" aria-hidden="true" style="color:rgba(18,22,30,0.72); font-weight:850; letter-spacing:.12em;">
            OUIN
          </div>
        </div>

        <div class="mini-glyph">▢</div>
      </a>

      <a class="card" href="ecru-magazine.html" data-destination="ecru-magazine.html"
         data-id="ecru" data-line="ページは閉じても、記憶は閉じない。"
         style="--c: rgba(183, 157, 109, 0.72);">
        <span class="slit" aria-hidden="true"></span>
        <span class="sheen" aria-hidden="true"></span>
        <span class="gate-sweep" aria-hidden="true"></span>

        <div class="face">
          <div class="avatar" aria-hidden="true">
            <img src="images/icons/ecru.png" alt="">
          </div>
          <div class="label" aria-hidden="true" style="color:rgba(18,22,30,0.72); font-weight:850; letter-spacing:.12em;">
            ECRU
          </div>
        </div>

        <div class="mini-glyph">◻</div>
      </a>

      <a class="card" href="dico-play.html" data-destination="dico-play.html"
         data-id="dico" data-line="重い顔してるー？ほら、笑って。"
         style="--c: rgba(79, 179, 255, 0.78);">
        <span class="slit" aria-hidden="true"></span>
        <span class="sheen" aria-hidden="true"></span>
        <span class="gate-sweep" aria-hidden="true"></span>

        <div class="face">
          <div class="avatar" aria-hidden="true">
            <img src="images/icons/dico.png" alt="">
          </div>
          <div class="label" aria-hidden="true" style="color:rgba(18,22,30,0.72); font-weight:850; letter-spacing:.12em;">
            DiCo
          </div>
        </div>

        <div class="mini-glyph">△</div>
      </a>

      <a class="card" href="shion-column.html" data-destination="shion-column.html"
         data-id="shion" data-line="……行くか。"
         style="--c: rgba(183, 157, 109, 0.62);">
        <span class="slit" aria-hidden="true"></span>
        <span class="sheen" aria-hidden="true"></span>
        <span class="gate-sweep" aria-hidden="true"></span>

        <div class="face">
          <div class="avatar" aria-hidden="true">
            <img src="images/icons/shion.png" alt="">
          </div>
          <div class="label" aria-hidden="true" style="color:rgba(18,22,30,0.72); font-weight:850; letter-spacing:.12em;">
            シオン
          </div>
        </div>

        <div class="mini-glyph">—</div>
      </a>
    </section>
  </main>

  <div class="sync-overlay" id="syncOverlay" aria-hidden="true">
    <div class="sync-box">
      <p>《現実座標を同期中…》</p>
      <p class="sync-sub">COORDINATE SYNC</p>
    </div>
  </div>

  <script>
    const overlay = document.getElementById('syncOverlay');
    const cards = document.querySelectorAll('.card');
    const pulseDot = document.getElementById('pulseDot');
    const speech = document.getElementById('speech');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    let speechTimer = null;
    let navigating = false;

    function showSpeech(text){
      speech.textContent = text;
      speech.classList.add('show');
      clearTimeout(speechTimer);
      speechTimer = setTimeout(() => speech.classList.remove('show'), 900);
    }

    // ======== 音声（使えない場合は黙る） ========
    function speakJP(text){
      try{
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();

        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ja-JP';
        u.rate = 1.05;
        u.pitch = 1.0;
        u.volume = 1.0;

        // 可能なら日本語voiceを選ぶ（なければOSデフォルト）
        const voices = window.speechSynthesis.getVoices?.() || [];
        const ja = voices.find(v => /ja-JP/i.test(v.lang));
        if (ja) u.voice = ja;

        window.speechSynthesis.speak(u);
      }catch(e){
        // silent fail
      }
    }

    // ======== 確実に縦光を1回発火（iOS対策：reflow） ========
    function playGateOnce(card){
      card.classList.remove('gate-on');
      // 強制reflowでアニメを確実に再スタート
      void card.offsetWidth;
      card.classList.add('gate-on');
      setTimeout(() => card.classList.remove('gate-on'), 420);
    }

    // ======== ドクン＝2拍（確実に2回） ========
    function playDoubleGate(card){
      card.classList.add('gate-armed');

      // 1拍目
      playGateOnce(card);

      // 2拍目（テンポ固定：見えやすい間隔）
      setTimeout(() => playGateOnce(card), 260);

      setTimeout(() => card.classList.remove('gate-armed'), 900);
    }

    // ======== Arete dot pulse（2回） ========
    function pulseArete(){
      pulseDot.animate([
        { boxShadow: '0 0 0 0 rgba(183,157,109,0.22)' },
        { boxShadow: '0 0 0 12px rgba(183,157,109,0.00)' }
      ], { duration: 520, easing: 'ease-out' });

      setTimeout(() => {
        pulseDot.animate([
          { boxShadow: '0 0 0 0 rgba(183,157,109,0.18)' },
          { boxShadow: '0 0 0 12px rgba(183,157,109,0.00)' }
        ], { duration: 520, easing: 'ease-out' });
      }, 320);
    }

    // 右上Arete：雰囲気用（押したら最上段が反応）
    pulseDot.addEventListener('click', () => {
      if (navigating) return;
      pulseArete();
      showSpeech('ドクン　／　ドクン');
      const first = document.querySelector('.card');
      if (first) playDoubleGate(first);
      // 音声はここでは鳴らさない（うるさくなるため）
    });

    // ======== タップ → 一言 → ドクン2拍 → 縦光2回 → 遷移 ========
    cards.forEach((card) => {
      // iOSの「タップ感」優先で pointerdown を使う（clickも残す）
      const handler = (event) => {
        event.preventDefault();
        if (navigating) return;
        navigating = true;

        const destination = card.dataset.destination;
        const line = card.dataset.line || '';

        if (prefersReducedMotion) {
          // reduced motion は演出省略
          window.location.href = destination;
          return;
        }

        // しゃべる（吹き出し＋音声）
        showSpeech(line);
        speakJP(line);

        // 2拍演出（同期）
        pulseArete();
        playDoubleGate(card);

        // overlayが早すぎて縦光を潰さないよう、遅らせる
        setTimeout(() => overlay.classList.add('active'), 160);

        // 2拍が視認できるタイミングで遷移
        setTimeout(() => window.location.href = destination, 820);
      };

      card.addEventListener('pointerdown', handler, { passive: false });
      card.addEventListener('click', handler, { passive: false });
    });

    // voicesロード（iOS対策）
    try { window.speechSynthesis?.getVoices?.(); } catch(e){}
  </script>
</body>
</html>
