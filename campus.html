<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TAROT BREAKER｜現実界 CAMPUS</title>

  <style>
    :root{
      --maxw: 980px;
      --r: 18px;

      --text: rgba(18, 22, 30, 0.92);
      --muted: rgba(18, 22, 30, 0.58);

      --ink: rgba(18, 22, 30, 0.16);
      --ink2: rgba(18, 22, 30, 0.10);

      --ai: rgba(120, 170, 235, 0.78);
      --gold: rgba(183, 157, 109, 0.62);

      --shadow: 0 22px 55px rgba(10, 16, 25, 0.16);
      --shadow2: 0 14px 34px rgba(10, 16, 25, 0.12);

      --bg-image: url("images/campus.png");
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color: var(--text);
      background: var(--bg-image) center / cover no-repeat fixed;
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none; z-index:0;
      background:
        radial-gradient(circle at 20% 18%, rgba(255,255,255,0.22), transparent 58%),
        radial-gradient(circle at 78% 72%, rgba(255,255,255,0.16), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.10));
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      pointer-events:none; z-index:1;
      background-image: linear-gradient(0deg, rgba(0,0,0,0.035), rgba(0,0,0,0.035));
      opacity:0.22;
      mix-blend-mode: soft-light;
    }

    header{
      position:sticky; top:0;
      z-index:30;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(255,255,255,0.78), rgba(255,255,255,0.58));
      border-bottom: 1px solid var(--ink2);
    }

    .topbar{
      width:min(var(--maxw), 100%);
      margin:0 auto;
      padding: 0.95rem 1.2rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }

    .crumb{
      display:flex;
      align-items:baseline;
      gap:.6rem;
      letter-spacing:.10em;
      font-size:.92rem;
      color: rgba(18,22,30,0.60);
      user-select:none;
      white-space:nowrap;
    }
    .crumb strong{
      color: rgba(18,22,30,0.92);
      font-weight: 950;
      letter-spacing:.14em;
    }

    .return-anchor{
      color: rgba(18,22,30,0.78);
      text-decoration:none;
      padding:.35rem .55rem;
      border-radius: 10px;
      border: 1px solid rgba(18,22,30,0.14);
      background: rgba(255,255,255,0.40);
      backdrop-filter: blur(10px);
      transition: transform .2s ease, box-shadow .2s ease;
      white-space:nowrap;
    }
    .return-anchor:hover,
    .return-anchor:focus-visible{
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(10,16,25,0.12);
      outline:none;
    }

    main{
      width:min(var(--maxw), 100%);
      margin:0 auto;
      padding: 1.2rem 1.2rem 2.8rem;
      position:relative;
      z-index:10;
    }

    /* ==== STACK ==== */
    .stack{
      display:grid;
      gap: 0.9rem;
    }

    /* ===========================================
       Row (Glass Button) : Centered, Balanced Width
       =========================================== */
    .row{
      position:relative;
      overflow:hidden;
      isolation:isolate;
      text-decoration:none;
      color:inherit;

      /* ★ 全画面共通：中央寄せ＆省略されにくい幅（50%はスマホで細すぎるため改善） */
      width: 60%;
      margin: 0 auto;

      border-radius: calc(var(--r) + 2px);
      background: linear-gradient(180deg, rgba(255,255,255,0.76), rgba(255,255,255,0.60));
      border: 1px solid rgba(18,22,30,0.16);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);

      padding: 0.85rem 0.9rem;
      transition: transform .26s ease, box-shadow .26s ease, border-color .26s ease;
      min-height: 78px;
      display:flex;
      align-items:center;
      gap: 0.85rem;
    }

    /* frame */
    .row::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: calc(var(--r) - 2px);
      border: 1px solid rgba(18,22,30,0.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.36);
      pointer-events:none;
      z-index:1;
    }

    /* corner dots + faint gold bar */
    .row::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      z-index:1;
      background:
        radial-gradient(circle at 18px 18px, rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 18px) 18px, rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at 18px calc(100% - 18px), rgba(183,157,109,0.34) 0 2px, transparent 3px),
        radial-gradient(circle at calc(100% - 18px) calc(100% - 18px), rgba(183,157,109,0.34) 0 2px, transparent 3px),
        linear-gradient(90deg, rgba(183,157,109,0.00), rgba(183,157,109,0.14), rgba(183,157,109,0.00));
      opacity: 0.55;
      mix-blend-mode: multiply;
    }

    .row:hover,
    .row:focus-visible{
      transform: translateY(-2px);
      border-color: rgba(120,170,235,0.55);
      box-shadow: var(--shadow);
      outline:none;
    }

    /* Left icon tile（タロット絵は不要＝キャラアイコンだけに） */
    .icon{
      position:relative;
      z-index:3;
      width: 46px;
      height: 46px;
      border-radius: 14px;
      background: rgba(255,255,255,0.52);
      border: 1px solid rgba(18,22,30,0.12);
      box-shadow: 0 10px 22px rgba(10,16,25,0.08);
      display:grid;
      place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .icon img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
    }

    /* Name */
    .name{
      position:relative;
      z-index:3;
      font-weight: 950;
      letter-spacing: 0.18em;
      font-size: 1.02rem;
      color: rgba(18,22,30,0.92);
      padding-left: 0.2rem;
      flex: 1 1 auto;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Right: glyph */
    .glyph{
      position:relative;
      z-index:3;
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background: rgba(255,255,255,0.50);
      border: 1px solid rgba(18,22,30,0.12);
      box-shadow: 0 10px 22px rgba(10,16,25,0.08);
      display:grid;
      place-items:center;
      color: rgba(18,22,30,0.56);
      user-select:none;
      flex: 0 0 auto;
    }

    /* vertical speech */
    .speech{
      position:absolute;
      top: 8px;
      right: 56px;
      bottom: 8px;
      width: 74px;
      padding: 10px 8px;

      display:flex;
      align-items:center;
      justify-content:center;

      background: linear-gradient(180deg, rgba(255,255,255,0.68), rgba(255,255,255,0.36));
      border: 1px solid rgba(18,22,30,0.10);
      border-radius: 14px;
      box-shadow: 0 12px 26px rgba(10,16,25,0.10);
      backdrop-filter: blur(10px);

      opacity: 0;
      transform: translateY(4px);
      pointer-events:none;
      z-index: 6;

      transition: opacity .18s ease, transform .18s ease;
    }
    .row.speaking .speech{
      opacity: 1;
      transform: translateY(0);
    }
    .speech span{
      writing-mode: vertical-rl;
      text-orientation: mixed;
      letter-spacing: 0.10em;
      line-height: 1.55;
      font-size: 0.84rem;
      color: rgba(18,22,30,0.78);
      user-select:none;
    }

    /* subtle slit */
    .slit{
      position:absolute;
      top: 14%;
      bottom: 14%;
      left: 12px;
      width: 3px;
      border-radius: 999px;
      background: linear-gradient(180deg,
        rgba(120,170,235,0.00),
        rgba(120,170,235,0.62),
        rgba(120,170,235,0.00)
      );
      opacity: 0.36;
      pointer-events:none;
      z-index:2;
    }
    .row:hover .slit,
    .row:focus-visible .slit{
      opacity: 0.58;
    }

    /* gate sweep */
    .gate-sweep{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:5;
      opacity:0;
      transform: translateX(-120%);
      background: linear-gradient(90deg,
        rgba(255,255,255,0.00) 0%,
        rgba(255,255,255,0.78) 50%,
        rgba(255,255,255,0.00) 100%
      );
      filter: blur(0.25px);
    }
    .row.gate-on .gate-sweep{
      opacity: 1;
      animation: gateSweep 380ms ease-out forwards;
    }
    @keyframes gateSweep{
      0%   { transform: translateX(-120%); opacity: 0; }
      12%  { opacity: 1; }
      100% { transform: translateX(120%); opacity: 0; }
    }

    .row.gate-armed{
      border-color: rgba(120,170,235,0.68);
      box-shadow: var(--shadow);
    }

    /* Arete dot */
    .pulse-dot{
      position: fixed;
      top: 14px;
      right: 14px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(183,157,109,0.32);
      border: 1px solid rgba(183,157,109,0.44);
      box-shadow: 0 0 0 0 rgba(183,157,109,0.22);
      cursor:pointer;
      z-index: 80;
    }
    .pulse-dot:hover{
      background: rgba(183,157,109,0.42);
      border-color: rgba(183,157,109,0.62);
    }

    .tooltip{
      position: fixed;
      top: 10px;
      right: 32px;
      background: rgba(255,255,255,0.90);
      border: 1px solid rgba(18,22,30,0.12);
      color: rgba(18,22,30,0.84);
      padding: 0.40rem 0.60rem;
      border-radius: 12px;
      font-size: 0.86rem;
      letter-spacing: 0.03em;
      box-shadow: 0 12px 28px rgba(10,16,25,0.12);
      opacity: 0;
      transform: translateY(-4px);
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 80;
      max-width: 320px;
    }
    .tooltip.show{ opacity:1; transform: translateY(0); }

    /* Sync overlay */
    .sync-overlay{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      background: rgba(10, 12, 16, 0.90);
      color: rgba(245,245,245,0.92);
      letter-spacing: 0.12em;
      opacity:0;
      visibility:hidden;
      transition: opacity .40s ease;
      z-index: 120;
      pointer-events:none;
    }
    .sync-overlay.active{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
    }
    .sync-box{
      text-align:center;
      padding: 1.05rem 1.2rem;
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
    }
    .sync-box p{ margin:.25rem 0; font-size: clamp(.95rem, 2vw, 1.08rem); }
    .sync-sub{ font-size:.86rem !important; letter-spacing:.18em; color: rgba(220,220,220,0.78) !important; }

    /* ===========================================
       Right Slide (Character Drawer) : Bust-up
       =========================================== */
    .drawer{
      position: fixed;
      top: 0;
      right: 0;
      height: 100dvh;
      width: min(78vw, 420px);
      transform: translateX(105%);
      transition: transform .32s ease;
      z-index: 110;

      border-left: 1px solid rgba(18,22,30,0.16);
      background: linear-gradient(180deg, rgba(255,255,255,0.78), rgba(255,255,255,0.60));
      backdrop-filter: blur(14px);
      box-shadow: 0 20px 60px rgba(0,0,0,.22);

      display: grid;
      grid-template-rows: auto 1fr;
      padding: 14px;
    }
    .drawer.is-open{ transform: translateX(0); }

    .drawerOverlay{
      position: fixed;
      inset: 0;
      background: rgba(10,12,18,.28);
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
      z-index: 109;
    }
    .drawerOverlay.is-open{
      opacity: 1;
      pointer-events: auto;
    }

    .drawerClose{
      justify-self: end;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(18,22,30,0.14);
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
      font-size: 22px;
      line-height: 1;
      cursor: pointer;
    }

    .drawerInner{
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 14px;
      padding-top: 6px;
      min-height: 0;
    }

    /* Bust-up size control: frame height + safe bounds */
    .charFrame{
      border-radius: 18px;
      border: 1px solid rgba(18,22,30,0.12);
      background: rgba(255,255,255,0.45);
      overflow: hidden;
      display: grid;
      place-items: center;

      height: 56dvh;       /* ★ 立ち絵（バストアップ）の主サイズ */
      min-height: 320px;   /* ★ 小さすぎ防止 */
      max-height: 560px;   /* ★ 大きすぎ防止 */
    }

    .charImg{
      width: 100%;
      height: 100%;
      object-fit: cover;           /* バストアップ前提＝大きく見せる */
      object-position: 50% 12%;    /* ★ 顔寄せ（上を見せる） */
      filter: drop-shadow(0 20px 30px rgba(0,0,0,.18));
    }

    .charMeta{
      border-radius: 18px;
      border: 1px solid rgba(18,22,30,0.12);
      background: rgba(255,255,255,0.55);
      padding: 14px 14px;
    }

    .charName{
      font-weight: 900;
      letter-spacing: .08em;
      font-size: 16px;
      margin-bottom: 6px;
    }
    .charLine{
      font-size: 13px;
      line-height: 1.6;
      opacity: .92;
    }

    body.drawer-lock{ overflow: hidden; }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; }
    }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="crumb" aria-label="現在地">
        <strong>現実界</strong> / CAMPUS
      </div>
      <a class="return-anchor" href="star-memory.html">星の記憶へ戻る</a>
    </div>
  </header>

  <button class="pulse-dot" id="pulseDot" aria-label="右目の微熱（Areteの気配）"></button>
  <div class="tooltip" id="tooltip" role="status" aria-live="polite">右目の奥が、ほんの少し熱い。</div>

  <main>
    <section class="stack" aria-label="行き先">

      <!-- AMATO -->
      <a class="row" href="amato.html"
         data-key="amato"
         data-destination="amato.html"
         data-speech="鏡の前で、選ぶの。今日の顔。">
        <span class="slit" aria-hidden="true"></span>

        <span class="icon" aria-hidden="true">
          <img src="images/icons/amato.png" alt="">
        </span>

        <div class="name">アマト</div>

        <div class="speech" aria-hidden="true"><span></span></div>
        <div class="glyph" aria-hidden="true">◇</div>

        <span class="gate-sweep" aria-hidden="true"></span>
      </a>

      <!-- OUIN -->
      <a class="row" href="ouin-shoot.html"
         data-key="ouin"
         data-destination="ouin-shoot.html"
         data-speech="光は残酷。だから、私が使う。">
        <span class="slit" aria-hidden="true"></span>

        <span class="icon" aria-hidden="true">
          <img src="images/icons/ouin.png" alt="">
        </span>

        <div class="name">OUIN</div>

        <div class="speech" aria-hidden="true"><span></span></div>
        <div class="glyph" aria-hidden="true">▢</div>

        <span class="gate-sweep" aria-hidden="true"></span>
      </a>

      <!-- ECRU -->
      <a class="row" href="ecru-magazine.html"
         data-key="ecru"
         data-destination="ecru-magazine.html"
         data-speech="ページは嘘をつかない。視線だけが残る。">
        <span class="slit" aria-hidden="true"></span>

        <span class="icon" aria-hidden="true">
          <img src="images/icons/ecru.png" alt="">
        </span>

        <div class="name">ECRU</div>

        <div class="speech" aria-hidden="true"><span></span></div>
        <div class="glyph" aria-hidden="true">◻</div>

        <span class="gate-sweep" aria-hidden="true"></span>
      </a>

      <!-- DiCo -->
      <a class="row" href="dico-play.html"
         data-key="dico"
         data-destination="dico-play.html"
         data-speech="ねぇ、笑って。重いのは、あとでいい。">
        <span class="slit" aria-hidden="true"></span>

        <span class="icon" aria-hidden="true">
          <img src="images/icons/dico.png" alt="">
        </span>

        <div class="name">DiCo</div>

        <div class="speech" aria-hidden="true"><span></span></div>
        <div class="glyph" aria-hidden="true">△</div>

        <span class="gate-sweep" aria-hidden="true"></span>
      </a>

      <!-- COLUMN -->
      <a class="row" href="column.html"
         data-key="column"
         data-destination="column.html"
         data-speech="記録。余白。言葉は、整えすぎない。">
        <span class="slit" aria-hidden="true"></span>

        <span class="icon" aria-hidden="true">
          <img src="images/icons/column.png" alt="">
        </span>

        <div class="name">コラム</div>

        <div class="speech" aria-hidden="true"><span></span></div>
        <div class="glyph" aria-hidden="true">—</div>

        <span class="gate-sweep" aria-hidden="true"></span>
      </a>

    </section>
  </main>

  <!-- Right Drawer (Character bust-up) -->
  <div id="charDrawer" class="drawer" aria-hidden="true">
    <button class="drawerClose" id="drawerClose" aria-label="close">×</button>

    <div class="drawerInner">
      <div class="charFrame">
        <img id="drawerImg" class="charImg" src="" alt="">
      </div>

      <div class="charMeta">
        <div id="drawerName" class="charName">NAME</div>
        <div id="drawerLine" class="charLine">…</div>
      </div>
    </div>
  </div>
  <div id="drawerOverlay" class="drawerOverlay" aria-hidden="true"></div>

  <div class="sync-overlay" id="syncOverlay" aria-hidden="true">
    <div class="sync-box">
      <p>《現実座標を同期中…》</p>
      <p class="sync-sub">COORDINATE SYNC</p>
    </div>
  </div>

  <script>
    const overlay = document.getElementById('syncOverlay');
    const rows = document.querySelectorAll('.row');
    const pulseDot = document.getElementById('pulseDot');
    const tooltip = document.getElementById('tooltip');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Drawer
    const drawer = document.getElementById('charDrawer');
    const drawerOverlay = document.getElementById('drawerOverlay');
    const drawerClose = document.getElementById('drawerClose');
    const drawerImg = document.getElementById('drawerImg');
    const drawerName = document.getElementById('drawerName');
    const drawerLine = document.getElementById('drawerLine');

    // 文字を読みやすい表示時間
    const SPEECH_MS = 2400;

    // キャラ（バストアップ画像パスをここに）
    const CHAR = {
      amato:  { name: "アマト", img: "images/bust/amato.png",  line: "……何か用？" },
      ouin:   { name: "OUIN",  img: "images/bust/ouin.png",   line: "選ぶのは、あなた。" },
      ecru:   { name: "ECRU",  img: "images/bust/ecru.png",   line: "ページをめくって。" },
      dico:   { name: "DiCo",  img: "images/bust/dico.png",   line: "ディディディ…来た！" },
      column: { name: "コラム", img: "images/bust/column.png", line: "記録は、まだ途中だ。" }
    };

    function openDrawer(key){
      const c = CHAR[key];
      if(!c) return;

      drawerName.textContent = c.name;
      drawerLine.textContent = c.line;
      drawerImg.src = c.img;
      drawerImg.alt = c.name;

      drawer.classList.add('is-open');
      drawerOverlay.classList.add('is-open');
      document.body.classList.add('drawer-lock');

      drawer.setAttribute('aria-hidden', 'false');
      drawerOverlay.setAttribute('aria-hidden', 'false');
    }

    function closeDrawer(){
      drawer.classList.remove('is-open');
      drawerOverlay.classList.remove('is-open');
      document.body.classList.remove('drawer-lock');

      drawer.setAttribute('aria-hidden', 'true');
      drawerOverlay.setAttribute('aria-hidden', 'true');
    }

    drawerClose.addEventListener('click', closeDrawer);
    drawerOverlay.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeDrawer(); });

    let tooltipTimer = null;
    function showTooltip(text){
      tooltip.textContent = text;
      tooltip.classList.add('show');
      clearTimeout(tooltipTimer);
      tooltipTimer = setTimeout(()=> tooltip.classList.remove('show'), 1400);
    }

    // gate sweep 1回（iOS対策）
    function playGateOnce(row){
      row.classList.remove('gate-on');
      void row.offsetWidth;
      row.classList.add('gate-on');
      setTimeout(() => row.classList.remove('gate-on'), 420);
    }

    // 2拍
    function playDoubleGate(row){
      row.classList.add('gate-armed');
      playGateOnce(row);
      setTimeout(() => playGateOnce(row), 260);
      setTimeout(() => row.classList.remove('gate-armed'), 900);
    }

    // 縦台詞
    function showVerticalSpeech(row, text){
      const box = row.querySelector('.speech');
      const span = box?.querySelector('span');
      if (!box || !span) return;

      span.textContent = text || '';
      row.classList.add('speaking');
      setTimeout(() => row.classList.remove('speaking'), SPEECH_MS);
    }

    // Arete pulse
    function pulseArete(){
      pulseDot.animate(
        [{ boxShadow:'0 0 0 0 rgba(183,157,109,0.22)' },
         { boxShadow:'0 0 0 12px rgba(183,157,109,0.00)' }],
        { duration:520, easing:'ease-out' }
      );
      setTimeout(() => {
        pulseDot.animate(
          [{ boxShadow:'0 0 0 0 rgba(183,157,109,0.18)' },
           { boxShadow:'0 0 0 12px rgba(183,157,109,0.00)' }],
          { duration:520, easing:'ease-out' }
        );
      }, 320);
    }

    pulseDot.addEventListener('mouseenter', () => showTooltip('右目の奥が、ほんの少し熱い。'));
    pulseDot.addEventListener('click', () => {
      showTooltip('ドクン　／　ドクン');
      pulseArete();
      const first = document.querySelector('.row');
      if (first){
        playDoubleGate(first);
        showVerticalSpeech(first, first.dataset.speech);
        openDrawer(first.dataset.key);
      }
    });

    // クリック：①台詞→②ドクン→③右スライドで顕現→④（任意で遷移）
    rows.forEach((row) => {
      row.addEventListener('click', (event) => {
        event.preventDefault();
        const destination = row.dataset.destination;
        const speech = row.dataset.speech;
        const key = row.dataset.key;

        if (prefersReducedMotion) {
          window.location.href = destination;
          return;
        }

        showVerticalSpeech(row, speech);
        playDoubleGate(row);
        pulseArete();

        // 右から顕現（観測＝顕現）
        setTimeout(() => openDrawer(key), 160);

        // ★ 遷移したいなら有効化（右スライド確認後に移動）
        // setTimeout(() => overlay.classList.add('active'), 320);
        // setTimeout(() => window.location.href = destination, 900);
      }, { passive:false });
    });
  </script>
</body>
</html>
