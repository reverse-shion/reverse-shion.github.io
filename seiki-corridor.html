<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>星祈の回廊 — Corridor of Star Prayers | 詩韻 Shion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="星祈の回廊 — Corridor of Star Prayers。光を灯し続けた者たちの帰る道。あなたの祈りは、いつか必ず、誰かの星になる。">

  <!-- フォント -->
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@500;700&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">

  <!-- 外部CSS -->
  <link rel="stylesheet" href="seiki-corridor.css">
</head>
<body>
  <div class="starfield" aria-hidden="true"></div>

  <!-- 光の道（背景演出） -->
  <div class="path-line" aria-hidden="true">
    <div class="path-glow"></div>
  </div>

  <div class="corridor-shell">

    <!-- ヘッダー -->
    <header class="site-header">
      <div class="title-block">
        <h1>星祈の回廊</h1>
        <span class="en">CORRIDOR OF STAR PRAYERS</span>
      </div>
      <p class="subtitle">――光を灯し続けた者たちの帰る道</p>
      <div class="header-line" aria-hidden="true"></div>
    </header>

    <!-- 縦スクロール回廊 -->
    <main class="corridor-main" aria-label="星祈の回廊">

      <!-- STEP 1：入口 -->
      <section class="corridor-section corridor-section--intro" aria-label="回廊の入口">
        <article class="card card-intro">
          <div class="card-step">STEP 1 / 4</div>
          <div class="intro-label">Seiki Corridor — Entrance</div>
          <h2>ここは、星祈の回廊。</h2>
          <div class="intro-body">
            <p>ここは、言葉にならなかった気持ちが<br>
            小さな光になって並ぶ場所。</p>

            <p>あなたが灯した光は、<br>
            誰かの足元をそっと照らし、</p>

            <p>その誰かが灯した光は、<br>
            また別の誰かの道となる。</p>

            <p>どうぞ、ゆっくり歩いてください。<br>
            あなたの祈りは、いつか必ず、<br>
            誰かの星になるから。</p>
          </div>

          <div class="intro-hint" id="scrollHint">
            <span class="intro-hint-text">下へ進むと、灯された祈りが見えてきます</span>
            <span class="intro-hint-arrow">⇣</span>
          </div>
        </article>
      </section>

      <!-- STEP 2：誰かの灯籠（サンプル） -->
      <section class="corridor-section corridor-section--others" aria-label="誰かの灯籠">
        <article class="card card-others">
          <div class="card-step">STEP 2 / 4</div>
          <h3>この回廊を歩いた、誰かの灯。</h3>
          <p class="others-lead">
            ここに並ぶ言葉は、<br>
            かつて星祈の回廊をくぐった人々をイメージして紡いだ「サンプルの灯籠」です。<br>
            あなたの祈りも、いつか誰かの心にこうして寄り添うかもしれません。
          </p>

          <div class="lantern-list lantern-list--others">
            <div class="lantern-item">
              <div class="lantern-text">
うまくいかない日が続いても、
ちゃんと生き残っている自分がいる。

今日もここまで来たことだけでも、
少しだけ誇ってみたい。
              </div>
              <div class="lantern-meta">―― いつかの誰かの灯</div>
            </div>

            <div class="lantern-item">
              <div class="lantern-text">
「大丈夫だよ」って言葉を、
誰かに言ってあげられるように。

その前に、まずは自分に
そっとそう言えるようになりたい。
              </div>
              <div class="lantern-meta">―― どこかの夜に灯った祈り</div>
            </div>

            <div class="lantern-item">
              <div class="lantern-text">
もう一度だけ信じてみる。
世界でも、誰かでもなく、

「それでも進みたい」と願っている
自分の小さな光のことを。
              </div>
              <div class="lantern-meta">―― 星祈の回廊に残された想い</div>
            </div>
          </div>
        </article>
      </section>

      <!-- STEP 3：あなたの灯籠 -->
      <section class="corridor-section corridor-section--yours" aria-label="あなたの灯籠">
        <article class="card card-user">
          <div class="card-step">STEP 3 / 4</div>
          <div class="card-user-header">
            <h3>あなたの灯籠を、ここに。</h3>
            <p>
              悲しみでも、感謝でも、誰かへの祈りでも。<br>
              いまのあなたの心を、そのままここに置いてみてください。
            </p>
            <p class="card-user-note">
              ※ここに灯した言葉は、この端末の中だけに静かに記録されます。<br>
              作者や他の人の画面には届かず、あなた専用の「小さな回廊」として残ります。
            </p>
          </div>

          <form class="prayer-form" id="prayerForm">
            <textarea id="prayerText" maxlength="220"
              placeholder="例：&quot;今日もなんとかここまで来られた。少しだけ、明日も信じてみる。&quot;"></textarea>
            <div class="prayer-form-footer">
              <div class="prayer-hint">
                20〜220文字程度で、いまの心をひとつだけ書いてください。
              </div>
              <button type="submit" class="btn-primary" id="submitPrayer">
                <span>灯籠を灯す</span> ✶
              </button>
            </div>
            <div class="prayer-error" id="prayerError"></div>
          </form>

          <div class="lantern-log-head">
            <div class="lantern-log-title">あなたがこれまでに灯した祈り</div>
            <div class="lantern-log-count" id="lanternCount">灯した灯籠：0本</div>
          </div>

          <div class="lantern-list" id="lanternList" aria-label="これまでに灯した灯籠"></div>

          <p class="lantern-log-note">
            ここに並ぶのは、あなたがこの端末から灯した祈りだけ。<br>
            それでも、世界のどこかで同じように光を灯している誰かがいる――<br>
            そう想像しながら、そっと並んだ光を眺めてみてください。
          </p>
        </article>
      </section>

      <!-- STEP 4：奥の間（予告） -->
      <section class="corridor-section corridor-section--inner" aria-label="奥の回廊（準備中）">
        <article class="card card-inner">
          <div class="card-step">STEP 4 / 4</div>
          <h3>まだ閉ざされた「奥の間」</h3>
          <p class="inner-body">
            この先には、いつか<br>
            セレフィアスの囁きが満ちる「奥の間」が開かれます。<br><br>
            そこでは、一定の周期で<br>
            星霊からの詩とメッセージが降りてきて、<br>
            この回廊に灯された祈りと静かに響き合うでしょう。<br><br>
            それまでは、ここで灯したあなたの祈りとともに、<br>
            静かな星の呼吸だけを感じていてください。
          </p>
        </article>
      </section>

    </main>

    <!-- 下部ナビ -->
    <footer class="site-footer" aria-label="星祈の回廊ナビゲーション">
      <span class="footer-label">他の星への扉：</span>
      <nav class="footer-links">
        <a class="footer-link" href="https://reverse-shion.github.io/ncode-field.html">詩韻思想へアクセス</a>
        <a class="footer-link" href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener">TAROT BREAKER を読む</a>
        <a class="footer-link" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">個人鑑定をみる</a>
      </nav>
    </footer>

  </div>

  <script>
    // 星祈の回廊：ローカル灯籠＋エフェクト
    (function() {
      const STORAGE_KEY = 'seiki_corridor_prayers_v1';
      const form = document.getElementById('prayerForm');
      const textarea = document.getElementById('prayerText');
      const errorEl = document.getElementById('prayerError');
      const listEl = document.getElementById('lanternList');
      const submitBtn = document.getElementById('submitPrayer');
      const countEl = document.getElementById('lanternCount');
      const scrollHint = document.getElementById('scrollHint');

      // スクロールヒント制御（最初だけ表示）
      if (scrollHint) {
        let hintHidden = false;
        const hideHint = () => {
          if (hintHidden) return;
          hintHidden = true;
          scrollHint.classList.add('scroll-hint--hide');
          setTimeout(() => {
            scrollHint.style.display = 'none';
          }, 450);
        };

        window.addEventListener('scroll', () => {
          if (window.scrollY > 40) {
            hideHint();
          }
        });

        // 10秒たっても動かなければ自動で消す
        setTimeout(hideHint, 10000);
      }

      // ささやき音（1インスタンス使い回し）
      let whisperAudio = null;
      function getWhisperAudio() {
        if (!whisperAudio) {
          // 必要ならパスを変更
          whisperAudio = new Audio('https://reverse-shion.github.io/assets/whisper-thanks.mp3');
          whisperAudio.volume = 0.15;
        }
        return whisperAudio;
      }

      // 灯籠を灯す瞬間の光粒子
      function createSparkles(x, y) {
        const sparkles = document.createElement('div');
        sparkles.className = 'sparkles';
        document.body.appendChild(sparkles);

        for (let i = 0; i < 18; i++) {
          const s = document.createElement('div');
          s.className = 'sparkle';
          const offsetX = Math.random() * 120 - 60;
          s.style.left = (x + offsetX) + 'px';
          s.style.top  = y + 'px';
          sparkles.appendChild(s);
        }

        const whisper = getWhisperAudio();
        whisper.currentTime = 0;
        whisper.play().catch(() => {});

        setTimeout(() => {
          sparkles.remove();
        }, 2800);
      }

      function loadPrayers() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [];
        } catch (e) {
          console.warn('Failed to parse prayers from localStorage', e);
          return [];
        }
      }

      function savePrayers(prayers) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(prayers));
        } catch (e) {
          console.warn('Failed to save prayers', e);
        }
      }

      function formatDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}/${m}/${d}`;
      }

      function updateCount(prayers) {
        if (!countEl) return;
        const n = prayers.length || 0;
        countEl.textContent = `灯した灯籠：${n}本`;
      }

      function renderList() {
        const prayers = loadPrayers();
        listEl.innerHTML = '';

        if (!prayers.length) {
          const empty = document.createElement('div');
          empty.className = 'lantern-item lantern-item--empty';
          empty.innerHTML = '<div class="lantern-text">まだ灯籠はありません。<br>最初の祈りを、ここに置いてみませんか。</div>';
          listEl.appendChild(empty);
          updateCount(prayers);
          return;
        }

        prayers.forEach(p => {
          const item = document.createElement('div');
          item.className = 'lantern-item';

          const text = document.createElement('div');
          text.className = 'lantern-text';
          text.textContent = p.text;

          const meta = document.createElement('div');
          meta.className = 'lantern-meta';
          meta.textContent = `灯した日：${p.date}`;

          item.appendChild(text);
          item.appendChild(meta);
          listEl.appendChild(item);
        });

        updateCount(prayers);
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const value = (textarea.value || '').trim();
        errorEl.textContent = '';

        if (value.length < 20) {
          errorEl.textContent = '20文字以上で、いまの心をひとつだけ書いてみてください。';
          return;
        }
        if (value.length > 220) {
          errorEl.textContent = '220文字以内でお願いします。';
          return;
        }

        const prayers = loadPrayers();
        prayers.unshift({
          text: value,
          date: formatDate(new Date())
        });

        if (prayers.length > 50) {
          prayers.length = 50;
        }

        savePrayers(prayers);
        textarea.value = '';
        renderList();

        // ボタン位置から光が立ち上がる
        if (submitBtn) {
          const rect = submitBtn.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          createSparkles(x, y);
        }
      });

      // 初期表示
      renderList();
    })();
  </script>
</body>
</html>
