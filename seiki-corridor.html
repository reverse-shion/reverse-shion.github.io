<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>星祈の回廊 — Corridor of Star Prayers | 詩韻 Shion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="星祈の回廊 — Corridor of Star Prayers。時間も空間も越えて、祈りの灯籠が静かに並ぶ場所。あなたの言葉は、ここで一人ではない。">
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@500;700&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="seiki-corridor.css">
</head>
<body>
  <!-- 星の背景 -->
  <div class="starfield" aria-hidden="true"></div>
  <!-- 縦にのびる光の回廊ライン -->
  <div class="path-line" aria-hidden="true">
    <div class="path-glow"></div>
  </div>

  <div class="corridor-shell">
    <!-- ヘッダー -->
    <header class="site-header">
      <div class="title-block">
        <h1>星祈の回廊</h1>
        <span class="en">CORRIDOR OF STAR PRAYERS</span>
      </div>
      <p class="subtitle">―― 時間も空間も外れた、祈りだけが歩いていける場所</p>
      <div class="header-line" aria-hidden="true"></div>
    </header>

    <!-- メイン：下スクロールで“降りていく”回廊 -->
    <main class="corridor-main" aria-label="星祈の回廊">

      <!-- 1. 入口：ここがどんな場所か -->
      <section class="corridor-section section-intro">
        <article class="card card-intro">
          <div class="intro-label">Seiki Corridor — Entrance</div>
          <h2>ここは、星祈の回廊。</h2>
          <div class="intro-body">
            <p>
              ここは、時間も空間も<br>
              いったん脇に置かれた場所です。
            </p>
            <p>
              あなたが心の灯をひとつ置くたびに、<br>
              この回廊のどこかに、静かな光がひとつ増えていきます。
            </p>
            <p>
              下へ進むほど、現実のざわめきは遠のき、<br>
              祈りだけが、星のように残っていく。
            </p>
            <p>
              どうか、あわてずに。<br>
              ゆっくりと、階（きざはし）を降りるみたいに<br>
              スクロールしてみてください。
            </p>
          </div>
          <div class="scroll-down-hint">
            ゆっくり下へ降りていくと、あなたの灯籠を置ける場所にたどり着きます
            <span class="arrow">↓</span>
          </div>
        </article>
      </section>

      <!-- 2. 回廊の灯りイメージ（“一人じゃない”を強調） -->
      <section class="corridor-section section-lanterns">
        <article class="card card-lantern-concept">
          <h3>ここには、見えない数だけの灯籠がある。</h3>
          <div class="lantern-concept-body">
            <p>
              いま画面に見えているのは、<br>
              この端末の中に並ぶ、あなただけの星祈の回廊です。
            </p>
            <p>
              けれど、世界のどこかにも<br>
              同じように、誰かが静かに灯している光がある。
            </p>
            <p>
              それぞれの回廊は、姿かたちは違っても、<br>
              みな同じ星空の下で、どこかでつながっている。
            </p>
            <p>
              あなたがここで灯した言葉は、<br>
              いつかSNSを通して、別の誰かの夜に届くかもしれません。<br>
              そのとき、あなたはもう、決して一人ではありません。
            </p>
          </div>
        </article>
      </section>

      <!-- 3. あなたの灯籠 -->
      <section class="corridor-section section-user" aria-label="あなたの灯籠">
        <article class="card card-user">
          <div class="card-user-header">
            <h3>あなたの灯籠を、ここに。</h3>
            <p>
              悲しみでも、希望でも、誰かへの祈りでも。<br>
              ことばにならないものを、ことばの手前のまま<br>
              そっと置いてもかまいません。
            </p>
            <p>
              ここに置かれた灯籠は、<br>
              この端末の中であなただけの回廊を照らしながら、<br>
              望めば SNS を通して、星空の向こう側へも届いていきます。
            </p>
          </div>

          <!-- 灯籠フォーム -->
          <form class="prayer-form" id="prayerForm">
            <textarea id="prayerText" maxlength="220"
              placeholder="例：&quot;今日もなんとかここまで来られた。少しだけ、明日も信じてみる。&quot;"></textarea>
            <div class="prayer-form-footer">
              <div class="prayer-hint">
                20〜220文字程度で、いまの心をひとつだけ書いてください。
              </div>
              <button type="submit" class="btn-primary" id="submitPrayer">
                <span>灯籠を灯す</span> ✶
              </button>
            </div>
            <div class="prayer-error" id="prayerError"></div>
          </form>

          <!-- あなたが灯してきた灯籠 -->
          <div class="lantern-list-block">
            <div class="lantern-list-title">この回廊に、これまで灯した灯籠</div>
            <div class="lantern-list" id="lanternList" aria-label="これまでに灯した灯籠"></div>
          </div>

          <!-- SNSシェアブロック -->
          <div class="share-block" id="shareBlock">
            <div class="share-title">あなたの灯籠を、星の外側にも。</div>
            <p class="share-text">
              いま灯した言葉を、そのままSNSに流すことができます。<br>
              誰かのタイムラインに、そっと一行の光を置くイメージで。
            </p>
            <div class="share-preview" id="sharePreview"></div>
            <div class="share-buttons">
              <button type="button" class="btn-secondary" id="copyShare">テキストをコピー</button>
              <button type="button" class="btn-secondary btn-secondary--accent" id="tweetShare">X でシェア</button>
            </div>
            <div class="share-status" id="shareStatus"></div>
          </div>
        </article>
      </section>

      <!-- 4. 星環のゲートへの導線（セレフィアスの領域） -->
      <section class="corridor-section section-gate" aria-label="星環のゲート">
        <article class="card card-gate">
          <div class="gate-label">Seikan Gate — 星環のゲート</div>
          <h3>この先に、“セレフィアス”が待つ。</h3>
          <div class="gate-body">
            <p>
              回廊をここまで降りてきたあなたは、<br>
              もうひとつ先の扉の前に立っています。
            </p>
            <p>
              星と星の輪（リング）が重なりあう場所。<br>
              そこが、セレフィアスの囁きが満ちる<br>
              「星環のゲート」です。
            </p>
            <p>
              毎月 1 日と 15 日、<br>
              ゲートはひとときだけ開き、<br>
              星霊のことばが一行だけ、この世界へ降りてきます。
            </p>
            <p>
              もし、いま心がその声を求めているなら——<br>
              そっと、扉に手を触れてみてください。
            </p>
          </div>

          <a class="gate-button" href="seikan-gate.html">
            <span class="gate-button-label">星環のゲートをくぐる</span>
            <span class="gate-button-sub">セレフィアスの囁きを受け取る</span>
          </a>
        </article>
      </section>

    </main>

    <!-- フッターナビ -->
    <footer class="site-footer" aria-label="星祈の回廊ナビゲーション">
      <span class="footer-label">他の星への扉：</span>
      <nav class="footer-links">
        <a class="footer-link" href="https://reverse-shion.github.io/ncode-field.html">詩韻思想へアクセス</a>
        <a class="footer-link" href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener">TAROT BREAKER を読む</a>
        <a class="footer-link" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">個人鑑定をみる</a>
      </nav>
    </footer>
  </div>

  <!-- 灯籠点灯時の光粒子 -->
  <div class="sparkles" id="sparklesRoot" aria-hidden="true"></div>

  <!-- ロジック：ローカル灯籠 + エフェクト + SNSシェア -->
  <script>
    (function() {
      const STORAGE_KEY = 'seiki_corridor_prayers_v1';

      const form        = document.getElementById('prayerForm');
      const textarea    = document.getElementById('prayerText');
      const errorEl     = document.getElementById('prayerError');
      const listEl      = document.getElementById('lanternList');
      const submitBtn   = document.getElementById('submitPrayer');
      const sparklesRoot = document.getElementById('sparklesRoot');

      const shareBlock  = document.getElementById('shareBlock');
      const sharePreview= document.getElementById('sharePreview');
      const shareStatus = document.getElementById('shareStatus');
      const copyShareBtn= document.getElementById('copyShare');
      const tweetShareBtn=document.getElementById('tweetShare');

      let lastPrayerText = "";

      // ささやき音（必要なら差し替え）
      let whisperAudio = null;
      function getWhisperAudio() {
        if (!whisperAudio) {
          whisperAudio = new Audio('https://reverse-shion.github.io/assets/whisper-thanks.mp3');
          whisperAudio.volume = 0.18;
        }
        return whisperAudio;
      }

      // 光粒子エフェクト
      function createSparkles(x, y) {
        if (!sparklesRoot) return;
        sparklesRoot.innerHTML = '';

        for (let i = 0; i < 18; i++) {
          const s = document.createElement('div');
          s.className = 'sparkle';
          const offsetX = Math.random() * 120 - 60;
          const offsetY = Math.random() * 20 - 10;
          s.style.left = (x + offsetX) + 'px';
          s.style.top  = (y + offsetY) + 'px';
          sparklesRoot.appendChild(s);
        }

        const whisper = getWhisperAudio();
        whisper.currentTime = 0;
        whisper.play().catch(() => {});
        
        setTimeout(() => {
          if (sparklesRoot) sparklesRoot.innerHTML = '';
        }, 2600);
      }

      // ローカルストレージ
      function loadPrayers() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [];
        } catch(e) {
          console.warn('Failed to parse prayers', e);
          return [];
        }
      }

      function savePrayers(prayers) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(prayers));
        } catch(e) {
          console.warn('Failed to save prayers', e);
        }
      }

      function formatDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return y + '/' + m + '/' + d;
      }

      // 灯籠リスト描画
      function renderList() {
        const prayers = loadPrayers();
        listEl.innerHTML = '';

        if (!prayers.length) {
          const empty = document.createElement('div');
          empty.className = 'lantern-item lantern-item--empty';
          empty.innerHTML = '<div class="lantern-text">まだ灯籠はありません。<br>最初の祈りを、ここに置いてみませんか。</div>';
          listEl.appendChild(empty);
          return;
        }

        prayers.forEach(p => {
          const item = document.createElement('div');
          item.className = 'lantern-item';

          const text = document.createElement('div');
          text.className = 'lantern-text';
          text.textContent = p.text;

          const meta = document.createElement('div');
          meta.className = 'lantern-meta';
          meta.textContent = '灯した日：' + p.date;

          item.appendChild(text);
          item.appendChild(meta);
          listEl.appendChild(item);
        });
      }

      // シェアUI更新
      function updateShareUI() {
        if (!shareBlock || !sharePreview) return;
        if (!lastPrayerText) {
          shareBlock.classList.remove('is-active');
          sharePreview.textContent = '';
          if (shareStatus) shareStatus.textContent = '';
          return;
        }
        const shareText = '「' + lastPrayerText + '」\n\n#星祈の回廊 #詩韻思想';
        sharePreview.textContent = shareText;
        shareBlock.classList.add('is-active');
        if (shareStatus) shareStatus.textContent = '';
      }

      // フォーム送信
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const value = (textarea.value || '').trim();
        errorEl.textContent = '';
        if (shareStatus) shareStatus.textContent = '';

        if (value.length < 20) {
          errorEl.textContent = '20文字以上で、いまの心をひとつだけ書いてみてください。';
          return;
        }
        if (value.length > 220) {
          errorEl.textContent = '220文字以内でお願いします。';
          return;
        }

        const prayers = loadPrayers();
        prayers.unshift({
          text: value,
          date: formatDate(new Date())
        });
        if (prayers.length > 50) prayers.length = 50;

        savePrayers(prayers);
        textarea.value = '';
        lastPrayerText = value;
        renderList();
        updateShareUI();

        if (submitBtn) {
          const rect = submitBtn.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          createSparkles(x, y);
        }
      });

      // コピー
      if (copyShareBtn) {
        copyShareBtn.addEventListener('click', function() {
          if (!lastPrayerText) return;
          const text = '「' + lastPrayerText + '」\n\n#星祈の回廊 #詩韻思想';
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
              if (shareStatus) shareStatus.textContent = 'テキストをコピーしました。';
            }).catch(() => {
              if (shareStatus) shareStatus.textContent = 'コピーに失敗しました。手動で選択してください。';
            });
          } else {
            // 古い環境向けフォールバック
            if (shareStatus) shareStatus.textContent = 'コピー非対応の環境です。テキストを長押しして選択してください。';
          }
        });
      }

      // X（旧Twitter）でシェア
      if (tweetShareBtn) {
        tweetShareBtn.addEventListener('click', function() {
          if (!lastPrayerText) return;
          const text = '「' + lastPrayerText + '」\n\n#星祈の回廊 #詩韻思想';
          const url  = location.origin + location.pathname;
          const tweetUrl = 'https://twitter.com/intent/tweet?text=' +
            encodeURIComponent(text) +
            '&url=' + encodeURIComponent(url);
          window.open(tweetUrl, '_blank', 'noopener');
        });
      }

      // 初期表示
      renderList();
      updateShareUI();
    })();
  </script>
</body>
</html>
