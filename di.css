/* di.css — DiCo ARU Phase1 (FULL INTEGRATION) */

/* =========================
   TOKENS
   ========================= */
:root{
  --bg:#05060b;

  --txt: rgba(245,245,245,.92);
  --muted: rgba(245,245,245,.65);

  --cyan: rgba(0,240,255,.95);
  --vio:  rgba(156,60,255,.95);
  --gold: rgba(230,201,107,.95);

  --glass: rgba(255,255,255,.06);
  --line:  rgba(255,255,255,.14);

  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);
  --vh: 1vh;

  /* 上HUDはスクショ寄せでは使わない（保持はするが見せない） */
  --hudH: 0px;

  --btnH: 74px;

  /* shared with JS */
  --hitY: 78%;

  /* lane */
  --laneW: min(520px, 86vw);
  --laneDark: rgba(0,0,0,.34);
  --laneDark2: rgba(0,0,0,.56);

  /* lane edge guide */
  --laneEdge: rgba(0,240,255,.22);
  --laneEdge2: rgba(156,60,255,.12);

  /* hit zone flash */
  --hitGlow: rgba(0,240,255,.22);
  --hitGlowGold: rgba(230,201,107,.20);
}

/* =========================
   RESET / iOS SAFETY
   ========================= */
*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; }
body{
  margin:0;
  background:var(--bg);
  color:var(--txt);
  font-family: system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
  overflow:hidden;
  overscroll-behavior:none;
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none;
  touch-action:none; /* canvas & buttons only */
}

button{
  -webkit-appearance:none; appearance:none;
  border:none; background:none; color:inherit; font:inherit;
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none;
}

/* =========================
   APP ROOT
   ========================= */
.app{
  position:fixed;
  inset:0;
  width:100%;
  height: calc(var(--vh) * 100);
  padding-top: var(--safeT);
  padding-bottom: var(--safeB);
  overflow:hidden;
  background:
    radial-gradient(circle at 22% 18%, rgba(0,240,255,.08), transparent 55%),
    radial-gradient(circle at 82% 72%, rgba(156,60,255,.06), transparent 58%),
    linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.35));
}

/* background video — 明るさ維持 */
.bgVideo{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;

  /* 暗さの主因だったので上げる */
  opacity:.55;

  /* 明るさを保ちつつ、映像が綺麗に出る方向 */
  filter: saturate(1.18) contrast(1.08) brightness(1.12);

  transform: translateZ(0);
  z-index:1;
  pointer-events:none;
}

/* fx layer (tap-through) */
.fxLayer{
  position:absolute; inset:0;
  z-index:9;
  pointer-events:none;
  overflow:hidden;
}

/* =========================
   TOP HUD (kept but hidden)
   ========================= */
.hud{
  position:fixed;
  top: calc(var(--safeT) + 10px);
  left:0; right:0;
  z-index:30;
  padding: 0 14px;
  display:grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  gap:12px;
  pointer-events:none;

  /* hide for screenshot-style */
  opacity:0;
  visibility:hidden;
  transform: translateY(-6px);
}

.hudBlock{ display:flex; flex-direction:column; gap:4px; }
.hudCenter{ align-items:center; gap:10px; }
.hudRight{ align-items:flex-end; }

.hudLabel{
  font-size:12px;
  letter-spacing:.12em;
  color:var(--muted);
}
.hudValue{
  font-size:22px;
  font-weight:900;
  text-shadow: 0 0 18px rgba(0,240,255,.25);
}
.hudCombo{ display:flex; gap:10px; align-items:baseline; }
.hudCombo .hudValue{ font-size:26px; }
.hudSmall{ display:flex; gap:10px; align-items:baseline; }
.hudSmall .hudValue{ font-size:18px; opacity:.9; }

/* =========================
   STAGE
   ========================= */
.stage{
  position:fixed;
  top: calc(var(--safeT) + var(--hudH));
  left:0; right:0;
  bottom: calc(var(--safeB) + var(--btnH));
  z-index:20;
  overflow:hidden;
}

/* Lane board：中央だけ暗く（よくある音ゲー板） + 両端ガイド光 */
.stage::before{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  width: var(--laneW);
  height:100%;
  transform: translateX(-50%);
  z-index:22;
  pointer-events:none;

  background:
    /* 左端ガイド */
    linear-gradient(90deg,
      rgba(0,0,0,0),
      rgba(0,0,0,0) 6px,
      var(--laneEdge) 10px,
      rgba(0,0,0,0) 18px,
      rgba(0,0,0,0) 40px),
    /* 右端ガイド */
    linear-gradient(270deg,
      rgba(0,0,0,0),
      rgba(0,0,0,0) 6px,
      var(--laneEdge) 10px,
      rgba(0,0,0,0) 18px,
      rgba(0,0,0,0) 40px),
    /* バイオレット縁光 */
    linear-gradient(90deg,
      var(--laneEdge2),
      rgba(0,0,0,0) 18%,
      rgba(0,0,0,0) 82%,
      var(--laneEdge2)),
    /* レーン板本体 */
    linear-gradient(180deg,
      rgba(255,255,255,.04),
      var(--laneDark) 18%,
      var(--laneDark2) 100%);

  border-left: 1px solid rgba(255,255,255,.10);
  border-right:1px solid rgba(255,255,255,.10);

  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

  box-shadow:
    inset 0 0 26px rgba(0,240,255,.06),
    inset 0 0 22px rgba(156,60,255,.05),
    0 0 0 1px rgba(0,0,0,.18),
    0 26px 80px rgba(0,0,0,.22);
}

.noteCanvas{
  position:absolute; inset:0;
  width:100%; height:100%;
  z-index:26;
  pointer-events:auto;          /* ONLY TAP LAYER */
  touch-action: manipulation;
}

/* judgement line hint */
.stage::after{
  content:"";
  position:absolute;
  left:50%;
  top: var(--hitY);
  width: var(--laneW);
  height:2px;
  transform: translate(-50%, -50%);
  background: linear-gradient(90deg, transparent, rgba(0,240,255,.78), transparent);
  opacity:.72;
  z-index:27;
  pointer-events:none;
}

/* 判定帯（HTMLに <div class="hitZone" id="hitZone"></div> を入れてね） */
.hitZone{
  position:absolute;
  left:50%;
  top: var(--hitY);
  width: var(--laneW);
  height: 96px;
  transform: translate(-50%, -50%);
  z-index:23;
  pointer-events:none;

  background:
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.08), transparent 62%),
    linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent);

  border-top: 1px solid rgba(255,255,255,.10);
  border-bottom:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 0 28px rgba(0,240,255,.06);
}

/* ノーツが判定帯に入った瞬間：軽く発光（JSでclass付与） */
.hitZone.flash{ animation: hitZoneFlash .14s ease-out both; }
.hitZone.flash.good{ --zg: var(--hitGlow); }
.hitZone.flash.great{ --zg: var(--hitGlowGold); }

@keyframes hitZoneFlash{
  0%{
    filter: brightness(1);
    box-shadow:
      inset 0 0 28px rgba(0,240,255,.06),
      0 0 0 rgba(0,0,0,0);
  }
  35%{
    filter: brightness(1.08);
    box-shadow:
      inset 0 0 42px var(--zg),
      0 0 22px rgba(0,240,255,.10);
  }
  100%{
    filter: brightness(1);
    box-shadow:
      inset 0 0 28px rgba(0,240,255,.06),
      0 0 0 rgba(0,0,0,0);
  }
}

/* Target (visual only) */
.targetRoot{
  position:absolute;
  left:50%;
  top: var(--hitY);
  width:min(260px, 56vw);
  aspect-ratio:1/1;
  transform: translate(-50%,-50%);
  z-index:28;
  pointer-events:none;
  filter: drop-shadow(0 0 22px rgba(0,240,255,.16));
  opacity:.96;
}

.targetOuter,.targetCore,.targetRing,.scanLine,.hitFlash{
  position:absolute; inset:0;
  border-radius:999px;
}

.targetOuter{
  border:1px solid rgba(255,255,255,.22);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), transparent 55%),
    radial-gradient(circle at 60% 70%, rgba(0,240,255,.10), transparent 58%),
    conic-gradient(from 90deg,
      rgba(0,240,255,.0) 0 18%,
      rgba(0,240,255,.18) 18% 19%,
      rgba(156,60,255,.0) 19% 44%,
      rgba(156,60,255,.12) 44% 45%,
      rgba(0,240,255,.0) 45% 100%);
  box-shadow:
    inset 0 0 26px rgba(0,240,255,.10),
    inset 0 0 18px rgba(156,60,255,.06);
}

.targetCore{
  inset:28%;
  border:1px solid rgba(0,240,255,.16);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.22), transparent 55%),
    radial-gradient(circle, rgba(0,240,255,.18), transparent 62%);
  box-shadow: 0 0 22px rgba(0,240,255,.14);
  animation: corePulse 1.15s ease-in-out infinite;
}
@keyframes corePulse{
  0%,100%{ transform: scale(.98); opacity:.86; }
  50%{ transform: scale(1.06); opacity:1; }
}

.targetRing{
  inset:10%;
  border:1px dashed rgba(0,240,255,.26);
  opacity:.85;
}

.scanLine{
  background: conic-gradient(from 0deg, rgba(0,240,255,0), rgba(0,240,255,.18), rgba(0,240,255,0));
  mask: radial-gradient(circle, transparent 52%, #000 53%);
  opacity:.52;
  animation: scanSpin 2.6s linear infinite;
}
@keyframes scanSpin{ to{ transform: rotate(360deg); } }

/* Hit flash intensity (GOOD vs GREAT) */
.hitFlash{
  opacity:0;
  mix-blend-mode: screen;
  pointer-events:none;
}
.targetRoot.good .hitFlash{
  opacity:1;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.16), transparent 62%),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.08), transparent 70%);
  animation: hitPop .18s ease-out both;
}
.targetRoot.great .hitFlash{
  opacity:1;
  background:
    radial-gradient(circle at 50% 50%, rgba(230,201,107,.18), transparent 58%),
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.12), transparent 70%),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.10), transparent 76%);
  animation: hitPopBig .22s ease-out both;
}
@keyframes hitPop{
  0%{ transform: scale(.96); }
  70%{ transform: scale(1.06); }
  100%{ transform: scale(1.01); opacity:0; }
}
@keyframes hitPopBig{
  0%{ transform: scale(.92); }
  60%{ transform: scale(1.10); }
  100%{ transform: scale(1.03); opacity:0; }
}

/* Judge (near target, short) */
.judge{
  position:absolute;
  left:50%;
  top: calc(var(--hitY) - 92px);
  transform: translateX(-50%);
  z-index:29;
  text-align:center;
  opacity:0;
  pointer-events:none;
  filter: drop-shadow(0 0 18px rgba(0,240,255,.14));
}
.judgeMain{
  font-size:28px;
  font-weight:1000;
  letter-spacing:.14em;
}
.judgeSub{
  margin-top:2px;
  font-size:12px;
  font-weight:900;
  letter-spacing:.28em;
  color: rgba(245,245,245,.78);
}
.judge.show{ animation: judgePop .42s ease-out both; }
.judge.good  .judgeMain{ color: rgba(0,240,255,.95); }
.judge.great .judgeMain{ color: rgba(230,201,107,.95); }
@keyframes judgePop{
  0%{ opacity:0; transform: translateX(-50%) translateY(8px) scale(.96); }
  20%{ opacity:1; }
  100%{ opacity:0; transform: translateX(-50%) translateY(-8px) scale(1.05); }
}

/* =========================
   RESULT OVERLAY
   ========================= */
.result{
  position:absolute; inset:0;
  z-index:40;
  display:grid;
  place-items:center;
  opacity:0;
  pointer-events:none;
  background: rgba(2,3,8,.50);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}
#app[data-state="result"] .result{
  opacity:1;
  pointer-events:auto;
}
.resultCard{
  width:min(520px, 90vw);
  padding:18px 18px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(6,6,12,.64);
  box-shadow: 0 0 56px rgba(0,240,255,.10), 0 0 36px rgba(156,60,255,.08);
}
.resultTitle{
  font-size:14px;
  font-weight:1000;
  letter-spacing:.26em;
  color: rgba(0,240,255,.85);
  margin-bottom:12px;
}
.resultRow{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  gap:12px;
  margin:6px 0;
}
.resultKey{
  font-size:12px;
  letter-spacing:.18em;
  color: rgba(245,245,245,.68);
}
.resultVal{
  font-size:22px;
  font-weight:1000;
  letter-spacing:.06em;
}
.resultDivider{
  height:1px;
  background: rgba(255,255,255,.12);
  margin:14px 0;
}

/* ARU ring */
.aruWrap{ display:grid; gap:12px; }
.aruRing{
  display:grid;
  grid-template-columns: 120px 1fr;
  gap:14px;
  align-items:center;
}
.aruSvg{ width:120px; height:120px; transform: rotate(-90deg); }
.aruTrack{
  fill:none;
  stroke: rgba(255,255,255,.10);
  stroke-width: 10;
}
.aruProg{
  fill:none;
  stroke: url(#aruGrad);
  stroke-width: 10;
  stroke-linecap: round;
  stroke-dasharray: 276.46; /* 2πr (r=44) */
  stroke-dashoffset: 276.46;
  filter: drop-shadow(0 0 10px rgba(0,240,255,.16));
}
.aruText .aruLabel{
  font-size:12px;
  letter-spacing:.18em;
  color: rgba(245,245,245,.68);
  font-weight:900;
}
.aruText .aruValue{
  margin-top:6px;
  font-size:22px;
  font-weight:1000;
  letter-spacing:.08em;
}
.dicoLine{
  font-size:13px;
  font-weight:900;
  letter-spacing:.08em;
  color: rgba(245,245,245,.82);
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
}

/* =========================
   BOTTOM CONTROLS (single definition)
   ========================= */
.bottom{
  position: fixed;
  left:0; right:0; bottom:0;
  z-index: 9999;

  display:grid;
  place-items:center;

  padding: 10px 14px calc(var(--safeB) + 12px);
  pointer-events:auto;
}

.btn{
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.07);
  color: var(--txt);
  padding: 12px 14px;
  border-radius: 14px;
  font-weight:900;
  letter-spacing:.10em;
}
.btn.primary{
  border-color: rgba(0,240,255,.62);
  background: rgba(0,240,255,.20);
  box-shadow: 0 0 24px rgba(0,240,255,.28), inset 0 0 18px rgba(0,240,255,.10);
}
.btn:active{ transform: translateY(1px) scale(.99); }
.btn:focus-visible{ outline:3px solid rgba(255,255,255,.95); outline-offset:3px; }

/* State visibility */
.bottom .btn{ opacity:0; visibility:hidden; pointer-events:none; }

/* idle時 STARTだけ中央にドーン */
#app[data-state="idle"] #startBtn{
  opacity:1; visibility:visible; pointer-events:auto;
  min-height: 84px;
  width: min(560px, 90vw);
  font-size: clamp(24px, 5.6vw, 34px);
  letter-spacing: .22em;
  border-width: 2px;
  margin: 0 auto;
  animation: pulseStart 1.9s ease-in-out infinite;
}
@keyframes pulseStart{
  0%,100%{ transform: scale(1); box-shadow: 0 0 24px rgba(0,240,255,.28), 0 0 42px rgba(156,60,255,.16); }
  50%{ transform: scale(1.03); box-shadow: 0 0 34px rgba(0,240,255,.42), 0 0 56px rgba(156,60,255,.22); }
}

/* running時はSTOP/RESTARTだけ横並び */
#app[data-state="running"] .bottom{
  display:flex;
  justify-content:center;
  gap:10px;
}
#app[data-state="running"] #stopBtn,
#app[data-state="running"] #restartBtn{
  opacity:1; visibility:visible; pointer-events:auto;
}

/* result時はRESTARTだけ */
#app[data-state="result"] #restartBtn{
  opacity:1; visibility:visible; pointer-events:auto;
}

/* =========================
   SIDE HUD (スクショ寄せ)
   ========================= */
.sideHud{
  position: fixed;
  top: calc(var(--safeT) + 14px);
  z-index: 60;
  display: grid;
  gap: 14px;
  pointer-events:none;
  user-select:none;
  text-shadow: 0 0 18px rgba(0,240,255,.14);
}

.sideHudLeft{ left: 16px; width: min(260px, 44vw); }
.sideHudRight{ right: 16px; width: min(420px, 62vw); }

.sideCard{
  padding: 12px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 22px 60px rgba(0,0,0,.35);
}

.sideScoreValue{
  font-size: 34px;
  font-weight: 900;
  letter-spacing: .12em;
}

.sideComboValue{
  font-size: 56px;
  line-height: 1;
  font-weight: 1000;
}
.sideComboLabel{
  margin-top: 6px;
  font-size: 14px;
  letter-spacing: .22em;
  opacity: .78;
}

/* Right block */
.sideTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;

  padding: 10px 12px;
  border-radius: 16px;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.sideNameMain{
  font-size: 34px;
  font-weight: 1000;
  letter-spacing: .10em;
}
.sideNameSub{
  margin-top: 4px;
  font-size: 12px;
  letter-spacing: .28em;
  opacity: .7;
}

.sideAvatar{
  width: 74px; height: 74px;
  border-radius: 999px;
  padding: 4px;
  background:
    radial-gradient(circle at 30% 30%, rgba(90,255,240,.55), rgba(0,0,0,0) 55%),
    linear-gradient(135deg, rgba(230,201,107,.55), rgba(0,240,255,.55));
  box-shadow: 0 0 22px rgba(0,240,255,.18);
}
.dicoFace{
  width:100%; height:100%;
  border-radius: 999px;
  object-fit: cover;
  border: 1px solid rgba(255,255,255,.22);
}

.sideGauge{
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  gap: 12px;

  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.sideGaugeBar{
  height: 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.14);
  overflow:hidden;
}
.sideGaugeFill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(0,240,255,.95), rgba(120,255,235,.95));
  box-shadow: 0 0 18px rgba(0,240,255,.22);
  transition: width 180ms ease;
}
.sideGaugeValue{
  font-size: 18px;
  font-weight: 1000;
  letter-spacing: .06em;
}
.sideGaugeValue .pct{ opacity:.8; margin-left:2px; }
.facePool{ display:none; }

@media (max-width: 520px){
  .sideHudLeft{ width: 46vw; }
  .sideHudRight{ width: 78vw; }
  .sideNameMain{ font-size: 26px; }
  .sideComboValue{ font-size: 46px; }
}

/* =========================
   HOLD FX
   ========================= */
.targetRoot.holding .targetOuter{
  border-color: rgba(230,201,107,.28);
  box-shadow:
    inset 0 0 34px rgba(230,201,107,.12),
    inset 0 0 22px rgba(0,240,255,.10);
  animation: holdHalo 1.0s ease-in-out infinite;
}
@keyframes holdHalo{
  0%,100%{ filter: drop-shadow(0 0 16px rgba(230,201,107,.10)); }
  50%{ filter: drop-shadow(0 0 28px rgba(0,240,255,.14)); }
}

/* =========================
   GREAT FX: exposure up (optional)
   ========================= */
.app.exposureUp .bgVideo{
  opacity: .66;
  filter: saturate(1.45) contrast(1.12) brightness(1.08);
}

/* 画面全体の一瞬フラッシュ（薄め） */
.app.exposureUp::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 50% 55%, rgba(255,210,110,.18), transparent 60%),
    radial-gradient(circle at 50% 55%, rgba(0,240,255,.14), transparent 55%);
  mix-blend-mode: screen;
  opacity: 1;
  animation: exposurePop .22s ease-out both;
}
@keyframes exposurePop{
  0%{ opacity: 0; }
  35%{ opacity: 1; }
  100%{ opacity: 0; }
}

/* =========================
   SR only
   ========================= */
.srOnly{
  position:absolute;
  width:1px; height:1px;
  overflow:hidden;
  clip: rect(0,0,0,0);
  white-space:nowrap;
  clip-path: inset(50%);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .targetCore,.scanLine,#app[data-state="idle"] #startBtn{ animation:none !important; }
}

/* =========================
   Z ORDER SAFETY (explicit)
   ========================= */
.stage::before{ z-index:22; }   /* lane board */
.hitZone{ z-index:23; }         /* hit band */
.noteCanvas{ z-index:26; }      /* notes */
.stage::after{ z-index:27; }    /* judge line */
.targetRoot{ z-index:28; }      /* target */
.judge{ z-index:29; }           /* judge text */
