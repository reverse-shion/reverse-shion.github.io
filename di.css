/* di.css — DiCo ARU Phase1 (IRIS-ish HUD + Thin Lane + Guide Light + HitBand) */
:root{
  --bg:#05060b;

  --txt: rgba(245,245,245,.92);
  --muted: rgba(245,245,245,.65);

  --cyan: rgba(0,240,255,.95);
  --vio:  rgba(156,60,255,.95);
  --gold: rgba(230,201,107,.95);

  --glass: rgba(255,255,255,.06);
  --line:  rgba(255,255,255,.14);

  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);
  --vh: 1vh;

  /* shared with JS */
  --hitY: 78%;

  /* lane */
  --laneW: min(420px, 76vw);     /* ← レーン太すぎ問題：ここで細く */
  --laneEdgeGlow: rgba(0,240,255,.22);
  --laneEdgeLine: rgba(255,255,255,.10);
}

*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; }
body{
  margin:0;
  background:var(--bg);
  color:var(--txt);
  font-family: system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
  overflow:hidden;
  overscroll-behavior:none;
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none;
  touch-action:none;
}

button{
  -webkit-appearance:none; appearance:none;
  border:none; background:none; color:inherit; font:inherit;
  -webkit-user-select:none; user-select:none;
  -webkit-touch-callout:none;
}

.app{
  position:fixed;
  inset:0;
  width:100%;
  height: calc(var(--vh) * 100);
  padding-top: var(--safeT);
  padding-bottom: var(--safeB);
  overflow:hidden;
  background:
    radial-gradient(circle at 22% 18%, rgba(0,240,255,.08), transparent 55%),
    radial-gradient(circle at 82% 72%, rgba(156,60,255,.06), transparent 58%),
    linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.35));
}

/* background video */
.bgVideo{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  opacity:.30;                 /* ← レーン細くした分、動画見せる */
  filter: saturate(1.25) contrast(1.06);
  transform: translateZ(0);
  z-index:1;
  pointer-events:none;
}

/* fx layer (tap-through) */
.fxLayer{
  position:absolute; inset:0;
  z-index:9;
  pointer-events:none;
  overflow:hidden;
}

/* =========================
   HUD — IRIS-ish (NO OVERLAP)
   ========================= */
.hud{
  position:fixed;
  top: calc(var(--safeT) + 10px);
  left:0; right:0;
  z-index:30;
  padding: 0 14px;
  display:grid;
  grid-template-columns: 1fr auto;  /* ← 左=数値 / 右=IRIS */
  gap:12px;
  align-items:start;
  pointer-events:none;
}

/* 旧hudCenterは使わない（残ってても潰す） */
.hudCenter{ display:none !important; }

.hudLeft{
  display:flex;
  flex-direction:column;
  gap:10px;
  min-width: 0;
}

.hudCard{
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 18px 60px rgba(0,0,0,.28);
  overflow:hidden;
}

.hudCardInner{
  padding:14px 14px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.hudRow{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  gap:12px;
}

.hudTitle{
  font-size:12px;
  letter-spacing:.22em;
  color:var(--muted);
}

.hudBig{
  font-size:34px;
  font-weight:1000;
  letter-spacing:.06em;
  text-shadow: 0 0 18px rgba(0,240,255,.22);
}

.hudSub{
  font-size:12px;
  letter-spacing:.22em;
  color: rgba(245,245,245,.58);
}

/* LEFT numbers (score/combo) */
#score{ font-variant-numeric: tabular-nums; }
#combo{ font-variant-numeric: tabular-nums; }

/* =========================
   IRIS HUD (right)
   ========================= */
.irisHud{
  width: min(380px, 54vw);
  pointer-events:none;
}

.irisTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px 14px;
}

.irisName{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 0;
}
.irisName .n0{
  font-size:34px;
  font-weight:1000;
  letter-spacing:.08em;
}
.irisName .n1{
  font-size:12px;
  letter-spacing:.30em;
  color: rgba(245,245,245,.58);
}

/* ring */
.irisRing{
  position:relative;
  width:84px;
  height:84px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), transparent 58%),
    radial-gradient(circle at 55% 65%, rgba(0,240,255,.12), transparent 62%),
    conic-gradient(from 90deg, rgba(0,240,255,.0), rgba(0,240,255,.18), rgba(156,60,255,.10), rgba(0,240,255,.0));
  box-shadow:
    inset 0 0 22px rgba(0,240,255,.10),
    0 0 30px rgba(0,240,255,.10);
  transform: rotate(var(--irisRot, 0deg));
  transition: transform 220ms cubic-bezier(.2,.9,.2,1);
  overflow:hidden;
}
.irisRing::after{
  content:"";
  position:absolute;
  inset:10px;
  border-radius:999px;
  border:1px solid rgba(0,240,255,.14);
  background: rgba(0,0,0,.18);
}
.irisRing .irisAvatar{
  position:absolute;
  inset:14px;
  border-radius:999px;
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.22), transparent 60%),
    radial-gradient(circle at 60% 70%, rgba(0,240,255,.20), transparent 65%),
    rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 0 18px rgba(0,0,0,.18);
}

/* ring tick */
.irisRing.tick{
  transition: transform 120ms cubic-bezier(.2,.9,.2,1);
  transform: rotate(calc(var(--irisRot, 0deg) + 10deg));
}

/* resonance bar */
.irisBar{
  padding: 0 14px 14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.irisBarRow{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  gap:12px;
}
.irisBarRow .lbl{
  font-size:12px;
  letter-spacing:.30em;
  color: rgba(245,245,245,.62);
}
.irisBarRow .pct{
  font-size:22px;
  font-weight:1000;
  letter-spacing:.08em;
  font-variant-numeric: tabular-nums;
}
.irisTrack{
  height:18px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.06);
  overflow:hidden;
}
.irisFill{
  height:100%;
  width: 0%;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(0,240,255,.95), rgba(156,60,255,.70));
  box-shadow: 0 0 22px rgba(0,240,255,.22);
  transition: width 220ms cubic-bezier(.2,.9,.2,1);
}

/* stage */
.stage{
  position:fixed;
  top: calc(var(--safeT) + 140px);    /* HUD分を確保 */
  left:0; right:0;
  bottom: calc(var(--safeB) + 90px);
  z-index:20;
  overflow:hidden;
}

/* thin lane (video visible) */
.stage::before{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  width: var(--laneW);
  height:100%;
  transform: translateX(-50%);
  background:
    linear-gradient(90deg,
      rgba(0,0,0,.00),
      rgba(0,0,0,.08) 18%,
      rgba(0,0,0,.14) 50%,
      rgba(0,0,0,.08) 82%,
      rgba(0,0,0,.00));
  border-left: 1px solid var(--laneEdgeLine);
  border-right:1px solid var(--laneEdgeLine);
  box-shadow:
    0 0 36px rgba(0,240,255,.08);
  pointer-events:none;
}

/* lane guide light (both edges) */
.stage .laneEdge{
  position:absolute;
  top:0; bottom:0;
  width:2px;
  opacity:.75;
  pointer-events:none;
  filter: drop-shadow(0 0 10px rgba(0,240,255,.18));
}
.stage .laneEdge.left{
  left:50%;
  transform: translateX(calc(-.5 * var(--laneW)));
  background: linear-gradient(180deg, transparent, var(--laneEdgeGlow), transparent);
}
.stage .laneEdge.right{
  left:50%;
  transform: translateX(calc(.5 * var(--laneW)));
  background: linear-gradient(180deg, transparent, var(--laneEdgeGlow), transparent);
}

/* judgement band (lights only when note enters window) */
.stage .hitBand{
  position:absolute;
  left:50%;
  top: var(--hitY);
  width: var(--laneW);
  height:72px;
  transform: translate(-50%, -50%);
  opacity:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.16), transparent 62%),
    linear-gradient(90deg, transparent, rgba(0,240,255,.18), transparent);
  mix-blend-mode: screen;
  filter: blur(.2px);
}
.stage.bandOn .hitBand{
  opacity: 1;
  animation: bandPop 120ms ease-out both;
}
@keyframes bandPop{
  0%{ opacity:0; }
  45%{ opacity:1; }
  100%{ opacity:0; }
}

.noteCanvas{
  position:absolute; inset:0;
  width:100%; height:100%;
  z-index:26;
  pointer-events:auto;
  touch-action: manipulation;
}

/* target area */
.targetRoot{
  position:absolute;
  left:50%;
  top: var(--hitY);
  width:min(260px, 56vw);
  aspect-ratio:1/1;
  transform: translate(-50%,-50%);
  z-index:28;
  pointer-events:none;
  filter: drop-shadow(0 0 18px rgba(0,240,255,.12));
  opacity:.96;
}

.targetOuter,.targetCore,.targetRing,.scanLine,.hitFlash{
  position:absolute; inset:0;
  border-radius:999px;
}

.targetOuter{
  border:1px solid rgba(255,255,255,.16);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), transparent 55%),
    radial-gradient(circle at 60% 70%, rgba(0,240,255,.10), transparent 58%),
    conic-gradient(from 90deg,
      rgba(0,240,255,.0) 0 18%,
      rgba(0,240,255,.18) 18% 19%,
      rgba(156,60,255,.0) 19% 44%,
      rgba(156,60,255,.12) 44% 45%,
      rgba(0,240,255,.0) 45% 100%);
  box-shadow:
    inset 0 0 26px rgba(0,240,255,.10),
    inset 0 0 18px rgba(156,60,255,.06);
}

.targetCore{
  inset:28%;
  border:1px solid rgba(0,240,255,.16);
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.22), transparent 55%),
    radial-gradient(circle, rgba(0,240,255,.18), transparent 62%);
  box-shadow: 0 0 22px rgba(0,240,255,.14);
  animation: corePulse 1.15s ease-in-out infinite;
}
@keyframes corePulse{
  0%,100%{ transform: scale(.98); opacity:.86; }
  50%{ transform: scale(1.06); opacity:1; }
}

.targetRing{
  inset:10%;
  border:1px dashed rgba(0,240,255,.20);
  opacity:.70;
}

.scanLine{
  background: conic-gradient(from 0deg, rgba(0,240,255,0), rgba(0,240,255,.18), rgba(0,240,255,0));
  mask: radial-gradient(circle, transparent 52%, #000 53%);
  opacity:.52;
  animation: scanSpin 2.6s linear infinite;
}
@keyframes scanSpin{ to{ transform: rotate(360deg); } }

/* hit flash */
.hitFlash{ opacity:0; mix-blend-mode: screen; pointer-events:none; }
.targetRoot.good .hitFlash{
  opacity:1;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.16), transparent 62%),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.08), transparent 70%);
  animation: hitPop .18s ease-out both;
}
.targetRoot.great .hitFlash{
  opacity:1;
  background:
    radial-gradient(circle at 50% 50%, rgba(230,201,107,.18), transparent 58%),
    radial-gradient(circle at 50% 50%, rgba(0,240,255,.12), transparent 70%),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.10), transparent 76%);
  animation: hitPopBig .22s ease-out both;
}
@keyframes hitPop{
  0%{ transform: scale(.96); }
  70%{ transform: scale(1.06); }
  100%{ transform: scale(1.01); opacity:0; }
}
@keyframes hitPopBig{
  0%{ transform: scale(.92); }
  60%{ transform: scale(1.10); }
  100%{ transform: scale(1.03); opacity:0; }
}

/* HOLD aura */
.targetRoot.holding .targetOuter{
  border-color: rgba(230,201,107,.28);
  box-shadow:
    inset 0 0 34px rgba(230,201,107,.12),
    inset 0 0 22px rgba(0,240,255,.10);
  animation: holdHalo 1.0s ease-in-out infinite;
}
@keyframes holdHalo{
  0%,100%{ filter: drop-shadow(0 0 16px rgba(230,201,107,.10)); }
  50%{ filter: drop-shadow(0 0 28px rgba(0,240,255,.14)); }
}

/* judge text */
.judge{
  position:absolute;
  left:50%;
  top: calc(var(--hitY) - 92px);
  transform: translateX(-50%);
  z-index:29;
  text-align:center;
  opacity:0;
  pointer-events:none;
  filter: drop-shadow(0 0 18px rgba(0,240,255,.14));
}
.judgeMain{
  font-size:28px;
  font-weight:1000;
  letter-spacing:.14em;
}
.judgeSub{
  margin-top:2px;
  font-size:12px;
  font-weight:900;
  letter-spacing:.28em;
  color: rgba(245,245,245,.78);
}
.judge.show{ animation: judgePop .42s ease-out both; }
.judge.good  .judgeMain{ color: rgba(0,240,255,.95); }
.judge.great .judgeMain{ color: rgba(230,201,107,.95); }
@keyframes judgePop{
  0%{ opacity:0; transform: translateX(-50%) translateY(8px) scale(.96); }
  20%{ opacity:1; }
  100%{ opacity:0; transform: translateX(-50%) translateY(-8px) scale(1.05); }
}

/* bottom controls */
.bottom{
  position: fixed;
  left:0; right:0; bottom:0;
  z-index: 9999;
  display:grid;
  place-items:center;
  padding: 10px 14px calc(var(--safeB) + 12px);
  pointer-events:auto;
}
.btn{
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.07);
  color: var(--txt);
  padding: 12px 14px;
  border-radius: 14px;
  font-weight:900;
  letter-spacing:.10em;
}
.btn.primary{
  border-color: rgba(0,240,255,.62);
  background: rgba(0,240,255,.20);
  box-shadow: 0 0 24px rgba(0,240,255,.28), inset 0 0 18px rgba(0,240,255,.10);
}
.btn:active{ transform: translateY(1px) scale(.99); }
.btn:focus-visible{ outline:3px solid rgba(255,255,255,.95); outline-offset:3px; }

/* state visibility */
.bottom .btn{ opacity:0; visibility:hidden; pointer-events:none; }
#app[data-state="idle"] #startBtn{
  opacity:1; visibility:visible; pointer-events:auto;
  min-height: 84px;
  width: min(560px, 90vw);
  font-size: clamp(24px, 5.6vw, 34px);
  letter-spacing: .22em;
  border-width: 2px;
  margin: 0 auto;
  animation: pulseStart 1.9s ease-in-out infinite;
}
@keyframes pulseStart{
  0%,100%{ transform: scale(1); box-shadow: 0 0 24px rgba(0,240,255,.28), 0 0 42px rgba(156,60,255,.16); }
  50%{ transform: scale(1.03); box-shadow: 0 0 34px rgba(0,240,255,.42), 0 0 56px rgba(156,60,255,.22); }
}
#app[data-state="running"] .bottom{ display:flex; justify-content:center; gap:10px; }
#app[data-state="running"] #stopBtn,
#app[data-state="running"] #restartBtn{ opacity:1; visibility:visible; pointer-events:auto; }
#app[data-state="result"] #restartBtn{ opacity:1; visibility:visible; pointer-events:auto; }

/* exposure (GREAT) */
.app.exposureUp .bgVideo{
  opacity: .46;
  filter: saturate(1.45) contrast(1.12) brightness(1.08);
}
.app.exposureUp::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 50% 55%, rgba(255,210,110,.18), transparent 60%),
    radial-gradient(circle at 50% 55%, rgba(0,240,255,.14), transparent 55%);
  mix-blend-mode: screen;
  opacity: 1;
  animation: exposurePop .22s ease-out both;
}
@keyframes exposurePop{
  0%{ opacity: 0; }
  35%{ opacity: 1; }
  100%{ opacity: 0; }
}

/* SR only */
.srOnly{
  position:absolute;
  width:1px; height:1px;
  overflow:hidden;
  clip: rect(0,0,0,0);
  white-space:nowrap;
  clip-path: inset(50%);
}

@media (prefers-reduced-motion: reduce){
  .targetCore,.scanLine,#app[data-state="idle"] #startBtn{ animation:none !important; }
}
