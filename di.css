:root{
  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);
  --vh: 1vh;
  --hudH: 92px;
  --controlH: 112px;
  --hitY: 74%;
  --c-cyan:#00f0ff;
  --c-gold:#e6c96b;
  --c-vio:#9c3cff;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;margin:0;overflow:hidden;overscroll-behavior:none;background:#05060b;color:#eef;font-family:system-ui,-apple-system,sans-serif;touch-action:none;-webkit-user-select:none;user-select:none;}
.app{position:fixed;inset:0;height:calc(var(--vh) * 100);padding-top:var(--safeT);padding-bottom:var(--safeB);overflow:hidden;}
.bgVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.32;filter:saturate(1.2) contrast(1.04);z-index:1;pointer-events:none;transition:filter .4s ease,opacity .4s ease;}

.fxLayer,.mythLayer,.underlay,.overlay,.hud,.judgeText,.upgradeOverlay,.godMode,.godFlash{pointer-events:none;}
.mythLayer{position:absolute;inset:0;z-index:3;}
.mythLayer::before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 20% 20%,rgba(0,240,255,.08),transparent 45%),radial-gradient(circle at 80% 75%,rgba(156,60,255,.08),transparent 48%),radial-gradient(circle at 50% 35%,rgba(230,201,107,.08),transparent 58%);}
.hieroRing,.maatScale,.solarDisc,.particleField,.arcanaTriad{display:none;}

.hud{position:fixed;top:0;left:0;right:0;height:var(--hudH);z-index:20;padding:calc(var(--safeT) + 8px) 14px 10px;display:grid;grid-template-columns:1fr 1.5fr 1fr;align-items:end;gap:10px;background:linear-gradient(180deg,rgba(0,0,0,.42),transparent);}
.label{font-size:10px;letter-spacing:.16em;opacity:.65;font-weight:700;}
.value{font-weight:900;font-size:22px;line-height:1;}
.hudMid{display:flex;flex-direction:column;gap:6px;align-items:center;}
.combo .value{font-size:20px;}
.fever{width:min(260px,52vw);}
.feverTop{display:flex;justify-content:space-between;font-size:11px;}
.feverBar{height:8px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden;}
.feverFill{height:100%;width:0;background:linear-gradient(90deg,var(--c-cyan),var(--c-gold),var(--c-vio));box-shadow:0 0 12px rgba(0,240,255,.4);}

.stage{position:fixed;left:0;right:0;top:var(--hudH);bottom:calc(var(--controlH) + var(--safeB));z-index:10;overflow:hidden;}
.overlay{position:absolute;inset:0;z-index:30;}
.noteCanvas{position:absolute;inset:0;z-index:31;pointer-events:auto;touch-action:none;}

.targetRoot{position:absolute;left:50%;top:var(--hitY);translate:-50% -50%;width:min(132px,34vw);aspect-ratio:1/1;z-index:32;}
.targetOuter,.targetCore,.targetHitRing,.scanLine,.holdRing{position:absolute;inset:0;border-radius:50%;}
.targetOuter{border:2px solid rgba(255,255,255,.25);box-shadow:0 0 24px rgba(0,240,255,.16),inset 0 0 24px rgba(255,255,255,.06);}
.targetCore{inset:20%;background:radial-gradient(circle,#7cf8ff 0%,rgba(0,240,255,.36) 42%,transparent 76%);}
.targetHitRing{border:1px dashed rgba(230,201,107,.35);animation:spin 5s linear infinite;}
.scanLine{inset:47% 12%;height:2px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.9),transparent);}
.holdRing{border:2px solid rgba(230,201,107,.55);opacity:0;}

.targetRoot.hit-good .targetOuter{animation:targetPulseGood .26s ease-out;}
.targetRoot.hit-great .targetOuter{animation:targetPulseGreat .3s ease-out;}

.judgeText{position:absolute;left:50%;top:calc(var(--hitY) - 84px);translate:-50% -50%;display:flex;flex-direction:column;align-items:center;line-height:1;z-index:36;opacity:0;}
.judgeMain{font-size:34px;font-weight:1000;letter-spacing:.08em;}
.judgeSub{margin-top:4px;font-size:11px;letter-spacing:.2em;opacity:.8;}
.judgeText.show{animation:judgeOut .4s ease-out both;}
.judgeText.good .judgeMain{text-shadow:0 0 12px rgba(0,240,255,.6),0 0 22px rgba(0,240,255,.35);transform:scale(1.02);}
.judgeText.great .judgeMain{text-shadow:0 0 16px rgba(230,201,107,.9),0 0 34px rgba(156,60,255,.4);transform:scale(1.1);}

.bottom{position:fixed;left:0;right:0;bottom:0;height:calc(var(--controlH) + var(--safeB));padding:12px 16px calc(var(--safeB) + 16px);z-index:60;display:flex;align-items:flex-end;justify-content:center;gap:14px;background:linear-gradient(180deg,transparent,rgba(0,0,0,.5));}
.btn{min-width:132px;height:56px;padding:0 24px;border-radius:999px;border:1px solid rgba(255,255,255,.28);background:rgba(4,9,18,.7);color:#f7fbff;font-weight:900;letter-spacing:.08em;opacity:0;visibility:hidden;pointer-events:none;transform:translateY(8px) scale(.95);transition:opacity .16s ease,transform .16s ease,visibility .16s;}
.btn.primary{min-width:220px;height:64px;font-size:22px;background:linear-gradient(135deg,rgba(0,240,255,.2),rgba(156,60,255,.22));border-color:rgba(255,255,255,.44);box-shadow:0 0 18px rgba(0,240,255,.36),0 0 40px rgba(156,60,255,.2);}

#app[data-state="idle"] #startBtn{opacity:1;visibility:visible;pointer-events:auto;transform:none;}
#app[data-state="running"] #stopBtn,#app[data-state="running"] #restartBtn,
#app[data-state="paused"] #stopBtn,#app[data-state="paused"] #restartBtn{opacity:1;visibility:visible;pointer-events:auto;transform:none;}

.upgradeOverlay{position:absolute;inset:0;z-index:45;opacity:0;transition:opacity .2s ease;}
.upgradeOverlay[data-on="1"]{opacity:1;}
.upgradeFreeze{position:absolute;inset:0;background:radial-gradient(circle at center,rgba(20,20,28,.15),rgba(4,4,12,.72));backdrop-filter:blur(6px) saturate(.8);-webkit-backdrop-filter:blur(6px) saturate(.8);}
.cutin{position:absolute;inset:0;display:grid;place-items:center;text-align:center;padding:0 24px;}
.cutinFace{width:min(180px,42vw);aspect-ratio:1/1;border-radius:50%;background:radial-gradient(circle at 30% 35%,rgba(255,255,255,.8),rgba(0,240,255,.55) 26%,rgba(156,60,255,.5) 56%,rgba(230,201,107,.36));box-shadow:0 0 18px rgba(0,240,255,.5),0 0 48px rgba(156,60,255,.35);margin:0 auto 18px;}
.cutinTitle{font-size:clamp(28px,7vw,54px);font-weight:1000;letter-spacing:.08em;text-shadow:0 0 24px rgba(0,240,255,.45);}
.cutinLine{margin-top:8px;font-size:clamp(14px,3.4vw,20px);letter-spacing:.08em;opacity:.95;}
.upgradeMsg{margin-top:16px;font-size:12px;letter-spacing:.28em;color:rgba(230,201,107,.95);}

.upgradeOverlay[data-phase="freeze"] .cutin{opacity:0;}
.upgradeOverlay[data-phase="cutin"] .cutin{opacity:1;animation:cutinIn .26s ease-out;}

body.tier2 .bgVideo{opacity:.43;filter:saturate(1.58) contrast(1.18) hue-rotate(-8deg);}
body.tier2 .mythLayer::before{background:radial-gradient(circle at 18% 22%,rgba(0,240,255,.18),transparent 48%),radial-gradient(circle at 80% 70%,rgba(156,60,255,.16),transparent 46%),radial-gradient(circle at 52% 38%,rgba(230,201,107,.2),transparent 58%);}
body.tier2 .targetOuter{box-shadow:0 0 28px rgba(0,240,255,.22),0 0 40px rgba(156,60,255,.15),inset 0 0 18px rgba(230,201,107,.16);}

.godMode,.godFlash,.fxLayer,.centerBanner{display:none !important;}
.srOnly{position:absolute;width:1px;height:1px;overflow:hidden;clip-path:inset(50%);white-space:nowrap;}

@keyframes spin{to{transform:rotate(360deg);}}
@keyframes judgeOut{0%{opacity:0;transform:translateY(6px) scale(.94);}20%{opacity:1;}100%{opacity:0;transform:translateY(-18px) scale(1.06);}}
@keyframes targetPulseGood{0%{filter:drop-shadow(0 0 0 rgba(0,240,255,.2));}100%{filter:drop-shadow(0 0 14px rgba(0,240,255,.55));}}
@keyframes targetPulseGreat{0%{filter:drop-shadow(0 0 0 rgba(230,201,107,.22));}100%{filter:drop-shadow(0 0 26px rgba(230,201,107,.9));}}
@keyframes cutinIn{from{opacity:0;transform:scale(.95);}to{opacity:1;transform:scale(1);}}

@media (max-width:560px){
  :root{--hitY:72%;--controlH:106px;}
  .value{font-size:18px;}
  .btn{min-width:118px;height:52px;}
  .btn.primary{min-width:200px;height:60px;font-size:21px;}
}
