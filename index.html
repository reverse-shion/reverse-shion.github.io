<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>星詠タロット — 3枚展開（表面出現 / Trinity対応）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b1a" />
  <!-- 先読み（例：初期3枚） -->
  <link rel="preload" as="image" href="/assets/images/tarot/majors/00_the_fool.jpg">
  <link rel="preload" as="image" href="/assets/images/tarot/majors/01_the_magician.jpg">
  <link rel="preload" as="image" href="/assets/images/tarot/majors/02_the_high_priestess.jpg">
  <link rel="stylesheet" href="/assets/css/style.css" />
</head>

<body>
  <main class="wrap">
    <header class="page-head">
      <h1>星詠 3枚リーディング</h1>
      <p class="lead">願いをひと言にして、「タロット展開」を押してね。光と音の中から、<strong>表面</strong>で3枚が現れるよ。</p>
    </header>

    <!-- 願い入力 -->
    <section class="wish-form">
      <label for="wish" class="sr-only">あなたの願い</label>
      <input id="wish" type="text" inputmode="text" placeholder="例）あの人との関係を前に進めたい">
      <button id="shuffle-btn" class="btn btn--primary">🔮 タロット展開</button>
    </section>

    <!-- デッキ -->
    <section id="wish-reading">
      <div class="wish-deck" id="deck" aria-live="polite">
        <!-- 表面画像は --face-url で差し替え可能 -->
        <div class="tarot-card" style="--face-url:url('/assets/images/tarot/majors/00_the_fool.jpg')"></div>
        <div class="tarot-card" style="--face-url:url('/assets/images/tarot/majors/01_the_magician.jpg')"></div>
        <div class="tarot-card" style="--face-url:url('/assets/images/tarot/majors/02_the_high_priestess.jpg')"></div>
      </div>

      <!-- 結果：Trinity明示（詩・韻・祈） -->
      <div id="wishResult" class="result-grid">
        <div class="result-item" data-trinity="詩｜Poem（現在）">
          <h3 class="item-title">—</h3>
          <p class="item-text">カードを展開すると自動で入ります。</p>
        </div>
        <div class="result-item" data-trinity="韻｜Rhyme（鍵）">
          <h3 class="item-title">—</h3>
          <p class="item-text">カードを展開すると自動で入ります。</p>
        </div>
        <div class="result-item" data-trinity="祈｜Prayer（進む道）">
          <h3 class="item-title">—</h3>
          <p class="item-text">カードを展開すると自動で入ります。</p>
        </div>
      </div>

      <!-- 閉じの言葉（願いの織り込み） -->
      <p class="closing">タロットクローズ。<strong>大丈夫だよ。</strong></p>

      <!-- CTA（遅延フェード） -->
      <div id="cta" class="cta" hidden>
        <a class="btn cta-glow" href="https://lin.ee/your-line" target="_blank" rel="noopener">✨ 毎週の星詠をLINEで受け取る</a>
        <p class="cta-note">光は巡り、言葉は祈りへ帰る。あなたの願いも、ちゃんと届く。</p>
      </div>
    </section>
  </main>

  <!-- 小さなチャイムSE（非ループ） -->
  <audio id="chime" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-magical-coin-appear-1122.mp3" type="audio/mpeg">
  </audio>

  <script>
  // ===== 星詠：表面で現れる + Trinity + 願い織り込み + チャイムSE =====
  (function(){
    const btn = document.getElementById('shuffle-btn');
    const wishInput = document.getElementById('wish');
    const cards = Array.from(document.querySelectorAll('.tarot-card'));
    const resultTitleEls = Array.from(document.querySelectorAll('.item-title'));
    const resultTextEls  = Array.from(document.querySelectorAll('.item-text'));
    const closing = document.querySelector('.closing');
    const cta = document.getElementById('cta');
    const chime = document.getElementById('chime');

    // デモ用の3枚（フル78枚対応は fullDeck を差し替え）
    const names = ["The Fool","The Magician","The High Priestess"];
    const lines = [
      "今は“はじまり”の呼吸。肩の力を抜いて、まず一歩。",
      "意志を一点に集めて。道具は手の中に揃っている。",
      "静かな直感を信じる。言葉の前に、心のささやき。"
    ];

    function safePlay(audio){
      try{ audio.currentTime = 0; audio.volume = 0.35; audio.play().catch(()=>{}); }
      catch(e){}
    }

    function appearSequence() {
      // 連打対策
      btn.disabled = true;
      btn.textContent = "✨ 星詠展開中…";
      cta.hidden = true; cta.classList.remove('is-show');

      // 初期化（再実行時もキレイに）
      cards.forEach(c => c.classList.remove('show','pulse'));
      resultTitleEls.forEach(el => el.textContent = "—");
      resultTextEls.forEach(el => el.textContent  = "カードを展開すると自動で入ります。");

      // 願いの文
      const wishText = (wishInput.value || "あなたの魂").trim();

      // 0.45秒刻みで順に出現＋チャイム
      cards.forEach((card, i) => {
        setTimeout(() => {
          safePlay(chime);
          card.classList.add('show');
          setTimeout(() => card.classList.add('pulse'), 120);

          // 結果欄に反映
          if (resultTitleEls[i]) resultTitleEls[i].textContent = names[i] || "—";
          if (resultTextEls[i])  resultTextEls[i].textContent  = lines[i] || "";
        }, i * 450);
      });

      // 願いの織り込み（最後の出現後）
      setTimeout(() => {
        closing.innerHTML = `「${wishText}」は、<em>${names[2]}</em> へと響き、やがて光となる。<br>タロットクローズ。<strong>大丈夫だよ。</strong>`;
        btn.disabled = false;
        btn.textContent = "🔮 タロット展開";
        // CTA遅延フェード
        setTimeout(() => { cta.hidden = false; requestAnimationFrame(()=> cta.classList.add('is-show')); }, 600);
      }, (cards.length - 1) * 450 + 500);
    }

    btn.addEventListener('click', appearSequence);

    // ===== 将来拡張：フル78枚
    // const fullDeck = [{name:"The Fool", img:"/path", poem:"..."}, ...];
    // 関数で3枚抽選して --face-url と結果を更新するだけでOK
  })();
  </script>
</body>
</html>
