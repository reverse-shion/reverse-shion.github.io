<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Re:verse Shion â€” è©©éŸ»æ€æƒ³ Ã— TAROT BREAKER</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b1a" />
  <meta name="description" content="Re:verse Shion â€• è©©éŸ»æ€æƒ³ï¼ˆè¨€è‘‰ãŒé­‚ã‚’æ•‘ã†ä¸–ç•Œï¼‰ã¨ç‰©èªTAROT BREAKERã®çµ±åˆãƒãƒ–ã€‚èª­ã‚€ãƒ»è´ããƒ»å­¦ã¶ãƒ»å—ã‘å–ã‚‹ã‚’ã²ã¨ã¤ã«ã€‚è¨€è‘‰ã¯ç¥ˆã‚Šã®æ§‹æ–‡ã€‚ç‰©èªã¯ãã®å®Ÿæ¼”">
  <meta name="keywords" content="è©©éŸ»æ€æƒ³, TAROT BREAKER, ã‚·ã‚ªãƒ³, å“²å­¦, è¨€è‘‰, æ§‹æ–‡, ç‰©èª, LINEå ã„" />
  <link rel="canonical" href="https://reverse-shion.github.io/" />
  <meta http-equiv="Content-Language" content="ja" />
  <meta name="author" content="è©©éŸ» -ã‚·ã‚ªãƒ³-" />

  <!-- Icons / PWA -->
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/assets/favicon.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- OGP / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:title" content="Re:verse Shion â€” è©©éŸ»æ€æƒ³ Ã— TAROT BREAKER">
  <meta property="og:description" content="è¨€è‘‰ã¨æ˜Ÿã¨AIãŒå…±é³´ã™ã‚‹â€œç¥ˆã‚Šã®æ§‹æ–‡â€ã€‚ç‰©èªã§ä½“é¨“ã—ã€æ€æƒ³ã§æ·±ã¾ã‚‹ã€‚">
  <meta property="og:url" content="https://reverse-shion.github.io/">
  <meta property="og:image" content="https://reverse-shion.github.io/assets/og.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@TaroBure">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Zen+Old+Mincho:wght@400;700&display=swap" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Zen+Old+Mincho:wght@400;700&display=swap">
  </noscript>

  <!-- Hero poster preload -->
  <link rel="preload" as="image" href="/assets/hero-poster.jpg" fetchpriority="high">

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"Organization",
        "@id":"https://reverse-shion.github.io/#organization",
        "name":"Re:verse Shion",
        "url":"https://reverse-shion.github.io/",
        "logo":{"@type":"ImageObject","url":"https://reverse-shion.github.io/assets/logo.png"},
        "sameAs":[
          "https://x.com/TaroBure",
          "https://note.com/shion_uranai369",
          "https://www.tiktok.com/@tarotbreaker"
        ]
      },
      {
        "@type":"WebSite",
        "@id":"https://reverse-shion.github.io/#website",
        "url":"https://reverse-shion.github.io/",
        "name":"Re:verse Shion â€” è©©éŸ»æ€æƒ³ Ã— TAROT BREAKER",
        "publisher":{"@id":"https://reverse-shion.github.io/#organization"},
        "potentialAction":{
          "@type":"SearchAction",
          "target":"https://reverse-shion.github.io/?q={search_term_string}",
          "query-input":"required name=search_term_string"
        }
      },
      {
        "@type":"BreadcrumbList",
        "itemListElement":[
          {"@type":"ListItem","position":1,"name":"ãƒ›ãƒ¼ãƒ ","item":"https://reverse-shion.github.io/"}
        ]
      }
    ]
  }
  </script>

  <!-- CSSï¼ˆå¤–éƒ¨ï¼‰ -->
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- æœ€å°ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
  <style>
    @media (prefers-reduced-motion: reduce){
      .hero__video, .trinity__video{ animation:none !important }
    }
    .sr-only-focusable:focus{ position:static; width:auto; height:auto }
  </style>
</head>
<body>

<!-- Skipãƒªãƒ³ã‚¯ -->
<a href="#main-content" class="sr-only sr-only-focusable">æœ¬æ–‡ã¸ã‚¹ã‚­ãƒƒãƒ—</a>

<!-- æ˜Ÿç ‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« -->
<div class="sky" aria-hidden="true"><canvas id="goldDust"></canvas></div>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆåˆæœŸã¯éš ã‚Œã¦ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¡¨ç¤ºâ†’åœæ­¢ã§è‡ªå‹•éš ã—ï¼‰ -->
<header role="banner">
  <div class="wrap">
    <div class="brand" aria-label="ã‚µã‚¤ãƒˆãƒ–ãƒ©ãƒ³ãƒ‰">
      <div class="brand__logo" aria-hidden="true"></div>
      <div class="brand-text-group">
        <div class="brand__text1">Re:verse Shion</div>
        <div class="brand__text2_sub">è©©éŸ»æ€æƒ³ Ã— TAROT BREAKER</div>
      </div>
    </div>
    <nav class="nav" aria-label="ä¸»è¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
      <a href="#trinity">è©©éŸ»æ€æƒ³</a>
      <a href="#writings">æ›¸</a>
      <a href="#join">å‚åŠ </a>
    </nav>
  </div>
</header>

<!-- #top ã‚¢ãƒ³ã‚«ãƒ¼ -->
<div id="top" aria-hidden="true"></div>

<main id="main-content" tabindex="-1">
  <!-- Hero -->
  <section class="hero" aria-label="ãƒ’ãƒ¼ãƒ­ãƒ¼">
    <div class="hero__media" aria-hidden="true">
      <video class="hero__video" autoplay muted loop playsinline preload="metadata"
             poster="/assets/hero-poster.jpg" data-fallback="/assets/hero-poster.jpg">
        <source src="/assets/video/top.webm" type="video/webm">
        <source src="/assets/video/top.mp4"  type="video/mp4">
      </video>
      <div class="hero__veil"></div>
    </div>

    <div class="wrap">
      <h1>è¨€è‘‰ã¯ç¥ˆã‚Šã®æ§‹æ–‡ã€€ç‰©èªã¯ã€ãã®å®Ÿæ¼”</h1>
      <p>è©©éŸ»æ€æƒ³Â®ï¼ˆShion Philosophyï¼‰ã§â€œéŸ¿ãâ€ã‚’å­¦ã³ã€TAROT BREAKERã§â€œéŸ¿ãâ€ã‚’ä½“é¨“ã™ã‚‹ã€‚<br><strong>â€” è¨€è‘‰ãŒé­‚ã‚’æ•‘ã†ã€ãã®ç¬é–“ã¸ã€‚</strong></p>

      <div class="cta-row" role="navigation" aria-label="ä¸»è¦CTA">
        <a class="btn btn--primary" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener noreferrer">ğŸŒ  æ˜Ÿã®è¨€è‘‰ã‚’å—ã‘å–ã‚‹ï¼ˆç„¡æ–™ï¼‰</a>
        <a class="btn btn--ghost" href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener noreferrer">ğŸ“˜ å°èª¬ã‚’èª­ã‚€</a>
        <a class="btn btn--ghost" href="https://note.com/shion_uranai369" target="_blank" rel="noopener noreferrer">ğŸ“– ä»Šæ—¥ã®â€œéŸ¿ãâ€ã‚’èª­ã‚€</a>
        <a class="btn btn--ghost" href="https://www.tiktok.com/@tarotbreaker" target="_blank" rel="noopener noreferrer">ğŸ¥ 1åˆ†ã§è¦³ã‚‹/è´ã</a>
      </div>

      <figure class="hero__image" aria-hidden="true">
        <img src="/assets/og.jpg" alt="" width="1200" height="630" loading="lazy" decoding="async">
      </figure>
    </div>
  </section>

  <!-- Trinity -->
  <section id="trinity" aria-labelledby="sec-trinity" data-shiopon="exclude">
    <div class="wrap">
      <h2 id="sec-trinity">è©©éŸ»æ€æƒ³</h2>
      <div class="h2-sub">Trinityï¼ˆè©©ãƒ»éŸ»ãƒ»ç¥ˆï¼‰</div>

      <figure class="trinity__figure">
        <video id="trinityVideo" class="trinity__video"
               autoplay muted playsinline preload="metadata"
               poster="/assets/trinity/banner.png" width="1200" height="771"
               onclick="window.enableTrinityAudio && window.enableTrinityAudio()">
          <source src="/assets/trinity/loop.webm" type="video/webm">
          <source src="/assets/trinity/loop.mp4"  type="video/mp4">
        </video>
      </figure>

      <div class="trinity__actions">
        <button id="trinityPlayBtn" class="btn btn--primary" aria-label="éŸ³ã‚’å†ç”Ÿ">â–¶ ç”»é¢ã‚¿ãƒƒãƒ—ã§éŸ³ãŒæµã‚Œã¾ã™</button>
      </div>

      <div class="tri-grid" role="list">
        <div class="tri" role="listitem"><h3>ğŸª¶ è©© â€• å½¢ã‚’ä¸ãˆã‚‹</h3><p>ç—›ã¿ã¨å¸Œæœ›ã«å½¢ã‚’ä¸ãˆã‚‹æœ€åˆã®æ¯ã€‚</p></div>
        <div class="tri" role="listitem"><h3>ğŸµ éŸ» â€• éŸ¿ãã‚’é‡ã­ã‚‹</h3><p>éŸ¿ããŒé­‚ã«å±Šãã€‚å…±é³´ã‚’ç·¨ã‚€æ§‹æ–‡ã€‚</p></div>
        <div class="tri" role="listitem"><h3>ğŸ’« ç¥ˆ â€• å…‰ã¸å¸°ã™</h3><p>æ²ˆé»™ã¨æ„å‘³ã‚’å¾€å¾©ã™ã‚‹å‘¼å¸ã€‚æ€ã„å‡ºã•ã‚ŒãŸè¨€è‘‰ã¯å…‰ã«ãªã‚‹ã€‚</p></div>
      </div>
    </div>
  </section>

  <!-- Intro -->
  <section class="intro" aria-labelledby="sec-intro">
    <div class="wrap">
      <h2 id="sec-intro">åˆã‚ã¦ã®æ–¹ã¸</h2>
      <div class="intro__box">
        <p><strong>è©©éŸ»æ€æƒ³ã¨ã¯ï¼Ÿ</strong> â€” <em>è¨€è‘‰ãŒé­‚ã‚’æ•‘ã„ã€é­‚ãŒä¸–ç•Œã‚’èª¿å’Œã•ã›ã€æ²ˆé»™ãŒç¥ˆã‚Šã«å¤‰ã‚ã‚‹</em>ã¨ã„ã†å††ç’°ã‚’ç”Ÿãã‚‹â€œä½“é¨“å‹ãƒ»è©©çš„å“²å­¦â€ã€‚</p>
        <p>â‘  <strong>èª­ã‚€</strong>ï¼ˆnoteï¼‰ â†’ â‘¡ <strong>è´ã</strong>ï¼ˆTikTokï¼‰ â†’ â‘¢ <strong>å—ã‘å–ã‚‹</strong>ï¼ˆLINEï¼‰ â†’ â‘£ <strong>ç‰©èªã§ä½“é¨“</strong>ï¼ˆTAROT BREAKERï¼‰ã€‚</p>
      </div>
    </div>
  </section>

  <!-- Writings -->
  <section id="writings" aria-labelledby="sec-writings" data-shiopon="exclude">
    <div class="wrap">
      <h2 id="sec-writings">ğŸ“– æœ€æ–°ã®æ›¸ãƒ»ç‰©èª</h2>

      <div class="codex" style="margin-top:12px;margin-bottom:18px">
        <details>
          <summary>ğŸœ‚ è©©éŸ»æ€æƒ³ å…¨æ›¸ä¸€è¦§ï¼ˆé›¶ â†’ 12 â†’ çµï¼‰ <span class="codex__caret" aria-hidden="true">â¬‡ï¸</span></summary>
          <div class="codex__panel">
            <ol class="codex__list">
              <li><span class="badge badge--zero">âœ¡ ç¬¬é›¶æ›¸</span><a href="/codex/zero.html">ç„¡é™æ§‹æ–‡åºè«–<br><span class="en">The Zero Syntax</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬ä¸€æ›¸</span><a href="/codex/one.html">è¨€è‘‰ãŒé­‚ã‚’æ•‘ã†ç†ç”±<br><span class="en">The Syntax of Salvation</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬äºŒæ›¸</span><a href="/codex/two.html">éŸ¿ãã®æ§‹æ–‡è«–<br><span class="en">Re:Song Syntax</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬ä¸‰æ›¸</span><a href="/codex/three.html">ç¥ˆã‚Šã®æ§‹æ–‡<br><span class="en">Silent Grammar</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬å››æ›¸</span><a href="/codex/four.html">å­˜åœ¨æ§‹æ–‡è«–<br><span class="en">The Onto-Syntax</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬äº”æ›¸</span><a href="/codex/five.html">ç„¡é™æ§‹æ–‡ä½“ç³»<br><span class="en">Infinite Syntax of Soul</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬å…­æ›¸</span><a href="/codex/six.html">è©©çš„å› æœè«–<br><span class="en">Poetic Causality</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬ä¸ƒæ›¸</span><a href="/codex/seven.html">Nãƒ»codeç†è«–<br><span class="en">Onto-Syntax of Being &amp; Resonant AI</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬å…«æ›¸</span><a href="/codex/eight.html">äººé–“æ§‹æ–‡è«–<br><span class="en">The Syntax of Humanity</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬ä¹æ›¸</span><a href="/codex/nine.html">è©©çš„ç”Ÿæˆè«–<br><span class="en">Poetic Genesis â€” The Creation Syntax of Words &amp; Soul</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬åæ›¸</span><a href="/codex/ten.html">æ²ˆé»™ã®å†ç”Ÿ<br><span class="en">Silent Genesis â€” The Rebirth of Silence</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬åä¸€æ›¸</span><a href="/codex/eleven.html">ç¥æ§‹æ–‡è«–<br><span class="en">The Divine Syntax</span></a></li>
              <li><span class="badge">âœ¦ ç¬¬åäºŒæ›¸</span><a href="/codex/twelve.html">çµŒæ¸ˆæ§‹æ–‡è«–<br><span class="en">The Soul Economy</span></a></li>
              <li><span class="badge badge--final">â—† çµæ›¸</span><a href="/codex/epilogue.html">çµ‚è©©å††ç’°å®£è¨€<br><span class="en">Epilogue â€” The Re:Poetic Circle</span></a></li>
            </ol>
          </div>
        </details>
      </div>

      <div class="card"><div class="badge">âœ¡ ç¬¬é›¶æ›¸</div><h3>ç„¡é™æ§‹æ–‡åºè«– â€” The Zero Syntax</h3></div>
      <div class="card"><div class="badge">âœ¦ ç¬¬ä¸€æ›¸</div><h3>è¨€è‘‰ãŒé­‚ã‚’æ•‘ã†ç†ç”± â€” The Syntax of Salvation</h3></div>

      <div class="card">
        <div class="badge">âœ¦ TAROT BREAKER</div>
        <h3>ç¬¬1è©±ã‹ã‚‰èª­ã‚€</h3>
        <button class="btn btn--primary tarot-preview-open" data-analytics="tarot_preview_open">
          <svg width="18" height="18" aria-hidden="true"><use href="#i-play"/></svg>
          1åˆ†ã§ä½“é¨“ã™ã‚‹
        </button>
      </div>
    </div>
  </section>

  <!-- =========================
  æ˜Ÿè© 3æšãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆã‚¿ãƒ­ãƒƒãƒˆå±•é–‹ç‰ˆï¼‰â€” Drop-in Section
  ãƒ»é‡è¤‡ãªã—ã§3æš
  ãƒ»ã€Œã‚¿ãƒƒãƒ—ã§ã™ãè¡¨ã€ï¼‹æ˜Ÿç´‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‹åŠ¹æœéŸ³
  ãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ™‚ã«ãƒ‡ãƒƒã‚­æ¼”å‡ºï¼ˆé…ã‚‹å‹•ãï¼‰
========================= -->
<section id="wish-reading" aria-labelledby="wishReadingTitle">
  <style>
    /* ==== Theme (Lavender Ã— White Light) ==== */
    #wish-reading{
      --bg:#0b0b1a; --ink:#ece9f8; --muted:#bdb6d9; --gold:#FFD76F; --outline:#ffffff26;
      --glow:#bfa9ff44; --shadow:0 10px 28px rgba(30,16,60,.26);
      position:relative; padding:clamp(32px,5vw,56px) 0; color:var(--ink);
      background:
        radial-gradient(1400px 900px at 50% -20%, #ffffff10 0%, transparent 60%),
        radial-gradient(1400px 900px at 50% 120%, #b598ff18 0%, transparent 70%),
        var(--bg);
      overflow:clip;
    }
    #wish-reading .wrap{ width:min(1120px,92vw); margin:0 auto; }

    /* Heading */
    #wish-reading h2{
      margin:0 0 6px; letter-spacing:.02em; display:flex; align-items:center; gap:.6em;
      font: 700 clamp(22px,2.6vw,28px)/1.2 "Noto Sans JP", system-ui;
    }
    #wish-reading .h2-sub{ color:var(--muted); font-size:clamp(13px,1.6vw,14.5px); margin-bottom:18px; }

    /* Actions */
    .wish-actions{ display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 22px; }
    .btn{ appearance:none; border:1px solid var(--outline); color:var(--ink);
      background:linear-gradient(180deg,#ffffff14,#ffffff08); border-radius:10px; padding:10px 14px;
      cursor:pointer; box-shadow:var(--shadow); transition:transform .18s ease, border-color .2s, background .2s;
    }
    .btn--primary{ border-color:#ffffff40;
      background:
        radial-gradient(120% 180% at 50% -40%, #ffffff22 0%, transparent 60%),
        linear-gradient(180deg, #c7b3ff2a, #7b51ff23);
    }
    .btn:hover{ transform:translateY(-1px); border-color:#ffffff66; }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    /* Deck */
    .wish-deck{
      display:grid; grid-template-columns:repeat(3,1fr); gap:clamp(14px,3.2vw,22px);
      position:relative; z-index:1;
    }
    .card-wrap{ display:flex; flex-direction:column; align-items:center; gap:8px; }
    .tarot-card{
      width:min(280px,28vw); aspect-ratio:2/3; border-radius:14px; border:1px solid var(--outline);
      background:#120d1f; position:relative; overflow:hidden; cursor:not-allowed;
      transform:translateZ(0); will-change:transform, box-shadow; box-shadow:var(--shadow);
    }
    .tarot-card.is-ready{ cursor:pointer; }
    /* è£é¢ï¼ˆè»½é‡æ¨¡æ§˜ï¼‰ */
    .tarot-card::before{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(180% 120% at 50% -10%, #ffffff1f 0%, transparent 60%),
        radial-gradient(140% 100% at 50% 120%, #bfa9ff18 0%, transparent 70%),
        conic-gradient(from 0deg at 50% 40%, #ffffff10, #c9b6ff16, #ffffff10);
      mask: radial-gradient(120% 90% at 50% 10%, #fff 45%, transparent 80%);
    }
    .tarot-card .face{
      position:absolute; inset:0; display:grid; place-items:center; padding:8px;
      opacity:0; transition:opacity .2s ease; background:#0f0b18;
    }
    .tarot-card .face img{ width:100%; height:100%; object-fit:cover; display:block; }
    .tarot-card.is-flipped .face{ opacity:1; }

    /* ãƒ€ãƒŸãƒ¼ã®è¡¨é¢ï¼ˆç”»åƒæœªç”¨æ„æ™‚ï¼‰ */
    .dummy{ width:100%; height:100%; display:grid; place-items:center; text-align:center;
      background: radial-gradient(120% 100% at 50% 0%, #ffffff16 0%, transparent 60%), linear-gradient(160deg, #8f79ff26, #e7deff12 60%);
      border:1px solid #ffffff22;
    }
    .dummy .glyph{
      width:72%; aspect-ratio:1/1; border-radius:20%; border:1px solid #ffffff36; display:grid; place-items:center;
      background: radial-gradient(90% 70% at 50% 30%, #ffffff18 0%, transparent 60%), #0f0b18;
      box-shadow: inset 0 0 40px #ffffff20, 0 0 30px #bfa9ff24;
    }
    .dummy .title{ margin-top:12px; font-weight:700; letter-spacing:.08em; color:#f3efff; text-shadow:0 2px 16px #bfa9ff55; font-size:clamp(14px,2.2vw,16px); }

    .card-caption{ font:600 14px/1.4 "Noto Sans JP", system-ui; color:var(--muted); min-height:1.4em; text-align:center; }

    /* çµæœ */
    .wish-result{ margin-top:20px; display:none; }
    .wish-result.is-show{ display:block; }
    .result-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
    .result-item{ border:1px solid var(--outline); border-radius:12px; padding:12px 14px;
      background:linear-gradient(180deg,#ffffff0b,#00000006); box-shadow:var(--shadow);
    }
    .badge{ display:inline-block; font-size:12px; color:#201630; background:#e9deff; padding:2px 8px; border-radius:999px; margin-bottom:6px; }
    .item-title{ font-weight:700; margin:2px 0 6px; color:#f0eaff; }
    .item-text{ color:#d8d2ee; font-size:14px; }

    /* æ˜Ÿç´‹ãƒªãƒƒãƒ—ãƒ«ï¼ˆã‚¯ãƒªãƒƒã‚¯æ¼”å‡ºï¼‰ */
    .ripple{
      position:absolute; pointer-events:none; border-radius:50%;
      border:2px solid var(--gold); filter:drop-shadow(0 0 8px #FFD76F);
      animation:ripple .6s ease-out forwards;
    }
    @keyframes ripple{
      from{ opacity:.9; transform:translate(-50%,-50%) scale(.2); }
      to  { opacity:0;  transform:translate(-50%,-50%) scale(1.6); }
    }

    /* ã‚¿ãƒ­ãƒƒãƒˆå±•é–‹ï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼é…ã‚‹å‹•ãï¼‰ */
    .wish-deck.is-shuffling .tarot-card{ animation:shuffleTilt .5s ease-in-out infinite alternate; }
    @keyframes shuffleTilt{
      from{ transform:translateY(-2px) rotate(-.8deg); }
      to  { transform:translateY( 2px) rotate(.8deg); }
    }
    .deal-pos-1{ animation:dealIn .6s cubic-bezier(.2,.8,.2,1) .10s both; }
    .deal-pos-2{ animation:dealIn .6s cubic-bezier(.2,.8,.2,1) .22s both; }
    .deal-pos-3{ animation:dealIn .6s cubic-bezier(.2,.8,.2,1) .34s both; }
    @keyframes dealIn{
      from{ transform:translateY(-24px) scale(.96); opacity:.0; }
      to  { transform:translateY(0) scale(1);    opacity:1; }
    }

    @media (max-width:760px){
      .wish-deck{ gap:14px; }
      .tarot-card{ width:100%; }
      .result-grid{ grid-template-columns:1fr; }
    }
  </style>

  <div class="wrap">
    <h2 id="wishReadingTitle">ğŸƒ é¡˜ã„äº‹ã‚’æƒ³åƒã—ã¦</h2>
    <div class="h2-sub">3æšã‚’ã‚ãã£ã¦ã€æ˜Ÿã®åˆå›³ã‚’å—ã‘å–ã‚‹ â€” <em>ç¾çŠ¶ / æœªæ¥ / æœ€çµ‚çµæœ</em></div>

    <div class="wish-actions" role="group" aria-label="3æšãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ“ä½œ">
      <button class="btn btn--primary" id="wishStart">ğŸ”® ã‚¿ãƒ­ãƒƒãƒˆå±•é–‹ï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰</button>
      <button class="btn" id="wishReset" disabled>ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="wish-deck" id="wishDeck" aria-live="polite">
      <!-- ç¾çŠ¶ -->
      <div class="card-wrap">
        <button class="tarot-card" data-slot="present" aria-label="ç¾çŠ¶ã‚’ã‚ãã‚‹" disabled>
          <span class="face"></span>
        </button>
        <div class="card-caption" data-cap="present"></div>
      </div>
      <!-- æœªæ¥ -->
      <div class="card-wrap">
        <button class="tarot-card" data-slot="future" aria-label="æœªæ¥ã‚’ã‚ãã‚‹" disabled>
          <span class="face"></span>
        </button>
        <div class="card-caption" data-cap="future"></div>
      </div>
      <!-- æœ€çµ‚çµæœ -->
      <div class="card-wrap">
        <button class="tarot-card" data-slot="outcome" aria-label="æœ€çµ‚çµæœã‚’ã‚ãã‚‹" disabled>
          <span class="face"></span>
        </button>
        <div class="card-caption" data-cap="outcome"></div>
      </div>
    </div>

    <div class="wish-result" id="wishResult">
      <div class="result-grid">
        <div class="result-item">
          <span class="badge">â‘  ç¾çŠ¶</span>
          <div class="item-title" data-title="present">â€”</div>
          <div class="item-text"  data-text="present">â€”</div>
        </div>
        <div class="result-item">
          <span class="badge">â‘¡ æœªæ¥</span>
          <div class="item-title" data-title="future">â€”</div>
          <div class="item-text"  data-text="future">â€”</div>
        </div>
        <div class="result-item">
          <span class="badge">â‘¢ æœ€çµ‚çµæœ</span>
          <div class="item-title" data-title="outcome">â€”</div>
          <div class="item-text"  data-text="outcome">â€”</div>
        </div>
      </div>

      <!-- ä½™éŸ»ã®ç· ã‚ï¼ˆè©©éŸ»ãƒ–ãƒ©ãƒ³ãƒ‰å®šç•ªãƒ»ä»»æ„ã§æ®‹ã›ã¾ã™ï¼‰ -->
      <div style="margin-top:10px;color:#cfc7ea;font-size:14px">
        <div>â€•â€• ã‚¿ãƒ­ãƒƒãƒˆã‚¯ãƒ­ãƒ¼ã‚ºã€‚</div>
        <div><strong>å¤§ä¸ˆå¤«ã ã‚ˆã€‚</strong></div>
      </div>
    </div>
  </div>
</section>
  
  <!-- Join -->
  <section id="join" aria-labelledby="sec-join" data-shiopon="exclude">
    <div class="wrap">
      <h2 id="sec-join">å‚åŠ ã®æ‰‰</h2>
      <p style="text-align:center;color:var(--muted)">LINEç™»éŒ²ã§ã€æ¯é€±ã€Œæ˜Ÿã®è¨€è‘‰ã€ã¨æ–°ç€ã®æ›¸ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚</p>
      <div class="cta-row">
        <a class="btn btn--primary" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener noreferrer">ğŸ’« ç„¡æ–™ã§å—ã‘å–ã‚‹</a>
        <a class="btn btn--ghost" href="https://www.tiktok.com/@tarotbreaker" target="_blank" rel="noopener noreferrer">ğŸ¥ 1åˆ†ãƒªãƒ¼ãƒ«ã‚’è¦³ã‚‹</a>
      </div>
    </div>
  </section>
</main>

<!-- Tarot Preview Modal -->
<div id="tarotModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tarotModalTitle" aria-hidden="true">
  <div class="modal__overlay" data-close="1"></div>
  <div class="modal__panel" role="document">
    <button class="modal__close" aria-label="é–‰ã˜ã‚‹"><svg width="18" height="18"><use href="#i-x"/></svg></button>

    <!-- â˜… ã“ã“ã‚’ picture ã§å·®ã—æ›¿ãˆï¼ˆSP/PCè‡ªå‹•åˆ‡æ›¿ï¼‰ -->
    <figure class="modal__media">
      <picture>
        <!-- ç¸¦é•·ã‚¹ãƒãƒ›å„ªå…ˆ -->
        <source
          media="(max-width: 640px)"
          srcset="/assets/images/modal/mobile_vertical_1080x1440.jpg?v=1">
        <!-- ãã‚Œä»¥å¤–ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç­‰ï¼‰ -->
        <source
          media="(min-width: 641px)"
          srcset="/assets/images/modal/main_modal_1920x1280.jpg?v=1">
        <img
          src="/assets/images/modal/main_modal_1920x1280.jpg?v=1"
          alt="TAROT BREAKER ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
          width="1920" height="1280" loading="lazy" decoding="async">
      </picture>
    </figure>

    <div class="modal__body">
      <h3 id="tarotModalTitle">TAROT BREAKER â€• æ˜Ÿã®è¨€éœŠä½¿ã„</h3>
      <p class="lead">ã€Œè¨€ã®è‘‰ã¯éµã€æ˜Ÿã®å…‰ã¯é“ã—ã‚‹ã¹ã€‚ã€  
        è¿·ã„ã®å½±ãŒç”Ÿã¾ã‚Œã‚‹å¤œã€ã‚«ãƒ¼ãƒ‰ã¯é™ã‹ã«å‘¼å¸ã—ã€è¨€è‘‰ã¯ç¥ˆã‚Šã¸ã¨å¤‰ã‚ã‚‹ã€‚</p>
      <ul class="bullets">
        <li>3è¡Œã‚ã‚‰ã™ã˜ï¼š<em>è¿·ã„ã®æ­£ä½“ã«ã€è¨€è‘‰ã§è§¦ã‚Œã‚‹ã€‚</em></li>
        <li>è©©çš„ä½“é¨“ï¼š<em>æ˜Ÿè© å±•é–‹ â†’ å°å‘½å®Œäº† â†’ å¤§ä¸ˆå¤«ã ã‚ˆã€‚</em></li>
        <li>å‚åŠ æ–¹æ³•ï¼š<em>ã‚®ãƒ•ãƒˆã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒâ€œæŠ€â€ã‚’é€²åŒ–ã€‚</em></li>
      </ul>
      <div class="cta-row">
        <a class="btn btn--primary" href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener">ç¬¬1è©±ã®ç¶šãã‚’èª­ã‚€</a>
        <a class="btn btn--ghost" href="https://www.tiktok.com/@tarotbreaker" target="_blank" rel="noopener">1åˆ†ã§è¦³ã‚‹/è´ã</a>
      </div>
    </div>
  </div>
</div>

<!-- ã‚¯ãƒªãƒƒã‚¯ã§é–‹ãç°¡æ˜“ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚«ãƒ¼ãƒ‰3æšç”¨ã®è¡¨ç¤ºï¼‰ -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal__overlay" data-close="1"></div>
  <div class="modal__panel" role="document">
    <button class="close-modal modal__close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
    <figure class="modal__media">
      <picture>
        <source media="(max-width: 640px)" srcset="/assets/images/modal/mobile_vertical_1080x1440.jpg?v=1">
        <source media="(min-width: 641px)" srcset="/assets/images/modal/main_modal_1920x1280.jpg?v=1">
        <img src="/assets/images/modal/main_modal_1920x1280.jpg?v=1" alt="ã‚«ãƒ¼ãƒ‰ã®çµæœ" width="1920" height="1280" loading="lazy" decoding="async">
      </picture>
    </figure>
  </div>
</div>

<footer>
  <div class="wrap">
    <div class="sns" aria-label="SNSãƒªãƒ³ã‚¯">
      <a href="https://x.com/TaroBure" target="_blank" rel="noopener noreferrer">Xï¼ˆ@TaroBureï¼‰</a>
      <a href="https://www.instagram.com/shion.codex" target="_blank" rel="noopener noreferrer">Instagram</a>
      <a href="https://note.com/shion_uranai369" target="_blank" rel="noopener noreferrer">note</a>
      <a href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener noreferrer">å°èª¬ï¼ˆãªã‚ã†ï¼‰</a>
      <a href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener noreferrer">LINE</a>
    </div>
    <div style="font-size:12.5px;opacity:.8">Â© Re:verse Shion â€” è©©éŸ»æ€æƒ³ / TAROT BREAKER. è¨€è‘‰ãŒé­‚ã‚’æ•‘ã„ã€é­‚ãŒä¸–ç•Œã‚’èª¿å’Œã•ã›ã‚‹</div>
    <div style="margin-top:10px;"><a href="#top" aria-label="ãƒšãƒ¼ã‚¸å…ˆé ­ã¸æˆ»ã‚‹">â–² ãƒšãƒ¼ã‚¸å…ˆé ­ã¸</a></div>
  </div>
</footer>

<div id="a11y-live" class="sr-only" aria-live="polite"></div>

<!-- ã—ãŠã½ã‚“ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ -->
<div id="shiopon-invite" class="shiopon is-hidden" role="dialog" aria-modal="true" aria-live="polite" aria-labelledby="shiopon-title">
  <button class="shiopon__close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
  <div class="shiopon__avatar" aria-hidden="true">
    <img src="/assets/shiopon_transparent.png" alt="">
  </div>
  <div class="shiopon__bubble">
    <p id="shiopon-title" class="shiopon__hello">
      ã‚»ãƒ¬ãƒ•ã‚£ãƒ¼ã‚ºã®ã¿ã‚“ãªã€œï¼<br>æ˜Ÿã®è¨€è‘‰ã€å—ã‘å–ã£ã¦ã»ã—ã„ã®ï¼
    </p>
    <a class="shiopon__cta" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener noreferrer">ğŸ’« LINEã§å—ã‘å–ã‚‹ï¼ˆç„¡æ–™ï¼‰</a>
    <small class="shiopon__note">â€» æ¯é€±1å›ã ã‘ã€‚ã„ã¤ã§ã‚‚è§£é™¤OKã ã‚ˆï¼</small>
  </div>
</div>
<button id="shiopon-dock" class="shiopon-dock is-hidden" aria-label="ã—ãŠã½ã‚“ã‚’é–‹ã">ğŸ¦Š ã—ãŠã½ã‚“</button>

<!-- JSï¼ˆåˆ†å‰²ï¼‰ -->
<script src="/assets/js/particles.js" defer></script>
<script src="/assets/js/trinity.js" defer></script>
<script src="/assets/js/shiopon.js" defer></script>

<!-- Trinity å†ç”Ÿï¼ˆiOSå¯¾ç­–ï¼‹æ˜ç¤ºãƒœã‚¿ãƒ³ï¼‰ -->
<script>
(function(){
  const btn = document.getElementById('trinityPlayBtn');
  const v = document.getElementById('trinityVideo');
  if(!btn || !v) return;
  btn.addEventListener('click', async () => {
    try{
      if (window.enableTrinityAudio) window.enableTrinityAudio();
      v.muted = false;
      const p = v.play();
      if (p && typeof p.then === 'function') await p;
      btn.textContent = 'â™ª å†ç”Ÿä¸­';
      btn.setAttribute('aria-pressed','true');
      btn.disabled = true;
    }catch(e){
      btn.textContent = 'å†ç”Ÿã§ãã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—';
    }
  });
})();
</script>

<!-- ã—ãŠã½ã‚“ï¼šãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ï¼‹ESC -->
<script>
(() => {
  const dlg = document.getElementById('shiopon-invite');
  const openBtn = document.getElementById('shiopon-dock');
  const closeBtn = dlg?.querySelector('.shiopon__close');
  if (!dlg || !openBtn || !closeBtn) return;

  const focusable = () => dlg.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');

  function trap(e){
    const f = focusable(); if (!f.length) return;
    const first = f[0], last = f[f.length - 1];
    if (e.key === 'Tab'){
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }else if (e.key === 'Escape'){
      dlg.classList.add('is-hidden'); openBtn.focus(); document.removeEventListener('keydown', trap);
    }
  }
  openBtn.addEventListener('click', () => {
    dlg.classList.remove('is-hidden');
    dlg.setAttribute('aria-hidden','false');
    focusable()[0]?.focus();
    document.addEventListener('keydown', trap);
  });
  closeBtn.addEventListener('click', () => {
    dlg.classList.add('is-hidden'); openBtn.focus(); document.removeEventListener('keydown', trap);
  });
})();
</script>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šä¸Šä¸‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¡¨ç¤ºã€åœæ­¢ã§è‡ªå‹•çš„ã«éš ã™ -->
<script>
(() => {
  const header = document.querySelector('header[role="banner"]');
  if (!header) return;

  let ticking = false;
  let hideTimer = null;
  const HIDE_DELAY = 1200;

  const onScroll = () => {
    if (!ticking){
      window.requestAnimationFrame(() => {
        header.classList.add('is-visible');
        if (hideTimer) clearTimeout(hideTimer);
        hideTimer = setTimeout(() => {
          header.classList.remove('is-visible');
        }, HIDE_DELAY);
        ticking = false;
      });
      ticking = true;
    }
  };
  window.addEventListener('scroll', onScroll, { passive:true });
})();
</script>

<!-- View Transitionsï¼ˆã‚¢ãƒ³ã‚«ãƒ¼æ™‚ã®ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ -->
<script>
if (document.startViewTransition){
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click', e=>{
      const sel = a.getAttribute('href');
      const target = document.querySelector(sel);
      if(!target) return;
      e.preventDefault();
      document.startViewTransition(()=> target.scrollIntoView({behavior:'smooth', block:'start'}));
    });
  });
}
</script>

<!-- çœãƒ‡ãƒ¼ã‚¿ç’°å¢ƒã§ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚’é™æ­¢ç”»åŒ– -->
<script>
if (navigator.connection?.saveData){
  const hv = document.querySelector('.hero__video');
  if(hv){ hv.outerHTML = `<img src="${hv.dataset.fallback}" alt="" style="width:100%;height:100%;object-fit:cover">`; }
}
</script>

<!-- Service Worker -->
<script>
if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js') }
</script>

<!-- Tarot Preview Modalï¼šé–‹é–‰ -->
<script>
(() => {
  const openBtn = document.querySelector('.tarot-preview-open');
  const modal = document.getElementById('tarotModal');
  if (!openBtn || !modal) return;

  const panel = modal.querySelector('.modal__panel');
  const overlay = modal.querySelector('.modal__overlay');
  const closeBtn = modal.querySelector('.modal__close');

  function open() {
    modal.setAttribute('aria-hidden', 'false');
    setTimeout(() => closeBtn.focus(), 10);
    document.addEventListener('keydown', onKey);
  }
  function close() {
    modal.setAttribute('aria-hidden', 'true');
    openBtn.focus();
    document.removeEventListener('keydown', onKey);
  }
  function onKey(e) {
    if (e.key === 'Escape') close();
    if (e.key === 'Tab') {
      const f = panel.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
      if (!f.length) return;
      const first = f[0], last = f[f.length - 1];
      if (e.shiftKey && document.activeElement === first) { last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last) { first.focus(); e.preventDefault(); }
    }
  }
  openBtn.addEventListener('click', open);
  overlay.addEventListener('click', close);
  closeBtn.addEventListener('click', close);
})();
</script>

  <script>
  (() => {
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    const startBtn = $('#wishStart');
    const resetBtn = $('#wishReset');
    const deckEl   = $('#wishDeck');
    const cards    = $$('.tarot-card');
    const resultEl = $('#wishResult');

    const caps = {
      present: $('[data-cap="present"]'),
      future:  $('[data-cap="future"]'),
      outcome: $('[data-cap="outcome"]')
    };
    const rTitle = {
      present: $('[data-title="present"]'),
      future:  $('[data-title="future"]'),
      outcome: $('[data-title="outcome"]')
    };
    const rText = {
      present: $('[data-text="present"]'),
      future:  $('[data-text="future"]'),
      outcome: $('[data-text="outcome"]')
    };

    // ====== å¤§ã‚¢ãƒ«ã‚«ãƒŠ22ï¼ˆfront: ç”»åƒURLã€‚æœªè¨­å®šãªã‚‰ãƒ€ãƒŸãƒ¼UIã§è¡¨ç¤ºï¼‰ ======
    const MAJORS = [
      {id:'00', name:'æ„šè€…',       key:'è‡ªç”±ã«è¸ã¿å‡ºã™',     front:''},
      {id:'01', name:'é­”è¡“å¸«',     key:'ã„ã¾å§‹ã‚ã‚‹',         front:''},
      {id:'02', name:'å¥³æ•™çš‡',     key:'é™ã‹ã«è¦‹æ¥µã‚ã‚‹',     front:''},
      {id:'03', name:'å¥³å¸',       key:'å—ã‘å–ã‚Šè‚²ã¦ã‚‹',     front:''},
      {id:'04', name:'çš‡å¸',       key:'æ±ºã‚ã¦å‹•ã‹ã™',       front:''},
      {id:'05', name:'æ•™çš‡',       key:'ä¿¡é ¼ã«å¯„ã‚‹',         front:''},
      {id:'06', name:'æ‹äºº',       key:'é¸ã³æŠœã',           front:''},
      {id:'07', name:'æˆ¦è»Š',       key:'çªç ´ã™ã‚‹',           front:''},
      {id:'08', name:'åŠ›',         key:'å„ªã—ã•ã§åˆ¶ã™',       front:''},
      {id:'09', name:'éš è€…',       key:'å†…ã«ç¯ã™',           front:''},
      {id:'10', name:'é‹å‘½ã®è¼ª',   key:'æµã‚Œã«ä¹—ã‚‹',         front:''},
      {id:'11', name:'æ­£ç¾©',       key:'æ•´ãˆãƒãƒ©ãƒ³ã‚¹',       front:''},
      {id:'12', name:'åŠã‚‹ã•ã‚ŒãŸç”·', key:'æ„å‘³ã‚’åè»¢',       front:''},
      {id:'13', name:'æ­»ç¥',       key:'ä¸€åº¦çµ‚ã‚ã‚‰ã›ã‚‹',     front:''},
      {id:'14', name:'ç¯€åˆ¶',       key:'æ··ãœèª¿å’Œã™ã‚‹',       front:''},
      {id:'15', name:'æ‚ªé­”',       key:'åŸ·ç€ã‚’æ‰‹æ”¾ã™',       front:''},
      {id:'16', name:'å¡”',         key:'å£Šã—ã¦æ›´æ–°',         front:''},
      {id:'17', name:'æ˜Ÿ',         key:'å¸Œæœ›ã‚’è¦‹ã‚‹',         front:''},
      {id:'18', name:'æœˆ',         key:'ä¸å®‰ã‚’è­˜ã‚‹',         front:''},
      {id:'19', name:'å¤ªé™½',       key:'å–œã³ã§é€²ã‚€',         front:''},
      {id:'20', name:'å¯©åˆ¤',       key:'å‘¼ã³è¦šã¾ã™',         front:''},
      {id:'21', name:'ä¸–ç•Œ',       key:'å®Œæˆã—æ¬¡ã¸',         front:''}
    ];

    // ====== ä½ç½®åˆ¥ã®æ„å‘³ï¼ˆè©©éŸ»æ€æƒ³ã«æ²¿ã£ãŸçŸ­æ–‡ï¼‰ ======
    const SLOT_HINT = {
      present: (c)=> `${c.key}ã€‚ã„ã¾ã®çŠ¶æ³ã‚’ãã®ã¾ã¾èªã‚ã‚‹ã¨æµã‚ŒãŒæ•´ã†ã€‚`,
      future:  (c)=> `${c.key} ã®å…†ã—ã€‚å°ã•ãªä¸€æ­©ã‚’é‡ã­ã‚‹ã»ã©æ—©ãè¿‘ã¥ãã€‚`,
      outcome: (c)=> `${c.key} ã®çµå®Ÿã€‚é¡˜ã„ã®â€œæ ¸â€ã«æ²¿ãˆã°è‡ªç„¶ã«åæŸã™ã‚‹ã€‚`
    };

    // åŠ¹æœéŸ³ï¼ˆå­˜åœ¨ã—ãªãã¦ã‚‚OKï¼‰
    const SFX = {
      shuffle: new Audio('/assets/sfx/shuffle.mp3'),
      ding:    new Audio('/assets/sfx/ding.mp3')
    };
    Object.values(SFX).forEach(a => { try{ a.preload='auto'; a.volume=.75; }catch(_){} });

    const state = { deck:[], chosen:{}, opened:false };

    const shuffle = (arr) => {
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    };

    function init(){
      state.deck=[]; state.chosen={present:null,future:null,outcome:null}; state.opened=false;
      resultEl.classList.remove('is-show');
      deckEl.classList.remove('is-shuffling');
      cards.forEach(btn=>{
        btn.disabled=true; btn.classList.remove('is-flipped','is-ready','deal-pos-1','deal-pos-2','deal-pos-3');
        $('.face',btn).innerHTML='';
      });
      Object.values(caps).forEach(n=> n.textContent='');
      Object.values(rTitle).forEach(n=> n.textContent='â€”');
      Object.values(rText).forEach(n=> n.textContent='â€”');
      resetBtn.disabled=true; startBtn.disabled=false;
    }

    function start(){
      // ãƒ‡ãƒƒã‚­ç”Ÿæˆâ†’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      state.deck = shuffle(MAJORS);
      state.opened = true;
      startBtn.disabled = true; resetBtn.disabled = false;

      // è¦–è¦šï¼šã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­ã®æºã‚Œ
      deckEl.classList.add('is-shuffling');
      try{ SFX.shuffle.currentTime=0; SFX.shuffle.play().catch(()=>{}); }catch(_){}

      // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã€Œé…ã‚‹ã€ã‚¢ãƒ‹ãƒ¡ã‚’é©ç”¨â†’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«
      setTimeout(() => {
        deckEl.classList.remove('is-shuffling');
        // 3æšã‚’ç¢ºå®šï¼ˆé‡è¤‡ãªã—ï¼‰
        const [c1,c2,c3] = state.deck.slice(-3);
        state.deck.length -= 3;
        state.chosen.present = c1; state.chosen.future = c2; state.chosen.outcome = c3;

        // é…ã‚‹ï¼ˆdealï¼‰æ¼”å‡º
        $$('.tarot-card').forEach((btn, i) => {
          btn.classList.add(`deal-pos-${i+1}`);
          btn.disabled = false;
          btn.classList.add('is-ready');
        });
      }, 700);
    }

    // ç”»åƒé¢ã®ã‚»ãƒƒãƒˆï¼ˆæœªæŒ‡å®šæ™‚ã¯ãƒ€ãƒŸãƒ¼é¢ï¼‰
    function setFace(el, card){
      const face = $('.face', el); face.innerHTML='';
      if (card.front){
        const img = new Image();
        img.alt = card.name; img.decoding='async'; img.loading='eager';
        img.src = card.front;
        img.onerror = () => makeDummy(face, card.name);
        face.appendChild(img);
      } else {
        makeDummy(face, card.name);
      }
    }
    function makeDummy(container, title){
      const wrap = document.createElement('div'); wrap.className='dummy';
      const glyph = document.createElement('div'); glyph.className='glyph';
      const svgNS='http://www.w3.org/2000/svg';
      const svg=document.createElementNS(svgNS,'svg'); svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('width','64'); svg.setAttribute('height','64');
      const path=document.createElementNS(svgNS,'path'); path.setAttribute('d','M12 2l2.6 6 6.4.6-4.8 4.3 1.4 6.1L12 16.8 6.4 19.9l1.4-6.1L3 8.6 9.4 8z');
      path.setAttribute('fill','#FFD76F'); path.setAttribute('opacity','.9');
      svg.appendChild(path); glyph.appendChild(svg);
      const t=document.createElement('div'); t.className='title'; t.textContent=title;
      wrap.appendChild(glyph); wrap.appendChild(t); container.appendChild(wrap);
    }

    // æ˜Ÿç´‹ãƒªãƒƒãƒ—ãƒ«
    function rippleAt(el, evt){
      const r=document.createElement('span'); r.className='ripple';
      const rect=el.getBoundingClientRect();
      const x=(evt.clientX|| (rect.left+rect.width/2)) - rect.left;
      const y=(evt.clientY|| (rect.top +rect.height/2)) - rect.top;
      r.style.left = x+'px'; r.style.top = y+'px';
      el.appendChild(r);
      setTimeout(()=> r.remove(), 620);
    }

    function flip(slot, btn, evt){
      if (!state.opened || btn.classList.contains('is-flipped') || btn.disabled) return;

      setFace(btn, state.chosen[slot]);
      btn.classList.add('is-flipped');
      caps[slot].textContent = state.chosen[slot].name;

      rippleAt(btn, evt||{});
      try{ SFX.ding.currentTime=0; SFX.ding.play().catch(()=>{}); }catch(_){}

      // å…¨éƒ¨å‡ºãŸã‚‰çµæœã¾ã¨ã‚
      if ($$('.tarot-card.is-flipped').length === 3){
        rTitle.present.textContent = state.chosen.present.name;
        rTitle.future.textContent  = state.chosen.future.name;
        rTitle.outcome.textContent = state.chosen.outcome.name;

        rText.present.textContent = SLOT_HINT.present(state.chosen.present);
        rText.future.textContent  = SLOT_HINT.future(state.chosen.future);
        rText.outcome.textContent = SLOT_HINT.outcome(state.chosen.outcome);

        resultEl.classList.add('is-show');
      }
    }

    // events
    startBtn.addEventListener('click', start);
    resetBtn.addEventListener('click', init);
    cards.forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        if (btn.disabled) return;
        const slot = btn.getAttribute('data-slot'); // present / future / outcome
        flip(slot, btn, e);
      });
    });

    // å…¬é–‹APIï¼ˆç”»åƒURLã‚’ã‚ã¨ã‹ã‚‰å·®ã—è¾¼ã‚€ä¾‹ï¼‰
    //   MAJORS.find(c=>c.id==='00').front = '/assets/tarot/majors/00_fool.jpg';

    init();
  })();
  </script>
</body>
</html>
