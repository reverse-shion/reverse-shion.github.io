<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>DiCo Rhythm</title>
  <link rel="stylesheet" href="di.css" />
</head>

<body>
  <main class="app" id="app"
    data-myth="egypt"
    data-protocol="record-balance-solar"
    aria-label="DiCo Rhythm">

    <!-- 背景動画 -->
    <video id="bgVideo" class="bgVideo" src="di_dance.mp4" playsinline muted loop></video>

    <!-- 画面演出レイヤ（最背面の上に載る） -->
    <div class="fxLayer" id="fxLayer" aria-hidden="true"></div>

    <!-- ===== 神話レイヤ：ヒエログリフ/太陽円盤/秤など（演出用DOMを先に用意） ===== -->
    <section class="mythLayer" id="mythLayer" aria-hidden="true">
      <!-- ヒエログリフ風ホロ・リング（タップ成功時に展開） -->
      <div class="hieroRing" id="hieroRing"></div>

      <!-- マアトの秤（2回目成功で出す想定） -->
      <div class="maatScale" id="maatScale">
        <div class="scaleBeam"></div>
        <div class="scalePlate left"></div>
        <div class="scalePlate right"></div>
      </div>

      <!-- 太陽円盤（3回目成功＝神演出） -->
      <div class="solarDisc" id="solarDisc">
        <div class="solarCore"></div>
        <div class="solarRays"></div>
      </div>

      <!-- 粒子（砂/星/コード） -->
      <div class="particleField" id="particleField"></div>
    </section>

    <!-- ===== HUD ===== -->
    <header class="hud" aria-label="HUD">
      <div class="hudLeft">
        <div class="label">SCORE</div>
        <div class="value" id="score">0</div>
      </div>

      <div class="hudMid">
        <div class="combo" id="comboWrap">
          <span class="label">COMBO</span>
          <span class="value" id="combo">0</span>
        </div>

        <div class="fever" aria-label="Fever">
          <div class="feverTop">
            <span class="label">FEVER</span>
            <span class="value" id="feverText">0%</span>
          </div>
          <div class="feverBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="feverFill" id="feverFill"></div>
          </div>
        </div>
      </div>

      <div class="hudRight">
        <div class="label">TIME</div>
        <div class="value" id="time">--</div>
      </div>
    </header>

    <!-- ===== ゲーム面 ===== -->
    <section class="stage" aria-label="Game Stage">
      <!-- ノーツ描画 -->
      <canvas id="noteCanvas" class="noteCanvas"></canvas>

      <!-- ターゲット（地味対策：形状切替/色進化の“器”をHTMLで用意）
           JS側で data-form / data-tier / data-color を付け替える想定 -->
      <div class="targetRoot" id="targetRoot" aria-hidden="true"
           data-form="eye" data-tier="0" data-color="cyan">
        <!-- 外周（ホルスの目/アンク/ピラミッド/太陽円盤に変形させる前提） -->
        <div class="targetOuter"></div>
        <!-- 内核（成功で脈打つ） -->
        <div class="targetCore"></div>
        <!-- ヒット判定可視リング -->
        <div class="targetHitRing"></div>
        <!-- 小さなヒエログリフ走査ライン -->
        <div class="scanLine"></div>
      </div>

      <!-- タップ評価テキスト（光＋文字が出る） -->
      <div class="judgeText" id="judgeText" aria-hidden="true">
        <span class="judgeMain" id="judgeMain">SYNC</span>
        <span class="judgeSub" id="judgeSub">ARCANA</span>
      </div>

      <!-- 3段階プロトコル表示（RECORD / BALANCE / SOLAR） -->
      <div class="protocolStack" id="protocolStack" aria-hidden="true">
        <div class="protocolItem" id="p1" data-state="idle">
          <span class="pTag">THOTH</span>
          <span class="pText">ARCANA RECORD</span>
        </div>
        <div class="protocolItem" id="p2" data-state="idle">
          <span class="pTag">MAAT</span>
          <span class="pText">BALANCE</span>
        </div>
        <div class="protocolItem" id="p3" data-state="idle">
          <span class="pTag">RA</span>
          <span class="pText">SOLAR</span>
        </div>
      </div>

      <!-- コンパス / トリガー / ルート：3枚カードの“実体”
           ここは「タロット展開」後に出し、成功タップで一枚ずつ“吸収/消滅”させる -->
      <div class="arcanaTriad" id="arcanaTriad" aria-hidden="true" data-visible="0">
        <div class="cardSlot" id="slotCompass" data-slot="compass" data-active="0">
          <div class="cardGlow compass"></div>
          <div class="cardFace">
            <div class="cardHead">
              <span class="cardRole">COMPASS</span>
              <span class="cardSigil">✦</span>
            </div>
            <div class="cardBody">
              <div class="cardName" id="compassName">星の方向</div>
              <div class="cardMeta" id="compassMeta">NILE FLOW / ORIENT</div>
            </div>
          </div>
          <!-- 吸収先（石版/神殿板） -->
          <div class="absorbSeal" aria-hidden="true"></div>
        </div>

        <div class="cardSlot" id="slotTrigger" data-slot="trigger" data-active="0">
          <div class="cardGlow trigger"></div>
          <div class="cardFace">
            <div class="cardHead">
              <span class="cardRole">TRIGGER</span>
              <span class="cardSigil">⚡</span>
            </div>
            <div class="cardBody">
              <div class="cardName" id="triggerName">門の起動</div>
              <div class="cardMeta" id="triggerMeta">ANUBIS GATE / IGNITE</div>
            </div>
          </div>
          <div class="absorbSeal" aria-hidden="true"></div>
        </div>

        <div class="cardSlot" id="slotRoute" data-slot="route" data-active="0">
          <div class="cardGlow route"></div>
          <div class="cardFace">
            <div class="cardHead">
              <span class="cardRole">ROUTE</span>
              <span class="cardSigil">➤</span>
            </div>
            <div class="cardBody">
              <div class="cardName" id="routeName">航路の線</div>
              <div class="cardMeta" id="routeMeta">SOLAR BARGE / PATH</div>
            </div>
          </div>
          <div class="absorbSeal" aria-hidden="true"></div>
        </div>
      </div>

      <!-- 神演出：DiCo Solar Scribe Mode（3回成功で出す） -->
      <div class="godMode" id="godMode" aria-hidden="true" data-on="0">
        <div class="godFrame">
          <div class="godTitle">SOLAR SCRIBE MODE</div>
          <div class="godName">D•code</div>
          <div class="godLine" id="godLine">計測完了。だが選ぶのは、あなた。</div>
        </div>
      </div>
    </section>

    <!-- ===== 下部操作 ===== -->
    <footer class="bottom" aria-label="Controls">
      <button id="startBtn" class="btn primary">START</button>
      <button id="calibBtn" class="btn">CALIB</button>
      <button id="muteBtn" class="btn">MUTE</button>
    </footer>

    <!-- 音源 -->
    <audio id="music" src="music.mp3" preload="auto"></audio>

    <!-- 中央バナー：タロット展開を“派手”にする器（文言を増強）
         JSで段階表示：TAROT EXPANSION → COMPASS/TRIGGER/ROUTE → GOD MODE -->
    <div class="centerBanner" id="centerBanner" aria-hidden="true" data-step="0">
      <div class="bannerInner">
        <div class="bannerSmall" id="bannerTop">DiCo</div>

        <!-- 派手版：2行構成を想定 -->
        <div class="bannerBig" id="bannerBig">⚡ TAROT EXPANSION ⚡</div>
        <div class="bannerSub" id="bannerSub">ARCANA ALIGNMENT START</div>

        <!-- 状態説明（3枚 or プロトコル） -->
        <div class="bannerSmall" id="bannerSmall">COMPASS / TRIGGER / ROUTE</div>

        <!-- 神話プロトコルの短文（必要なら切替） -->
        <div class="bannerTiny" id="bannerTiny">THOTH → MAAT → RA</div>
      </div>
    </div>

    <!-- アクセシビリティ：状況読み上げ用（表示はしない） -->
    <div class="srOnly" aria-live="polite" aria-atomic="true" id="ariaLive"></div>

  </main>

  <script src="di.js"></script>
</body>
</html>
