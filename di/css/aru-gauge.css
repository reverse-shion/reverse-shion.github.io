/* /di/css/aru-gauge.css
   ARU GAUGE (ANCHOR TO #targetRoot) v2.2 — PRO SAFE
   - Anchor = #targetRoot center (the pulsing circle)
   - Show only on result:
       .app.tb-result-active #targetRoot .aruLayer
       OR .app[data-state="result"] #targetRoot .aruLayer
   - value: --aru-value (0..1)
   - state: .app[data-aru-state="low|mid|high|max"]
   - Scope is strictly limited under #targetRoot to prevent side effects.
*/

/* =========================
   Tokens (app-scoped)
========================= */
.app{
  --aru-value: 0; /* 0..1 (JS updates) */

  /* Gauge size scales with viewport but stays sane */
  --aru-size: clamp(220px, 62vmin, 320px);
  --aru-thickness: 12px;

  --aru-gray: rgba(255,255,255,0.22);

  --aru-color-low:  rgba(76,201,240,0.96);
  --aru-color-mid:  rgba(168,85,247,0.96);
  --aru-color-high: rgba(255,47,208,0.96);

  --aru-glow: 0;
  --aru-active-color: var(--aru-color-low);
}

/* Slightly smaller on very small phones */
@media (max-width: 390px){
  .app{ --aru-size: clamp(200px, 64vmin, 280px); }
}

/* =========================
   Anchor: #targetRoot
   - Must be a positioning context.
========================= */
#targetRoot{
  position: relative;
  isolation: isolate; /* keep stacking local */
}

/* =========================
   Result-only visibility (scoped)
   - default hidden ALWAYS
========================= */
#targetRoot .aruLayer{ display: none; }

/* show on result state only */
.app.tb-result-active #targetRoot .aruLayer,
.app[data-state="result"] #targetRoot .aruLayer{
  display: grid;
}

/* =========================
   ARU overlay layer (scoped)
   → centered INSIDE #targetRoot
========================= */
#targetRoot .aruLayer{
  position: absolute;
  inset: 0;
  z-index: 50;         /* above target visuals */
  pointer-events: none;
  place-items: center;
}

/* The gauge itself */
#targetRoot .aruGauge{
  width: var(--aru-size);
  height: var(--aru-size);
  position: relative;
  border-radius: 999px;

  transform: translate3d(0,0,0);
  filter: drop-shadow(0 18px 36px rgba(0,0,0,0.38));
}

/* Ring paint */
#targetRoot .aruGauge::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;

  /* start at 12 o'clock */
  background:
    conic-gradient(
      from -90deg,
      var(--aru-active-color) 0turn calc(var(--aru-value) * 1turn),
      var(--aru-gray)        0turn 1turn
    );

  /* iOS-safe mask (white = visible) */
  -webkit-mask: radial-gradient(
    circle at center,
    rgba(255,255,255,0) calc(50% - var(--aru-thickness)),
    rgba(255,255,255,1) calc(50% - var(--aru-thickness) + 1px)
  );
  mask: radial-gradient(
    circle at center,
    rgba(255,255,255,0) calc(50% - var(--aru-thickness)),
    rgba(255,255,255,1) calc(50% - var(--aru-thickness) + 1px)
  );

  transition: filter 240ms ease;
  will-change: filter;

  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.10))
    drop-shadow(0 0 calc(var(--aru-glow) * 26px)
      color-mix(in srgb, var(--aru-active-color) 85%, transparent)
    );
}

/* Inner rim */
#targetRoot .aruGauge::after{
  content:"";
  position:absolute;
  inset: calc(var(--aru-thickness) + 2px);
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: inset 0 0 28px rgba(255,255,255,0.05);
  opacity: 0.9;
}

/* Center text */
#targetRoot .aruScore{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;

  font-size: clamp(24px, 4.6vw, 38px);
  font-weight: 900;
  letter-spacing: 0.5px;
  color: rgba(255,255,255,0.92);

  text-shadow:
    0 2px 18px rgba(0,0,0,0.55),
    0 0 20px rgba(255,255,255,0.08);

  -webkit-font-smoothing: antialiased;
  transform: translate3d(0,0,0);
}

/* =========================
   State colors (app-scoped)
========================= */
.app[data-aru-state="low"]  { --aru-active-color: var(--aru-color-low);  --aru-glow: 0; }
.app[data-aru-state="mid"]  { --aru-active-color: var(--aru-color-mid);  --aru-glow: 0.25; }
.app[data-aru-state="high"] { --aru-active-color: var(--aru-color-high); --aru-glow: 0.45; }
.app[data-aru-state="max"]  { --aru-active-color: rgba(255,255,255,0.96); --aru-glow: 1; }

@media (prefers-reduced-motion: reduce){
  #targetRoot .aruGauge::before{ transition:none; }
}
