/* /di/css/aru-fx.css
   ARU FX (RESULT ONLY, iOS safe)
   - shows ONLY when result overlay is active (.app.tb-result-active)
   - intensity driven by --aru-value (0..1) on .app
   - state driven by .app[data-aru-state="low|mid|high|max"]
*/

.aruFX{
  display:none; /* default hidden */
}

.app.tb-result-active .aruFX{
  display:block;
}

.aruFX{
  position: fixed;
  inset: 0;

  /* result.jsが #result を Z_MAX で最前面にするので、
     FXは「その中」か「同階層でZを合わせる」必要がある。
     まずは同階層運用：Zを上げる */
  z-index: 2147483646; /* #result(2147483647)の直下 */

  pointer-events: none;
  overflow: hidden;
  isolation: isolate;
  opacity: 1;
}

/* Stars */
.aruFX::before{
  content:"";
  position:absolute;
  inset:-20%;
  background:
    radial-gradient(circle at 12% 22%, rgba(255,255,255,0.85) 1px, transparent 2px),
    radial-gradient(circle at 68% 18%, rgba(255,255,255,0.55) 1px, transparent 2px),
    radial-gradient(circle at 82% 64%, rgba(255,255,255,0.70) 1px, transparent 2px),
    radial-gradient(circle at 26% 78%, rgba(255,255,255,0.60) 1px, transparent 2px),
    radial-gradient(circle at 44% 46%, rgba(255,255,255,0.45) 1px, transparent 2px);
  background-size: 220px 220px;
  background-repeat: repeat;

  opacity: clamp(0, calc(var(--aru-value) * 0.55), 0.55);
  animation: aruStarDrift 18s linear infinite;
  transform: translateZ(0);
}

/* Aura (high/max only) */
.app[data-aru-state="high"] .aruFX::after,
.app[data-aru-state="max"]  .aruFX::after{
  content:"";
  position:absolute;
  inset:-10%;
  background: radial-gradient(circle at center,
    rgba(255,255,255,0.10),
    rgba(255,255,255,0.05) 28%,
    transparent 62%
  );
  opacity: 0.0;
  animation: aruAuraPulse 3.2s ease-in-out infinite;
  mix-blend-mode: screen;
  transform: translateZ(0);
}

/* Max flash */
.app[data-aru-state="max"] .aruFX{
  animation: aruMaxFlash 2.4s ease-in-out infinite;
}

@keyframes aruStarDrift{
  from{ transform: translate3d(0,0,0); }
  to  { transform: translate3d(180px,180px,0); }
}
@keyframes aruAuraPulse{
  0%,100%{ opacity: 0.12; filter: blur(0px); }
  50%    { opacity: 0.32; filter: blur(1px); }
}
@keyframes aruMaxFlash{
  0%,100%{ filter: brightness(1); }
  50%    { filter: brightness(1.18); }
}

@media (prefers-reduced-motion: reduce){
  .aruFX::before,
  .aruFX::after,
  .app[data-aru-state="max"] .aruFX{
    animation:none !important;
  }
}
