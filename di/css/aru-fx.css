/* /di/css/aru-fx.css
   =========================
   ARU FX (TOPMOST RESULT FX)
   - shows ONLY when #result is visible (aria-hidden != "true")
   - intensity is driven by --aru-value (0..1) on .app
   - state is driven by .app[data-aru-state="low|mid|high|max"]
   ========================= */

/* 値は .app から読む（aru-gauge と同じスコープ） */
.app{
  --aru-value: 0; /* 0..1 */
}

/* =========================
   Visibility (RESULT ONLY)
   ========================= */

.aruFX{
  display: none; /* default hidden */
}

.app:has(#result:not([aria-hidden="true"])) .aruFX{
  display: block;
}

/* =========================
   Layer (topmost, but below ring if desired)
   ========================= */

.aruFX{
  position: fixed;
  inset: 0;

  /* ✅ リング(9999)の1つ下に置く（背景の上には確実に出る） */
  z-index: 9998;

  pointer-events: none;
  overflow: hidden;
  isolation: isolate;

  /* “背景に色が乗る”のを避けたいので、基本は薄く */
  opacity: 1;
}

/* =========================
   Stars (subtle)
   ========================= */

.aruFX::before{
  content:"";
  position:absolute;
  inset:-20%;

  /* 疑似星フィールド（軽い） */
  background:
    radial-gradient(circle at 12% 22%, rgba(255,255,255,0.85) 1px, transparent 2px),
    radial-gradient(circle at 68% 18%, rgba(255,255,255,0.55) 1px, transparent 2px),
    radial-gradient(circle at 82% 64%, rgba(255,255,255,0.70) 1px, transparent 2px),
    radial-gradient(circle at 26% 78%, rgba(255,255,255,0.60) 1px, transparent 2px),
    radial-gradient(circle at 44% 46%, rgba(255,255,255,0.45) 1px, transparent 2px);

  background-size: 220px 220px;
  background-repeat: repeat;

  /* ✅ valueに連動：0ならほぼ見えない、MAXでやっと“気配” */
  opacity: clamp(0, calc(var(--aru-value) * 0.55), 0.55);

  animation: aruStarDrift 18s linear infinite;
  transform: translateZ(0);
}

/* =========================
   Aura (high/max only)
   ========================= */

.app[data-aru-state="high"] .aruFX::after,
.app[data-aru-state="max"]  .aruFX::after{
  content:"";
  position:absolute;
  inset: -10%;

  /* 色は乗せず“白い霞”だけ（背景を染めない） */
  background: radial-gradient(circle at center,
    rgba(255,255,255,0.10),
    rgba(255,255,255,0.05) 28%,
    transparent 62%
  );

  opacity: 0.0;
  animation: aruAuraPulse 3.2s ease-in-out infinite;
  mix-blend-mode: screen; /* うっすら光らせる */
  transform: translateZ(0);
}

/* MAX時だけ、軽いフラッシュ（画面全体を染めない） */
.app[data-aru-state="max"] .aruFX{
  animation: aruMaxFlash 2.4s ease-in-out infinite;
}

/* =========================
   Animations
   ========================= */

@keyframes aruStarDrift{
  from{ transform: translate3d(0,0,0); }
  to  { transform: translate3d(180px,180px,0); }
}

@keyframes aruAuraPulse{
  0%,100%{ opacity: 0.12; filter: blur(0px); }
  50%    { opacity: 0.32; filter: blur(1px); }
}

@keyframes aruMaxFlash{
  0%,100%{ filter: brightness(1); }
  50%    { filter: brightness(1.18); }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .aruFX::before,
  .aruFX::after,
  .app[data-aru-state="max"] .aruFX{
    animation: none !important;
  }
}
