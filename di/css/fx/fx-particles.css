/* /di/css/fx/fx-particles.css
   FX PARTICLES — GOD-PRO "ENERGY CORE" (ULTRA LIGHT)
   --------------------------------------------------
   Goals:
   1) タップ時の紋章（sigil）を消す（pseudo廃止）
   2) 星 → 円形エネルギー粒子（数と大きさが認識できる）
   3) 中央くっきり＋外周グラデでぼかし（filter/blur無しで表現）
   4) iOS軽量化：mix-blend/filter/clip-path/repeating-conic を使わない
*/

:root{
  --res-core: var(--res-color, hsl(210 90% 62%));
  --res-core-soft: var(--res-color-soft, hsla(210 90% 62% / .35));
  --res-core-glow: var(--res-color-glow, hsla(210 90% 62% / .18));
}

/* ------------------------------
   Base particle (legacy hook)
   - JS側が left/top/--fx-size を付ける想定
   - transform/opacity だけで動く（軽い）
-------------------------------- */
.fx-particle{
  position: absolute;
  width: var(--fx-size, 14px);
  height: var(--fx-size, 14px);
  pointer-events: none;

  left: 0;
  top: 0;

  /* iOS：filterは使わない。描画はradial-gradient+shadowで完結 */
  opacity: var(--fx-alpha, .95);
  will-change: transform, opacity, left, top;
  transform: translate(-50%,-50%) translateZ(0);

  border-radius: 999px;

  /* ✅ 中央くっきり + 外周ぼかし（filter無し） */
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255,255,255,.95) 0%,
      rgba(255,255,255,.85) 12%,
      color-mix(in srgb, var(--res-core) 78%, rgba(255,255,255,.55)) 28%,
      var(--res-core-soft) 52%,
      rgba(0,0,0,0) 74%
    );

  /* ✅ “光量”は影で出す：段数を少なく */
  box-shadow:
    0 0 calc(var(--fx-size,14px) * .90) var(--res-core-glow),
    0 0 calc(var(--fx-size,14px) * 1.60) rgba(255,255,255,.14);

  /* ❌重い要素は禁止 */
  mix-blend-mode: normal;
  filter: none;
}

/* ---------------------------------
   Stream particle (moving to ring)
   - “白い線”に見えるのを防ぐため「尾」は薄く短く
   - blur/filterは使わない
---------------------------------- */
.fx-particle.stream{
  /* JS側がtransitionを付ける場合もあるが、保険で保持 */
  transition:
    transform .55s cubic-bezier(.22,.8,.2,1),
    left .55s cubic-bezier(.22,.8,.2,1),
    top .55s cubic-bezier(.22,.8,.2,1),
    opacity .55s ease;
}

/* 尾（軽量）：細いグラデ帯を1枚だけ。blurなし。 */
.fx-particle.stream::after{
  content:"";
  position:absolute;
  left: 50%;
  top: 50%;
  width: calc(var(--fx-size,14px) * 1.8);
  height: calc(var(--fx-size,14px) * .42);
  transform: translate(-12%, -50%) rotate(var(--fx-tail-rot, -16deg));
  transform-origin: 0% 50%;
  pointer-events:none;
  border-radius: 999px;

  background: linear-gradient(90deg,
    rgba(255,255,255,.26),
    var(--res-core-soft),
    rgba(0,0,0,0)
  );

  opacity: .75;
}

/* 吸収終端：フェードアウトだけ（blur禁止） */
.fx-particle.absorbed{
  opacity:0;
}

/* ---------------------------------
   Engine FX classes (burst/stream)
   - JSが createParticle(...) で付ける className を想定
   - ここで「星→円形エネルギー核」に統一
---------------------------------- */
.burstCore,
.burstDust,
.streamAbsorb{
  border-radius: 999px !important;
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255,255,255,.96) 0%,
      rgba(255,255,255,.82) 13%,
      color-mix(in srgb, var(--res-core) 78%, rgba(255,255,255,.55)) 30%,
      var(--res-core-soft) 56%,
      rgba(0,0,0,0) 78%
    ) !important;

  /* 認識しやすさ：中心が締まって見えるよう“薄い内リム” */
  outline: 1px solid rgba(255,255,255,.16);
  outline-offset: -1px;

  /* 軽量shadow（段数少なめ） */
  box-shadow:
    0 0 18px var(--res-core-glow),
    0 0 28px rgba(255,255,255,.10);

  mix-blend-mode: normal !important;
  filter: none !important;
  will-change: transform, opacity;
}

/* burstCore は“核が強い”：外周光量を少しだけ増やす（でも軽い） */
.burstCore{
  outline-color: rgba(255,255,255,.22);
  box-shadow:
    0 0 22px var(--res-core-glow),
    0 0 34px rgba(255,255,255,.14);
}

/* burstDust は“数が多い”：さらに軽く（影弱め） */
.burstDust{
  outline: none;
  box-shadow:
    0 0 14px var(--res-core-glow);
}

/* streamAbsorb は“移動粒子”：尾はJS側のtransformで線に見えやすいので影を抑える */
.streamAbsorb{
  outline-color: rgba(255,255,255,.14);
  box-shadow:
    0 0 16px var(--res-core-glow);
}

/* ✅ 重要：タップ時の紋章（sigil）を完全禁止 */
.burstCore::before,
.burstCore::after,
.burstDust::before,
.burstDust::after,
.streamAbsorb::before,
.streamAbsorb::after{
  content: none !important;
}

/* 旧CSSの干渉を止める（ただし重い効果は追加しない） */
.particle,
.fxParticle,
.fx-particle{
  opacity: 1 !important;
  filter: none !important;
  mix-blend-mode: normal !important;
}
