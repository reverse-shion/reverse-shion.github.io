/* /di/css/fx/absorb.css
   PRO LIGHT (absorb) — COMET STREAM (visible + addictive)
   - keep vars:
     --fx-x, --fx-y   : start (px)
     --fx-ang         : angle (deg)
     --fx-len         : length (px)
     --fx-dur         : duration (ms)
*/

.fxAbsorb{
  position: fixed;
  left: 0; top: 0;
  width: 1px; height: 1px;
  transform: translate(var(--fx-x, 0px), var(--fx-y, 0px));
  pointer-events: none;
  z-index: 2147483000;

  /* ほんの少しだけ“存在感”を上げる（背景が明るい対策） */
  isolation: isolate;
}

.fxAbsorb .beam{
  position:absolute;
  left: 0; top: 0;
  width: var(--fx-len, 220px);

  /* ✅ 2pxは細すぎるので“見える王道”に寄せる（ここが一番効く） */
  height: 5px;

  transform-origin: 0 50%;
  transform: rotate(var(--fx-ang, 0deg));
  border-radius: 999px;

  /* ✅ 流星っぽい “尾→核” グラデ（先端ほど明るい） */
  background: linear-gradient(90deg,
    rgba(255,255,255,0.0) 0%,
    rgba(0,240,255,0.20) 18%,
    rgba(156,60,255,0.22) 52%,
    rgba(255,255,255,0.92) 82%,
    rgba(255,255,255,0.0) 100%
  );

  /* ✅ 背景に負けない：加算合成 */
  mix-blend-mode: screen;

  /* ✅ 発光を“2段”で強める */
  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.22))
    drop-shadow(0 0 14px rgba(0,240,255,0.28))
    drop-shadow(0 0 18px rgba(156,60,255,0.22));

  opacity: 0;

  /* ✅ 尾の向きが分かるテーパー（軽量） */
  clip-path: polygon(0 40%, 92% 0, 100% 50%, 92% 100%, 0 60%);

  animation: fxBeamIn var(--fx-dur, 260ms) ease-out both;
}

/* ✅ コメットヘッド（流星の核） */
.fxAbsorb .beam::before{
  content:"";
  position:absolute;

  /* beamの先端付近に核を置く */
  left: calc(100% - 10px);
  top: 50%;
  width: 16px;
  height: 16px;
  transform: translate(-50%,-50%);
  border-radius: 999px;

  background: radial-gradient(circle at 35% 35%,
    rgba(255,255,255,1.0) 0%,
    rgba(255,255,255,0.92) 18%,
    rgba(0,240,255,0.55) 44%,
    rgba(156,60,255,0.22) 70%,
    rgba(156,60,255,0.0) 100%
  );

  mix-blend-mode: screen;
  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.45))
    drop-shadow(0 0 18px rgba(0,240,255,0.35))
    drop-shadow(0 0 22px rgba(156,60,255,0.28));

  opacity: 0;
  animation: fxHead var(--fx-dur, 260ms) ease-out both;
}

.fxAbsorb .beam::after{
  content:"";
  position:absolute;
  inset:-10px 0 -10px 0;
  border-radius: 999px;

  /* dash particles: repeating gradient that scrolls */
  background: repeating-linear-gradient(90deg,
    rgba(255,255,255,0.0) 0 10px,
    rgba(255,255,255,0.80) 10px 13px,
    rgba(0,240,255,0.0) 13px 20px,
    rgba(0,240,255,0.70) 20px 23px,
    rgba(156,60,255,0.0) 23px 32px,
    rgba(156,60,255,0.62) 32px 35px,
    rgba(255,255,255,0.0) 35px 46px
  );

  /* ✅ 粒子も加算で“光”にする */
  mix-blend-mode: screen;

  opacity: 0;

  /* ✅ 尾の中だけ見せる */
  mask-image: linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(0,0,0,1) 18%,
    rgba(0,0,0,1) 88%,
    rgba(0,0,0,0) 100%
  );

  /* ✅ 粒子にも軽い発光 */
  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.16))
    drop-shadow(0 0 14px rgba(0,240,255,0.18));

  animation:
    fxDash var(--fx-dur, 260ms) linear both,
    fxDashFade var(--fx-dur, 260ms) ease-out both;
}

/* PERFECTは束を増やす（核も強める） */
.fxAbsorb.is-perfect .beam{
  height: 6px;
  filter:
    drop-shadow(0 0 12px rgba(255,255,255,0.28))
    drop-shadow(0 0 18px rgba(0,240,255,0.34))
    drop-shadow(0 0 22px rgba(156,60,255,0.28));
}

.fxAbsorb.is-perfect .beam::before{
  width: 18px; height: 18px;
}

/* 補助線（既存） */
.fxAbsorb.is-perfect .beam::after{
  /* afterはそのまま使う（上で強化済み） */
}

.fxAbsorb.is-perfect .beam i{
  position:absolute;
  left:0; top:50%;
  width:100%;
  height:1px;
  transform: translateY(7px);
  border-radius:999px;
  background: linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(156,60,255,0.28) 22%,
    rgba(0,240,255,0.22) 58%,
    rgba(255,255,255,0.0) 100%
  );
  mix-blend-mode: screen;
  opacity: 0;
  animation: fxBeamIn var(--fx-dur, 260ms) ease-out both;
  filter: drop-shadow(0 0 10px rgba(156,60,255,0.18));
}

@keyframes fxBeamIn{
  0%   { opacity:0; transform: rotate(var(--fx-ang, 0deg)) scaleX(0.85); }
  18%  { opacity:1; transform: rotate(var(--fx-ang, 0deg)) scaleX(1.00); }
  100% { opacity:0; transform: rotate(var(--fx-ang, 0deg)) scaleX(1.05); }
}

@keyframes fxHead{
  0%   { opacity:0; transform: translate(-50%,-50%) scale(0.85); }
  18%  { opacity:1; transform: translate(-50%,-50%) scale(1.05); }
  100% { opacity:0; transform: translate(-50%,-50%) scale(1.10); }
}

@keyframes fxDash{
  0%   { background-position: 0 0; }
  100% { background-position: 180px 0; }
}

@keyframes fxDashFade{
  0%   { opacity:0; }
  25%  { opacity:0.95; }
  100% { opacity:0; }
}
