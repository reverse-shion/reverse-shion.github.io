/* /di/css/fx/absorb.css
   PRO LIGHT (absorb) — COMET STREAM (visible + addictive)
   - uses vars:
     --fx-x, --fx-y   : start (px)
     --fx-ang         : angle (deg)
     --fx-len         : length (px)
     --fx-dur         : duration (ms)
*/

.fxAbsorb{
  position: fixed;
  left: 0; top: 0;
  width: 1px; height: 1px;
  transform: translate(var(--fx-x, 0px), var(--fx-y, 0px));
  pointer-events: none;
  z-index: 2147483000;
  isolation: isolate;
}

.fxAbsorb .beam{
  position:absolute;
  left: 0; top: 0;
  width: var(--fx-len, 220px);

  /* ✅ 視認性の核：2pxは溶ける → 5pxが王道ライン */
  height: 5px;

  transform-origin: 0 50%;
  transform: rotate(var(--fx-ang, 0deg));
  border-radius: 999px;

  /* ✅ 尾 → 先端が強い（流星） */
  background: linear-gradient(90deg,
    rgba(255,255,255,0.00) 0%,
    rgba(0,240,255,0.22) 18%,
    rgba(156,60,255,0.22) 55%,
    rgba(255,255,255,0.92) 84%,
    rgba(255,255,255,0.00) 100%
  );

  /* ✅ 明るい背景に勝つ：加算寄り */
  mix-blend-mode: screen;

  /* ✅ 発光を2段階で増やす */
  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.18))
    drop-shadow(0 0 16px rgba(0,240,255,0.26))
    drop-shadow(0 0 18px rgba(156,60,255,0.22));

  /* ✅ 流れる向きが分かるテーパー（軽量） */
  clip-path: polygon(0 40%, 92% 0, 100% 50%, 92% 100%, 0 60%);

  opacity: 0;
  animation: fxBeamIn var(--fx-dur, 260ms) ease-out both;
}

/* ✅ 先端の核（コメットヘッド） */
.fxAbsorb .beam::before{
  content:"";
  position:absolute;
  left: calc(100% - 10px);
  top: 50%;
  width: 16px;
  height: 16px;
  transform: translate(-50%,-50%);
  border-radius: 999px;

  background: radial-gradient(circle at 35% 35%,
    rgba(255,255,255,1.0) 0%,
    rgba(255,255,255,0.92) 18%,
    rgba(0,240,255,0.55) 48%,
    rgba(156,60,255,0.22) 72%,
    rgba(156,60,255,0.0) 100%
  );

  mix-blend-mode: screen;
  filter:
    drop-shadow(0 0 12px rgba(255,255,255,0.40))
    drop-shadow(0 0 20px rgba(0,240,255,0.32))
    drop-shadow(0 0 24px rgba(156,60,255,0.26));

  opacity: 0;
  animation: fxHead var(--fx-dur, 260ms) ease-out both;
}

/* dash 粒子（尾の粒感） */
.fxAbsorb .beam::after{
  content:"";
  position:absolute;
  inset:-10px 0 -10px 0;
  border-radius: 999px;

  background: repeating-linear-gradient(90deg,
    rgba(255,255,255,0.0) 0 10px,
    rgba(255,255,255,0.85) 10px 13px,
    rgba(0,240,255,0.0) 13px 20px,
    rgba(0,240,255,0.72) 20px 23px,
    rgba(156,60,255,0.0) 23px 32px,
    rgba(156,60,255,0.62) 32px 35px,
    rgba(255,255,255,0.0) 35px 46px
  );

  mix-blend-mode: screen;

  opacity: 0;
  mask-image: linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(0,0,0,1) 18%,
    rgba(0,0,0,1) 88%,
    rgba(0,0,0,0) 100%
  );

  filter:
    drop-shadow(0 0 10px rgba(255,255,255,0.14))
    drop-shadow(0 0 16px rgba(0,240,255,0.18));

  animation:
    fxDash var(--fx-dur, 260ms) linear both,
    fxDashFade var(--fx-dur, 260ms) ease-out both;
}

/* ✅ PERFECT：iが無くても束になるように“疑似2本”をCSSだけで追加 */
.fxAbsorb.is-perfect .beam{
  height: 6px;
}

.fxAbsorb.is-perfect .beam::after{
  /* 粒子をちょい強め */
  filter:
    drop-shadow(0 0 12px rgba(255,255,255,0.16))
    drop-shadow(0 0 18px rgba(0,240,255,0.22));
}

/* 追加の補助線（上側） */
.fxAbsorb.is-perfect .beam span{
  display:none; /* 互換用：もしspanを入れても無視 */
}

.fxAbsorb.is-perfect .beam{
  /* 疑似2本の光をbox-shadowで足す（軽量） */
  box-shadow:
    0 -6px 0 rgba(255,255,255,0.0),
    0  6px 0 rgba(255,255,255,0.0);
}

/* 旧仕様：もし i が存在するならその線も活かす */
.fxAbsorb.is-perfect .beam i{
  position:absolute;
  left:0; top:50%;
  width:100%;
  height:2px;
  transform: translateY(8px);
  border-radius:999px;
  background: linear-gradient(90deg,
    rgba(0,0,0,0) 0%,
    rgba(156,60,255,0.28) 22%,
    rgba(0,240,255,0.22) 58%,
    rgba(255,255,255,0.0) 100%
  );
  mix-blend-mode: screen;
  opacity: 0;
  animation: fxBeamIn var(--fx-dur, 260ms) ease-out both;
  filter: drop-shadow(0 0 12px rgba(156,60,255,0.18));
}

@keyframes fxBeamIn{
  0%   { opacity:0; transform: rotate(var(--fx-ang, 0deg)) scaleX(0.86); }
  18%  { opacity:1; transform: rotate(var(--fx-ang, 0deg)) scaleX(1.00); }
  100% { opacity:0; transform: rotate(var(--fx-ang, 0deg)) scaleX(1.06); }
}

@keyframes fxHead{
  0%   { opacity:0; transform: translate(-50%,-50%) scale(0.85); }
  18%  { opacity:1; transform: translate(-50%,-50%) scale(1.08); }
  100% { opacity:0; transform: translate(-50%,-50%) scale(1.12); }
}

@keyframes fxDash{
  0%   { background-position: 0 0; }
  100% { background-position: 180px 0; }
}

@keyframes fxDashFade{
  0%   { opacity:0; }
  25%  { opacity:0.95; }
  100% { opacity:0; }
}
