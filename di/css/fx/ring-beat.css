/* /di/css/fx/ring-beat.css
   RingBeat VISUAL — ultra light
   - rb-beat: heartbeat pulse (scale + glow)
   - rb-stop: stop rotation (pause animation)
   - rb-glow: strong glow at threshold moment
   - rbAbsorb: 1 DOM element, ring -> center absorb
*/

/* ---------------------------------------
   1) Beat (always)
--------------------------------------- */
#avatarRing.rb-beat{
  /* beat intensity: 0..1 */
  --rb-k: var(--rb-beat, 0.0);
  /* subtle but felt */
  animation: rbBeat 720ms ease-in-out infinite;
  will-change: transform, filter;
}

@keyframes rbBeat{
  0%   { transform: translate(-50%,-50%) rotate(0deg) scale(1); filter: brightness(1); }
  35%  { transform: translate(-50%,-50%) rotate(0deg) scale(calc(1 + 0.06 + 0.10*var(--rb-k))); filter: brightness(calc(1.08 + 0.55*var(--rb-k))); }
  100% { transform: translate(-50%,-50%) rotate(0deg) scale(1); filter: brightness(1); }
}

/* ---------------------------------------
   2) Stop spin at threshold
   - pause pseudo animations safely
--------------------------------------- */
#avatarRing.rb-stop,
#avatarRing.rb-stop::before,
#avatarRing.rb-stop::after{
  animation-play-state: paused !important;
}

/* ---------------------------------------
   3) Strong glow (moment)
--------------------------------------- */
#avatarRing.rb-glow{
  filter: brightness(1.85) saturate(1.1);
}

#avatarRing.rb-glow::before{
  opacity: 1;
  filter: brightness(2.0) blur(2px);
}

#avatarRing.rb-glow::after{
  box-shadow:
    inset 0 0 20px rgba(0,0,0,.25),
    0 0 0 10px rgba(0,240,255,.20),
    0 0 0 16px rgba(156,60,255,.12);
}

/* ---------------------------------------
   4) Absorb beam (1 element)
--------------------------------------- */
.rbAbsorb{
  position: absolute;
  left: 0; top: 0;
  width: 1px; height: 1px;
  pointer-events: none;
  z-index: 2147483646; /* fxLayer top */

  /* start/end (set by JS in fxLayer coords) */
  --sx: 0px; --sy: 0px;
  --ex: 0px; --ey: 0px;
  --rb-dot: 22px;

  transform: translate(var(--sx), var(--sy));
  opacity: 0;
}

/* the moving “spark + trail” */
.rbAbsorb::before{
  content:"";
  position:absolute;
  left: calc(var(--rb-dot) * -0.5);
  top:  calc(var(--rb-dot) * -0.5);
  width: var(--rb-dot);
  height: var(--rb-dot);
  border-radius: 999px;
  background: radial-gradient(circle,
    rgba(255,255,255,0.95) 0%,
    rgba(0,240,255,0.75) 35%,
    rgba(156,60,255,0.35) 62%,
    rgba(0,0,0,0) 72%
  );
  filter:
    drop-shadow(0 0 10px rgba(0,240,255,0.25))
    drop-shadow(0 0 16px rgba(156,60,255,0.18));
}

/* trail */
.rbAbsorb::after{
  content:"";
  position:absolute;
  left: 0;
  top: -1px;
  height: 2px;
  width: 180px;
  transform-origin: 0 50%;
  background: linear-gradient(90deg,
    rgba(255,255,255,0.00),
    rgba(0,240,255,0.32),
    rgba(156,60,255,0.18),
    rgba(255,255,255,0.00)
  );
  opacity: 0.0;
  filter: blur(0.2px);
}

.rbAbsorb.rb-run{
  opacity: 1;
  animation: rbAbsorbMove 520ms cubic-bezier(.18,.82,.2,1) both;
}

.rbAbsorb.rb-run::after{
  opacity: 0.75;
  animation: rbTrail 520ms cubic-bezier(.18,.82,.2,1) both;
}

/* move from ring to center */
@keyframes rbAbsorbMove{
  0%   { transform: translate(var(--sx), var(--sy)) scale(1.0); opacity: 1; }
  70%  { transform: translate(calc((var(--sx)*0.2 + var(--ex)*0.8)), calc((var(--sy)*0.2 + var(--ey)*0.8))) scale(0.85); opacity: 1; }
  100% { transform: translate(var(--ex), var(--ey)) scale(0.55); opacity: 0; }
}

/* trail rotates roughly toward the target (cheap approx by stretch only) */
@keyframes rbTrail{
  0%   { width: 40px; opacity: 0.0; }
  25%  { width: 180px; opacity: 0.75; }
  100% { width: 220px; opacity: 0.0; }
}
